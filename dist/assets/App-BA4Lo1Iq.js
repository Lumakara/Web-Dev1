const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HomeSection-BGOCzVhx.js","assets/ui-vendor-q7wFqjOa.js","assets/react-core-uW5GauGR.js","assets/index-CL1up3YA.js","assets/utils-CUtzRjuR.js","assets/icons-Bd72YT1L.js","assets/css/index-B6JKAkts.css","assets/badge-DJZPaMpK.js","assets/firebase-BZSrvpf7.js","assets/useProducts-ILBgL--I.js","assets/appStore-DZKr_UpI.js","assets/state-BjmFXnif.js","assets/ProductSection-C5P_jEpb.js","assets/notifications-Bi33bcEl.js","assets/CartSection-C-z-ruj6.js","assets/checkbox-DrMCNYIb.js","assets/card-Cmhyo_6H.js","assets/AuthSection-pwwUed_J.js","assets/label-C8Dy0a63.js","assets/NotFound-CrDRqvXg.js","assets/SupportSection-DHuy6CUF.js","assets/textarea-CQ7D91hS.js","assets/select-C96jmM-n.js","assets/ProfileSection-BwtEJexL.js","assets/CheckoutSection-DYTcmQ0G.js","assets/UltraSearch-PURyzfjP.js","assets/ParticleBackground-CRnDEmue.js"])))=>i.map(i=>d[i]);
import{c as P,B as D,s as H,_ as re}from"./index-CL1up3YA.js";import{j as l,c as Bs,u as Ms,a as Lt,R as qs,T as Ks,C as Ws,b as Fs,d as Vs,P as Hs,O as Gs,_ as zs,e as yt,f as Js,V as Ys,g as Qs,h as Xs,i as Zs}from"./ui-vendor-q7wFqjOa.js";import{r as v,e as en,L as ce,u as Br,j as tn,h as rn,i as ne}from"./react-core-uW5GauGR.js";import{X as _e,S as Mr,a as qr,C as Kr,M as sn,b as nn,A as an,c as Wr,d as on,e as ln,V as cn,f as un,g as dn,h as hn,i as Ie,U as Qe,H as Fr,j as ht,k as Vr,L as fn,W as We,l as Hr,m as Gr,P as pn,n as zr,o as ir,Z as dt,p as Ut,B as mn,q as Dt,r as gn,s as yn,D as bn,t as or,u as wn,v as vn,R as _n,w as xn,x as xt,y as Xt,z as kn,E as Jr,O as Sn,T as En,I as jn,F as lr}from"./icons-Bd72YT1L.js";import{u as X,a as O}from"./appStore-DZKr_UpI.js";import{D as Yr,a as Qr,b as Xr,F as Z,U as ae,T as cr,c as Rn,P as Tn,I as An,B as Cn}from"./badge-DJZPaMpK.js";import{t as $,T as Pn}from"./notifications-Bi33bcEl.js";import{S as Nn,N as On,a as ee}from"./NotFound-CrDRqvXg.js";function In(t,e=[]){let r=[];function s(a,i){const o=v.createContext(i);o.displayName=a+"Context";const c=r.length;r=[...r,i];const u=h=>{const{scope:p,children:f,...m}=h,b=p?.[t]?.[c]||o,g=v.useMemo(()=>m,Object.values(m));return l.jsx(b.Provider,{value:g,children:f})};u.displayName=a+"Provider";function d(h,p){const f=p?.[t]?.[c]||o,m=v.useContext(f);if(m)return m;if(i!==void 0)return i;throw new Error(`\`${h}\` must be used within \`${a}\``)}return[u,d]}const n=()=>{const a=r.map(i=>v.createContext(i));return function(o){const c=o?.[t]||a;return v.useMemo(()=>({[`__scope${t}`]:{...o,[t]:c}}),[o,c])}};return n.scopeName=t,[s,$n(n,...e)]}function $n(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const s=t.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(a){const i=s.reduce((o,{useScope:c,scopeName:u})=>{const h=c(a)[`__scope${u}`];return{...o,...h}},{});return v.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return r.scopeName=e.scopeName,r}var Ln=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Zt=Ln.reduce((t,e)=>{const r=Bs(`Primitive.${e}`),s=v.forwardRef((n,a)=>{const{asChild:i,...o}=n,c=i?r:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),l.jsx(c,{...o,ref:a})});return s.displayName=`Primitive.${e}`,{...t,[e]:s}},{}),kt={exports:{}},St={};var ur;function Un(){if(ur)return St;ur=1;var t=en();function e(h,p){return h===p&&(h!==0||1/h===1/p)||h!==h&&p!==p}var r=typeof Object.is=="function"?Object.is:e,s=t.useState,n=t.useEffect,a=t.useLayoutEffect,i=t.useDebugValue;function o(h,p){var f=p(),m=s({inst:{value:f,getSnapshot:p}}),b=m[0].inst,g=m[1];return a(function(){b.value=f,b.getSnapshot=p,c(b)&&g({inst:b})},[h,f,p]),n(function(){return c(b)&&g({inst:b}),h(function(){c(b)&&g({inst:b})})},[h]),i(f),f}function c(h){var p=h.getSnapshot;h=h.value;try{var f=p();return!r(h,f)}catch{return!0}}function u(h,p){return p()}var d=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:o;return St.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:d,St}var dr;function Dn(){return dr||(dr=1,kt.exports=Un()),kt.exports}var Bn=Dn();function Mn(){return Bn.useSyncExternalStore(qn,()=>!0,()=>!1)}function qn(){return()=>{}}var er="Avatar",[Kn]=In(er),[Wn,Zr]=Kn(er),es=v.forwardRef((t,e)=>{const{__scopeAvatar:r,...s}=t,[n,a]=v.useState("idle");return l.jsx(Wn,{scope:r,imageLoadingStatus:n,onImageLoadingStatusChange:a,children:l.jsx(Zt.span,{...s,ref:e})})});es.displayName=er;var ts="AvatarImage",rs=v.forwardRef((t,e)=>{const{__scopeAvatar:r,src:s,onLoadingStatusChange:n=()=>{},...a}=t,i=Zr(ts,r),o=Fn(s,a),c=Ms(u=>{n(u),i.onImageLoadingStatusChange(u)});return Lt(()=>{o!=="idle"&&c(o)},[o,c]),o==="loaded"?l.jsx(Zt.img,{...a,ref:e,src:s}):null});rs.displayName=ts;var ss="AvatarFallback",ns=v.forwardRef((t,e)=>{const{__scopeAvatar:r,delayMs:s,...n}=t,a=Zr(ss,r),[i,o]=v.useState(s===void 0);return v.useEffect(()=>{if(s!==void 0){const c=window.setTimeout(()=>o(!0),s);return()=>window.clearTimeout(c)}},[s]),i&&a.imageLoadingStatus!=="loaded"?l.jsx(Zt.span,{...n,ref:e}):null});ns.displayName=ss;function hr(t,e){return t?e?(t.src!==e&&(t.src=e),t.complete&&t.naturalWidth>0?"loaded":"loading"):"error":"idle"}function Fn(t,{referrerPolicy:e,crossOrigin:r}){const s=Mn(),n=v.useRef(null),a=s?(n.current||(n.current=new window.Image),n.current):null,[i,o]=v.useState(()=>hr(a,t));return Lt(()=>{o(hr(a,t))},[a,t]),Lt(()=>{const c=h=>()=>{o(h)};if(!a)return;const u=c("loaded"),d=c("error");return a.addEventListener("load",u),a.addEventListener("error",d),e&&(a.referrerPolicy=e),typeof r=="string"&&(a.crossOrigin=r),()=>{a.removeEventListener("load",u),a.removeEventListener("error",d)}},[a,r,e]),i}var Vn=es,Hn=rs,Gn=ns;function as({className:t,...e}){return l.jsx(Vn,{"data-slot":"avatar",className:P("relative flex size-8 shrink-0 overflow-hidden rounded-full",t),...e})}function is({className:t,...e}){return l.jsx(Hn,{"data-slot":"avatar-image",className:P("aspect-square size-full",t),...e})}function os({className:t,...e}){return l.jsx(Gn,{"data-slot":"avatar-fallback",className:P("bg-muted flex size-full items-center justify-center rounded-full",t),...e})}function zn({...t}){return l.jsx(qs,{"data-slot":"sheet",...t})}function Jn({...t}){return l.jsx(Ks,{"data-slot":"sheet-trigger",...t})}function Yn({...t}){return l.jsx(Hs,{"data-slot":"sheet-portal",...t})}function Qn({className:t,...e}){return l.jsx(Gs,{"data-slot":"sheet-overlay",className:P("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...e})}function Xn({className:t,children:e,side:r="right",...s}){return l.jsxs(Yn,{children:[l.jsx(Qn,{}),l.jsxs(Ws,{"data-slot":"sheet-content",className:P("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",r==="right"&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",r==="left"&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",r==="top"&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",r==="bottom"&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",t),...s,children:[e,l.jsxs(Fs,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[l.jsx(_e,{className:"size-4"}),l.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function Zn({className:t,...e}){return l.jsx("div",{"data-slot":"sheet-header",className:P("flex flex-col gap-1.5 p-4",t),...e})}function ea({className:t,...e}){return l.jsx(Vs,{"data-slot":"sheet-title",className:P("text-foreground font-semibold",t),...e})}const Le=[{icon:Mr,title:"Cari Layanan",description:"Gunakan fitur pencarian atau filter kategori untuk menemukan layanan yang Anda butuhkan. Geser kategori ke kiri/kanan untuk melihat semua pilihan.",image:"search",tips:["Ketik nama layanan di kolom pencarian","Gunakan filter kategori untuk menyempitkan hasil","Tekan tombol filter untuk opsi lebih lanjut"]},{icon:qr,title:"Tambah ke Keranjang",description:"Pilih paket yang sesuai dengan kebutuhan Anda. Setiap layanan memiliki beberapa pilihan paket dengan fitur berbeda.",image:"cart",tips:["Klik produk untuk melihat detail","Pilih paket yang sesuai (Basic/Standard/Premium)",'Klik "Tambah ke Keranjang"']},{icon:Kr,title:"Pembayaran QRIS",description:"Lakukan pembayaran dengan mudah menggunakan QRIS. Scan kode QR dengan aplikasi e-wallet favorit Anda.",image:"payment",tips:["Periksa item di keranjang",'Klik "Checkout" untuk membayar',"Scan kode QRIS dengan aplikasi pembayaran"]},{icon:sn,title:"Dapatkan Bantuan",description:"Jika ada pertanyaan atau masalah, gunakan fitur live chat atau kirim tiket dukungan. Tim kami siap membantu 24/7.",image:"support",tips:['Buka menu "Bantuan"',"Gunakan live chat untuk respon cepat","Kirim tiket untuk masalah kompleks"]},{icon:nn,title:"Selesai!",description:"Anda sudah siap menggunakan layanan kami. Selamat berbelanja dan jangan ragu untuk menghubungi kami jika perlu bantuan.",image:"done",tips:["Pantau status pesanan di menu Profil","Berikan ulasan setelah layanan selesai","Nikmati pengalaman berbelanja!"]}];function ls({isOpen:t,onClose:e}){const[r,s]=v.useState(0),{soundEnabled:n}=X(),a=()=>{n&&O.playClick(),r<Le.length-1?s(r+1):o()},i=()=>{n&&O.playClick(),r>0&&s(r-1)},o=()=>{n&&O.playClick(),s(0),e()},c=Le[r],u=c.icon;return l.jsx(Yr,{open:t,onOpenChange:o,children:l.jsxs(Qr,{className:"max-w-lg p-0 overflow-hidden",children:[l.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-orange-500 p-4 flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-2 text-white",children:[l.jsx(u,{className:"h-5 w-5"}),l.jsx("span",{className:"font-medium",children:"Cara Penggunaan"})]}),l.jsx("button",{onClick:o,className:"text-white/80 hover:text-white p-1",children:l.jsx(_e,{className:"h-5 w-5"})})]}),l.jsx("div",{className:"px-6 pt-4",children:l.jsx("div",{className:"flex gap-1",children:Le.map((d,h)=>l.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-all ${h<=r?"bg-blue-500":"bg-gray-200"}`},h))})}),l.jsxs("div",{className:"p-6",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-r from-blue-500 to-orange-500 flex items-center justify-center",children:l.jsx(u,{className:"h-8 w-8 text-white"})}),l.jsx(Xr,{className:"text-xl font-bold mb-2",children:c.title}),l.jsx("p",{className:"text-gray-600",children:c.description})]}),l.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[l.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"ðŸ’¡ Tips:"}),l.jsx("ul",{className:"space-y-1",children:c.tips.map((d,h)=>l.jsxs("li",{className:"text-sm text-gray-600 flex items-start gap-2",children:[l.jsx("span",{className:"text-blue-500 mt-0.5",children:"â€¢"}),d]},h))})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsxs(D,{variant:"outline",className:"flex-1",onClick:i,disabled:r===0,children:[l.jsx(an,{className:"h-4 w-4 mr-2"}),"Sebelumnya"]}),l.jsxs(D,{className:"flex-1 bg-gradient-to-r from-blue-600 to-orange-500 hover:from-blue-700 hover:to-orange-600",onClick:a,children:[r===Le.length-1?"Selesai":"Selanjutnya",r<Le.length-1&&l.jsx(Wr,{className:"h-4 w-4 ml-2"})]})]})]})]})})}function ta({onMenuClick:t,onSearchClick:e}){const{isAuthenticated:r,user:s,profile:n,cart:a,getSelectedItems:i,removeFromCart:o,updateQuantity:c,toggleItemSelection:u,isDarkMode:d,toggleDarkMode:h,soundEnabled:p,toggleSound:f}=X(),[m,b]=v.useState(!1),[g,y]=v.useState(!1),_=i(),E=a.reduce((T,A)=>T+A.quantity,0),w=_.reduce((T,A)=>T+A.price*A.quantity,0),x=()=>{p&&O.playClick(),b(!0)},k=()=>{p&&O.playClick(),y(!0)};return l.jsxs(l.Fragment,{children:[l.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 bg-gradient-to-r from-blue-600 via-blue-500 to-orange-500 shadow-lg",children:l.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[l.jsx(D,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/20",onClick:t,children:l.jsx(on,{className:"h-6 w-6"})}),l.jsxs(ce,{to:"/",className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-8 h-8 bg-white rounded-lg flex items-center justify-center shadow-md",children:l.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-orange-500 bg-clip-text text-transparent font-bold text-lg",children:"L"})}),l.jsx("span",{className:"text-white font-semibold hidden sm:block",children:"Layanan Digital"})]}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(D,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/20",onClick:k,title:"Cara Penggunaan",children:l.jsx(ln,{className:"h-5 w-5"})}),l.jsx(D,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/20 hidden sm:flex",onClick:f,title:p?"Matikan Suara":"Nyalakan Suara",children:p?l.jsx(cn,{className:"h-5 w-5"}):l.jsx(un,{className:"h-5 w-5"})}),l.jsx(D,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/20 hidden sm:flex",onClick:h,title:d?"Mode Terang":"Mode Gelap",children:d?l.jsx(dn,{className:"h-5 w-5"}):l.jsx(hn,{className:"h-5 w-5"})}),l.jsx(D,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/20",onClick:e,children:l.jsx(Mr,{className:"h-5 w-5"})}),l.jsxs(zn,{open:m,onOpenChange:b,children:[l.jsx(Jn,{asChild:!0,children:l.jsxs(D,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/20 relative",onClick:x,children:[l.jsx(Ie,{className:"h-5 w-5"}),E>0&&l.jsx("span",{className:"absolute -top-1 -right-1 bg-orange-500 text-white text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center animate-bounce",children:E})]})}),l.jsxs(Xn,{side:"right",className:`w-full sm:max-w-md ${d?"bg-gray-900 border-gray-700":""}`,children:[l.jsx(Zn,{children:l.jsx(ea,{className:d?"text-white":"",children:"Keranjang Belanja"})}),l.jsx("div",{className:"mt-4",children:a.length===0?l.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[l.jsx(Ie,{className:`h-16 w-16 mb-4 ${d?"text-gray-600":"text-gray-300"}`}),l.jsx("p",{className:d?"text-gray-400":"text-gray-500",children:"Keranjang Anda kosong"}),l.jsx(ce,{to:"/",onClick:()=>b(!1),children:l.jsx(D,{className:"mt-4 bg-gradient-to-r from-blue-600 to-orange-500",children:"Jelajahi Layanan"})})]}):l.jsxs("div",{className:"flex flex-col h-full",children:[l.jsx("div",{className:"flex-1 overflow-auto space-y-3 max-h-[60vh]",children:a.map((T,A)=>l.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg ${d?"bg-gray-800":"bg-gray-50"}`,children:[l.jsx("input",{type:"checkbox",checked:T.selected,onChange:()=>u(A),className:"w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),l.jsx("img",{src:T.image,alt:T.title,className:"w-16 h-16 object-cover rounded-lg"}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:`font-medium text-sm truncate ${d?"text-white":""}`,children:T.title}),l.jsx("p",{className:"text-xs text-gray-500",children:T.tier}),l.jsxs("p",{className:"text-blue-600 font-semibold text-sm",children:["Rp ",(T.price*T.quantity).toLocaleString("id-ID")]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("button",{onClick:()=>c(A,-1),className:`w-6 h-6 rounded flex items-center justify-center ${d?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"-"}),l.jsx("span",{className:`w-6 text-center text-sm ${d?"text-white":""}`,children:T.quantity}),l.jsx("button",{onClick:()=>c(A,1),className:`w-6 h-6 rounded flex items-center justify-center ${d?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"+"})]}),l.jsx("button",{onClick:()=>o(A),className:"text-red-500 hover:text-red-700",children:"Ã—"})]},T.id))}),l.jsxs("div",{className:"border-t pt-4 mt-4",children:[l.jsxs("div",{className:"flex justify-between items-center mb-4",children:[l.jsxs("span",{className:d?"text-gray-400":"text-gray-600",children:["Subtotal (",_.length," item)"]}),l.jsxs("span",{className:"text-xl font-bold text-blue-600",children:["Rp ",w.toLocaleString("id-ID")]})]}),l.jsx(ce,{to:"/checkout",onClick:()=>b(!1),children:l.jsx(D,{className:"w-full bg-gradient-to-r from-blue-600 to-orange-500",disabled:_.length===0,children:"Checkout"})})]})]})})]})]}),r?l.jsx(ce,{to:"/profile",children:l.jsxs(as,{className:"h-8 w-8 border-2 border-white",children:[l.jsx(is,{src:n?.avatar_url||s?.photoURL||""}),l.jsx(os,{className:"bg-orange-500 text-white text-xs",children:(n?.full_name||s?.displayName||"U").charAt(0).toUpperCase()})]})}):l.jsx(ce,{to:"/auth",children:l.jsxs(D,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20",children:[l.jsx(Qe,{className:"h-5 w-5 mr-1"}),l.jsx("span",{className:"hidden sm:inline",children:"Masuk"})]})})]})]})}),l.jsx(ls,{isOpen:g,onClose:()=>y(!1)})]})}function ra(){const t=Br(),{isAuthenticated:e,isDarkMode:r,soundEnabled:s}=X(),n=[{id:"home",label:"Beranda",icon:Fr,path:"/"},{id:"cart",label:"Keranjang",icon:Ie,path:"/cart"},{id:"support",label:"Bantuan",icon:ht,path:"/support"},{id:"profile",label:"Profil",icon:Qe,path:e?"/profile":"/auth"}],a=()=>{s&&O.playClick()};return l.jsx("nav",{className:`fixed bottom-0 left-0 right-0 z-50 border-t shadow-lg ${r?"bg-gray-900 border-gray-700":"bg-white"}`,children:l.jsx("div",{className:"flex justify-around items-center h-16",children:n.map(i=>{const o=i.icon,c=t.pathname===i.path;return l.jsxs(ce,{to:i.path,onClick:a,className:`flex flex-col items-center justify-center w-full h-full transition-all ${c?"text-blue-600":r?"text-gray-400 hover:text-gray-300":"text-gray-400 hover:text-gray-600"}`,children:[l.jsxs("div",{className:`relative ${c?"transform -translate-y-1":""}`,children:[l.jsx(o,{className:`h-5 w-5 mb-1 ${c?"fill-current":""}`}),c&&l.jsx("span",{className:"absolute -bottom-2 left-1/2 -translate-x-1/2 w-1 h-1 bg-blue-600 rounded-full"})]}),l.jsx("span",{className:"text-xs font-medium",children:i.label})]},i.id)})})})}const sa=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class tr extends Error{constructor(e,r="FunctionsError",s){super(e),this.name=r,this.context=s}}class na extends tr{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class fr extends tr{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class pr extends tr{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Bt;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Bt||(Bt={}));class aa{constructor(e,{headers:r={},customFetch:s,region:n=Bt.Any}={}){this.url=e,this.headers=r,this.region=n,this.fetch=sa(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return zs(this,arguments,void 0,function*(r,s={}){var n;let a,i;try{const{headers:o,method:c,body:u,signal:d,timeout:h}=s;let p={},{region:f}=s;f||(f=this.region);const m=new URL(`${this.url}/${r}`);f&&f!=="any"&&(p["x-region"]=f,m.searchParams.set("forceFunctionRegion",f));let b;u&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)?typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(p["Content-Type"]="application/octet-stream",b=u):typeof u=="string"?(p["Content-Type"]="text/plain",b=u):typeof FormData<"u"&&u instanceof FormData?b=u:(p["Content-Type"]="application/json",b=JSON.stringify(u)):u&&typeof u!="string"&&!(typeof Blob<"u"&&u instanceof Blob)&&!(u instanceof ArrayBuffer)&&!(typeof FormData<"u"&&u instanceof FormData)?b=JSON.stringify(u):b=u;let g=d;h&&(i=new AbortController,a=setTimeout(()=>i.abort(),h),d?(g=i.signal,d.addEventListener("abort",()=>i.abort())):g=i.signal);const y=yield this.fetch(m.toString(),{method:c||"POST",headers:Object.assign(Object.assign(Object.assign({},p),this.headers),o),body:b,signal:g}).catch(x=>{throw new na(x)}),_=y.headers.get("x-relay-error");if(_&&_==="true")throw new fr(y);if(!y.ok)throw new pr(y);let E=((n=y.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),w;return E==="application/json"?w=yield y.json():E==="application/octet-stream"||E==="application/pdf"?w=yield y.blob():E==="text/event-stream"?w=y:E==="multipart/form-data"?w=yield y.formData():w=yield y.text(),{data:w,error:null,response:y}}catch(o){return{data:null,error:o,response:o instanceof pr||o instanceof fr?o.context:void 0}}finally{a&&clearTimeout(a)}})}}var ia=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},oa=class{constructor(t){var e,r,s;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(r=t.isMaybeSingle)!==null&&r!==void 0?r:!1,this.urlLengthLimit=(s=t.urlLengthLimit)!==null&&s!==void 0?s:8e3,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var r=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const s=this.fetch;let n=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async a=>{let i=null,o=null,c=null,u=a.status,d=a.statusText;if(a.ok){var h,p;if(r.method!=="HEAD"){var f;const y=await a.text();y===""||(r.headers.get("Accept")==="text/csv"||r.headers.get("Accept")&&(!((f=r.headers.get("Accept"))===null||f===void 0)&&f.includes("application/vnd.pgrst.plan+text"))?o=y:o=JSON.parse(y))}const b=(h=r.headers.get("Prefer"))===null||h===void 0?void 0:h.match(/count=(exact|planned|estimated)/),g=(p=a.headers.get("content-range"))===null||p===void 0?void 0:p.split("/");b&&g&&g.length>1&&(c=parseInt(g[1])),r.isMaybeSingle&&r.method==="GET"&&Array.isArray(o)&&(o.length>1?(i={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,c=null,u=406,d="Not Acceptable"):o.length===1?o=o[0]:o=null)}else{var m;const b=await a.text();try{i=JSON.parse(b),Array.isArray(i)&&a.status===404&&(o=[],i=null,u=200,d="OK")}catch{a.status===404&&b===""?(u=204,d="No Content"):i={message:b}}if(i&&r.isMaybeSingle&&(!(i==null||(m=i.details)===null||m===void 0)&&m.includes("0 rows"))&&(i=null,u=200,d="OK"),i&&r.shouldThrowOnError)throw new ia(i)}return{error:i,data:o,count:c,status:u,statusText:d}});return this.shouldThrowOnError||(n=n.catch(a=>{var i;let o="",c="",u="";const d=a?.cause;if(d){var h,p,f,m;const y=(h=d?.message)!==null&&h!==void 0?h:"",_=(p=d?.code)!==null&&p!==void 0?p:"";o=`${(f=a?.name)!==null&&f!==void 0?f:"FetchError"}: ${a?.message}`,o+=`

Caused by: ${(m=d?.name)!==null&&m!==void 0?m:"Error"}: ${y}`,_&&(o+=` (${_})`),d?.stack&&(o+=`
${d.stack}`)}else{var b;o=(b=a?.stack)!==null&&b!==void 0?b:""}const g=this.url.toString().length;return a?.name==="AbortError"||a?.code==="ABORT_ERR"?(u="",c="Request was aborted (timeout or manual cancellation)",g>this.urlLengthLimit&&(c+=`. Note: Your request URL is ${g} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):(d?.name==="HeadersOverflowError"||d?.code==="UND_ERR_HEADERS_OVERFLOW")&&(u="",c="HTTP headers exceeded server limits (typically 16KB)",g>this.urlLengthLimit&&(c+=`. Your request URL is ${g} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(i=a?.name)!==null&&i!==void 0?i:"FetchError"}: ${a?.message}`,details:o,hint:c,code:u},data:null,count:null,status:0,statusText:""}})),n.then(t,e)}returns(){return this}overrideTypes(){return this}},la=class extends oa{select(t){let e=!1;const r=(t??"*").split("").map(s=>/\s/.test(s)&&!e?"":(s==='"'&&(e=!e),s)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){const a=n?`${n}.order`:"order",i=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${i?`${i},`:""}${t}.${e?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:r=e}={}){const s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${t}`),this}range(t,e,{foreignTable:r,referencedTable:s=r}={}){const n=typeof s>"u"?"offset":`${s}.offset`,a=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${t}`),this.url.searchParams.set(a,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:a="text"}={}){var i;const o=[t?"analyze":null,e?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),c=(i=this.headers.get("Accept"))!==null&&i!==void 0?i:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${a}; for="${c}"; options=${o};`),a==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const mr=new RegExp("[,()]");var Ae=class extends la{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const r=Array.from(new Set(e)).map(s=>typeof s=="string"&&mr.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(t,`in.(${r})`),this}notIn(t,e){const r=Array.from(new Set(e)).map(s=>typeof s=="string"&&mr.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(t,`not.in.(${r})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:r,type:s}={}){let n="";s==="plain"?n="pl":s==="phrase"?n="ph":s==="websearch"&&(n="w");const a=r===void 0?"":`(${r})`;return this.url.searchParams.append(t,`${n}fts${a}.${e}`),this}match(t){return Object.entries(t).forEach(([e,r])=>{this.url.searchParams.append(e,`eq.${r}`)}),this}not(t,e,r){return this.url.searchParams.append(t,`not.${e}.${r}`),this}or(t,{foreignTable:e,referencedTable:r=e}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${t})`),this}filter(t,e,r){return this.url.searchParams.append(t,`${e}.${r}`),this}},ca=class{constructor(t,{headers:e={},schema:r,fetch:s,urlLengthLimit:n=8e3}){this.url=t,this.headers=new Headers(e),this.schema=r,this.fetch=s,this.urlLengthLimit=n}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(t,e){const{head:r=!1,count:s}=e??{},n=r?"HEAD":"GET";let a=!1;const i=(t??"*").split("").map(u=>/\s/.test(u)&&!a?"":(u==='"'&&(a=!a),u)).join(""),{url:o,headers:c}=this.cloneRequestState();return o.searchParams.set("select",i),s&&c.append("Prefer",`count=${s}`),new Ae({method:n,url:o,headers:c,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(t,{count:e,defaultToNull:r=!0}={}){var s;const n="POST",{url:a,headers:i}=this.cloneRequestState();if(e&&i.append("Prefer",`count=${e}`),r||i.append("Prefer","missing=default"),Array.isArray(t)){const o=t.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(o.length>0){const c=[...new Set(o)].map(u=>`"${u}"`);a.searchParams.set("columns",c.join(","))}}return new Ae({method:n,url:a,headers:i,schema:this.schema,body:t,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(t,{onConflict:e,ignoreDuplicates:r=!1,count:s,defaultToNull:n=!0}={}){var a;const i="POST",{url:o,headers:c}=this.cloneRequestState();if(c.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),e!==void 0&&o.searchParams.set("on_conflict",e),s&&c.append("Prefer",`count=${s}`),n||c.append("Prefer","missing=default"),Array.isArray(t)){const u=t.reduce((d,h)=>d.concat(Object.keys(h)),[]);if(u.length>0){const d=[...new Set(u)].map(h=>`"${h}"`);o.searchParams.set("columns",d.join(","))}}return new Ae({method:i,url:o,headers:c,schema:this.schema,body:t,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch,urlLengthLimit:this.urlLengthLimit})}update(t,{count:e}={}){var r;const s="PATCH",{url:n,headers:a}=this.cloneRequestState();return e&&a.append("Prefer",`count=${e}`),new Ae({method:s,url:n,headers:a,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:t}={}){var e;const r="DELETE",{url:s,headers:n}=this.cloneRequestState();return t&&n.append("Prefer",`count=${t}`),new Ae({method:r,url:s,headers:n,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch,urlLengthLimit:this.urlLengthLimit})}};function Fe(t){"@babel/helpers - typeof";return Fe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fe(t)}function ua(t,e){if(Fe(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,e);if(Fe(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function da(t){var e=ua(t,"string");return Fe(e)=="symbol"?e:e+""}function ha(t,e,r){return(e=da(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function gr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function tt(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?gr(Object(r),!0).forEach(function(s){ha(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):gr(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}var fa=class cs{constructor(e,{headers:r={},schema:s,fetch:n,timeout:a,urlLengthLimit:i=8e3}={}){this.url=e,this.headers=new Headers(r),this.schemaName=s,this.urlLengthLimit=i;const o=n??globalThis.fetch;a!==void 0&&a>0?this.fetch=(c,u)=>{const d=new AbortController,h=setTimeout(()=>d.abort(),a),p=u?.signal;if(p){if(p.aborted)return clearTimeout(h),o(c,u);const f=()=>{clearTimeout(h),d.abort()};return p.addEventListener("abort",f,{once:!0}),o(c,tt(tt({},u),{},{signal:d.signal})).finally(()=>{clearTimeout(h),p.removeEventListener("abort",f)})}return o(c,tt(tt({},u),{},{signal:d.signal})).finally(()=>clearTimeout(h))}:this.fetch=o}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new ca(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(e){return new cs(this.url,{headers:this.headers,schema:e,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(e,r={},{head:s=!1,get:n=!1,count:a}={}){var i;let o;const c=new URL(`${this.url}/rpc/${e}`);let u;const d=f=>f!==null&&typeof f=="object"&&(!Array.isArray(f)||f.some(d)),h=s&&Object.values(r).some(d);h?(o="POST",u=r):s||n?(o=s?"HEAD":"GET",Object.entries(r).filter(([f,m])=>m!==void 0).map(([f,m])=>[f,Array.isArray(m)?`{${m.join(",")}}`:`${m}`]).forEach(([f,m])=>{c.searchParams.append(f,m)})):(o="POST",u=r);const p=new Headers(this.headers);return h?p.set("Prefer",a?`count=${a},return=minimal`:"return=minimal"):a&&p.set("Prefer",`count=${a}`),new Ae({method:o,url:c,headers:p,schema:this.schemaName,body:u,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch,urlLengthLimit:this.urlLengthLimit})}};class pa{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const r=globalThis.process;if(r){const s=r.versions;if(s&&s.node){const n=s.node,a=parseInt(n.replace(/^v/,"").split(".")[0]);return a>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${a} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${a} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let r=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(r+=`

Suggested solution: ${e.workaround}`),new Error(r)}static createWebSocket(e,r){const s=this.getWebSocketConstructor();return new s(e,r)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const ma="2.95.3",ga=`realtime-js/${ma}`,ya="1.0.0",us="2.0.0",yr=us,Mt=1e4,ba=1e3,wa=100;var oe;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(oe||(oe={}));var U;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(U||(U={}));var Q;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Q||(Q={}));var qt;(function(t){t.websocket="websocket"})(qt||(qt={}));var be;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(be||(be={}));class va{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,r){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(e));let s=[e.join_ref,e.ref,e.topic,e.event,e.payload];return r(JSON.stringify(s))}_binaryEncodeUserBroadcastPush(e){var r;return this._isArrayBuffer((r=e.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var r,s;const n=(s=(r=e.payload)===null||r===void 0?void 0:r.payload)!==null&&s!==void 0?s:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,n)}_encodeJsonUserBroadcastPush(e){var r,s;const n=(s=(r=e.payload)===null||r===void 0?void 0:r.payload)!==null&&s!==void 0?s:{},i=new TextEncoder().encode(JSON.stringify(n)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,i)}_encodeUserBroadcastPush(e,r,s){var n,a;const i=e.topic,o=(n=e.ref)!==null&&n!==void 0?n:"",c=(a=e.join_ref)!==null&&a!==void 0?a:"",u=e.payload.event,d=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},h=Object.keys(d).length===0?"":JSON.stringify(d);if(c.length>255)throw new Error(`joinRef length ${c.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`ref length ${o.length} exceeds maximum of 255`);if(i.length>255)throw new Error(`topic length ${i.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`userEvent length ${u.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`metadata length ${h.length} exceeds maximum of 255`);const p=this.USER_BROADCAST_PUSH_META_LENGTH+c.length+o.length+i.length+u.length+h.length,f=new ArrayBuffer(this.HEADER_LENGTH+p);let m=new DataView(f),b=0;m.setUint8(b++,this.KINDS.userBroadcastPush),m.setUint8(b++,c.length),m.setUint8(b++,o.length),m.setUint8(b++,i.length),m.setUint8(b++,u.length),m.setUint8(b++,h.length),m.setUint8(b++,r),Array.from(c,y=>m.setUint8(b++,y.charCodeAt(0))),Array.from(o,y=>m.setUint8(b++,y.charCodeAt(0))),Array.from(i,y=>m.setUint8(b++,y.charCodeAt(0))),Array.from(u,y=>m.setUint8(b++,y.charCodeAt(0))),Array.from(h,y=>m.setUint8(b++,y.charCodeAt(0)));var g=new Uint8Array(f.byteLength+s.byteLength);return g.set(new Uint8Array(f),0),g.set(new Uint8Array(s),f.byteLength),g.buffer}decode(e,r){if(this._isArrayBuffer(e)){let s=this._binaryDecode(e);return r(s)}if(typeof e=="string"){const s=JSON.parse(e),[n,a,i,o,c]=s;return r({join_ref:n,ref:a,topic:i,event:o,payload:c})}return r({})}_binaryDecode(e){const r=new DataView(e),s=r.getUint8(0),n=new TextDecoder;if(s===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,r,n)}_decodeUserBroadcast(e,r,s){const n=r.getUint8(1),a=r.getUint8(2),i=r.getUint8(3),o=r.getUint8(4);let c=this.HEADER_LENGTH+4;const u=s.decode(e.slice(c,c+n));c=c+n;const d=s.decode(e.slice(c,c+a));c=c+a;const h=s.decode(e.slice(c,c+i));c=c+i;const p=e.slice(c,e.byteLength),f=o===this.JSON_ENCODING?JSON.parse(s.decode(p)):p,m={type:this.BROADCAST_EVENT,event:d,payload:f};return i>0&&(m.meta=JSON.parse(h)),{join_ref:null,ref:null,topic:u,event:this.BROADCAST_EVENT,payload:m}}_isArrayBuffer(e){var r;return e instanceof ArrayBuffer||((r=e?.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}_pick(e,r){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([s])=>r.includes(s)))}}class ds{constructor(e,r){this.callback=e,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var N;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(N||(N={}));const br=(t,e,r={})=>{var s;const n=(s=r.skipTypes)!==null&&s!==void 0?s:[];return e?Object.keys(e).reduce((a,i)=>(a[i]=_a(i,t,e,n),a),{}):{}},_a=(t,e,r,s)=>{const n=e.find(o=>o.name===t),a=n?.type,i=r[t];return a&&!s.includes(a)?hs(a,i):Kt(i)},hs=(t,e)=>{if(t.charAt(0)==="_"){const r=t.slice(1,t.length);return Ea(e,r)}switch(t){case N.bool:return xa(e);case N.float4:case N.float8:case N.int2:case N.int4:case N.int8:case N.numeric:case N.oid:return ka(e);case N.json:case N.jsonb:return Sa(e);case N.timestamp:return ja(e);case N.abstime:case N.date:case N.daterange:case N.int4range:case N.int8range:case N.money:case N.reltime:case N.text:case N.time:case N.timestamptz:case N.timetz:case N.tsrange:case N.tstzrange:return Kt(e);default:return Kt(e)}},Kt=t=>t,xa=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},ka=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},Sa=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},Ea=(t,e)=>{if(typeof t!="string")return t;const r=t.length-1,s=t[r];if(t[0]==="{"&&s==="}"){let a;const i=t.slice(1,r);try{a=JSON.parse("["+i+"]")}catch{a=i?i.split(","):[]}return a.map(o=>hs(e,o))}return t},ja=t=>typeof t=="string"?t.replace(" ","T"):t,fs=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Et{constructor(e,r,s={},n=Mt){this.channel=e,this.event=r,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,r){var s;return this._hasReceived(e)&&r((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:r}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var wr;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(wr||(wr={}));class qe{constructor(e,r){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{const{onJoin:a,onLeave:i,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=qe.syncState(this.state,n,a,i),this.pendingDiffs.forEach(c=>{this.state=qe.syncDiff(this.state,c,a,i)}),this.pendingDiffs=[],o()}),this.channel._on(s.diff,{},n=>{const{onJoin:a,onLeave:i,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=qe.syncDiff(this.state,n,a,i),o())}),this.onJoin((n,a,i)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:a,newPresences:i})}),this.onLeave((n,a,i)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:a,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,r,s,n){const a=this.cloneDeep(e),i=this.transformState(r),o={},c={};return this.map(a,(u,d)=>{i[u]||(c[u]=d)}),this.map(i,(u,d)=>{const h=a[u];if(h){const p=d.map(g=>g.presence_ref),f=h.map(g=>g.presence_ref),m=d.filter(g=>f.indexOf(g.presence_ref)<0),b=h.filter(g=>p.indexOf(g.presence_ref)<0);m.length>0&&(o[u]=m),b.length>0&&(c[u]=b)}else o[u]=d}),this.syncDiff(a,{joins:o,leaves:c},s,n)}static syncDiff(e,r,s,n){const{joins:a,leaves:i}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(a,(o,c)=>{var u;const d=(u=e[o])!==null&&u!==void 0?u:[];if(e[o]=this.cloneDeep(c),d.length>0){const h=e[o].map(f=>f.presence_ref),p=d.filter(f=>h.indexOf(f.presence_ref)<0);e[o].unshift(...p)}s(o,d,c)}),this.map(i,(o,c)=>{let u=e[o];if(!u)return;const d=c.map(h=>h.presence_ref);u=u.filter(h=>d.indexOf(h.presence_ref)<0),e[o]=u,n(o,u,c),u.length===0&&delete e[o]}),e}static map(e,r){return Object.getOwnPropertyNames(e).map(s=>r(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((r,s)=>{const n=e[s];return"metas"in n?r[s]=n.metas.map(a=>(a.presence_ref=a.phx_ref,delete a.phx_ref,delete a.phx_ref_prev,a)):r[s]=n,r},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var vr;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(vr||(vr={}));var Ke;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Ke||(Ke={}));var te;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(te||(te={}));class Ne{constructor(e,r={config:{}},s){var n,a;if(this.topic=e,this.params=r,this.socket=s,this.bindings={},this.state=U.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new Et(this,Q.join,this.params,this.timeout),this.rejoinTimer=new ds(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=U.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=U.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=U.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=U.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=U.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Q.reply,{},(i,o)=>{this._trigger(this._replyEventName(o),i)}),this.presence=new qe(this),this.broadcastEndpointURL=fs(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((a=(n=this.params.config)===null||n===void 0?void 0:n.broadcast)===null||a===void 0)&&a.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,r=this.timeout){var s,n,a;if(this.socket.isConnected()||this.socket.connect(),this.state==U.closed){const{config:{broadcast:i,presence:o,private:c}}=this.params,u=(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(f=>f.filter))!==null&&n!==void 0?n:[],d=!!this.bindings[Ke.PRESENCE]&&this.bindings[Ke.PRESENCE].length>0||((a=this.params.config.presence)===null||a===void 0?void 0:a.enabled)===!0,h={},p={broadcast:i,presence:Object.assign(Object.assign({},o),{enabled:d}),postgres_changes:u,private:c};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(f=>e?.(te.CHANNEL_ERROR,f)),this._onClose(()=>e?.(te.CLOSED)),this.updateJoinPayload(Object.assign({config:p},h)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:f})=>{var m;if(this.socket._isManualToken()||this.socket.setAuth(),f===void 0){e?.(te.SUBSCRIBED);return}else{const b=this.bindings.postgres_changes,g=(m=b?.length)!==null&&m!==void 0?m:0,y=[];for(let _=0;_<g;_++){const E=b[_],{filter:{event:w,schema:x,table:k,filter:T}}=E,A=f&&f[_];if(A&&A.event===w&&Ne.isFilterValueEqual(A.schema,x)&&Ne.isFilterValueEqual(A.table,k)&&Ne.isFilterValueEqual(A.filter,T))y.push(Object.assign(Object.assign({},E),{id:A.id}));else{this.unsubscribe(),this.state=U.errored,e?.(te.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(te.SUBSCRIBED);return}}).receive("error",f=>{this.state=U.errored,e?.(te.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e?.(te.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,r={}){return await this.send({type:"presence",event:"track",payload:e},r.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,r,s){return this.state===U.joined&&e===Ke.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,r,s)}async httpSend(e,r,s={}){var n;if(r==null)return Promise.reject("Payload is required for httpSend()");const a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const i={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:r,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,i,(n=s.timeout)!==null&&n!==void 0?n:this.timeout);if(o.status===202)return{success:!0};let c=o.statusText;try{const u=await o.json();c=u.error||u.message||c}catch{}return Promise.reject(new Error(c))}async send(e,r={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){const{event:a,payload:i}=e,o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(o.Authorization=`Bearer ${this.socket.accessTokenValue}`);const c={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:i,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=r.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=u.body)===null||n===void 0?void 0:n.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(a=>{var i,o,c;const u=this._push(e.type,e,r.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(o=(i=this.params)===null||i===void 0?void 0:i.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&a("ok"),u.receive("ok",()=>a("ok")),u.receive("error",()=>a("error")),u.receive("timeout",()=>a("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=U.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Q.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(n=>{s=new Et(this,Q.leave,{},e),s.receive("ok",()=>{r(),n("ok")}).receive("timeout",()=>{r(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=U.closed,this.bindings={}}async _fetchWithTimeout(e,r,s){const n=new AbortController,a=setTimeout(()=>n.abort(),s),i=await this.socket.fetch(e,Object.assign(Object.assign({},r),{signal:n.signal}));return clearTimeout(a),i}_push(e,r,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Et(this,e,r,s);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>wa){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(e,r,s){return r}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,r,s){var n,a;const i=e.toLocaleLowerCase(),{close:o,error:c,leave:u,join:d}=Q;if(s&&[o,c,u,d].indexOf(i)>=0&&s!==this._joinRef())return;let p=this._onMessage(i,r,s);if(r&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(f=>{var m,b,g;return((m=f.filter)===null||m===void 0?void 0:m.event)==="*"||((g=(b=f.filter)===null||b===void 0?void 0:b.event)===null||g===void 0?void 0:g.toLocaleLowerCase())===i}).map(f=>f.callback(p,s)):(a=this.bindings[i])===null||a===void 0||a.filter(f=>{var m,b,g,y,_,E;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in f){const w=f.id,x=(m=f.filter)===null||m===void 0?void 0:m.event;return w&&((b=r.ids)===null||b===void 0?void 0:b.includes(w))&&(x==="*"||x?.toLocaleLowerCase()===((g=r.data)===null||g===void 0?void 0:g.type.toLocaleLowerCase()))}else{const w=(_=(y=f?.filter)===null||y===void 0?void 0:y.event)===null||_===void 0?void 0:_.toLocaleLowerCase();return w==="*"||w===((E=r?.event)===null||E===void 0?void 0:E.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===i}).map(f=>{if(typeof p=="object"&&"ids"in p){const m=p.data,{schema:b,table:g,commit_timestamp:y,type:_,errors:E}=m;p=Object.assign(Object.assign({},{schema:b,table:g,commit_timestamp:y,eventType:_,new:{},old:{},errors:E}),this._getPayloadRecords(m))}f.callback(p,s)})}_isClosed(){return this.state===U.closed}_isJoined(){return this.state===U.joined}_isJoining(){return this.state===U.joining}_isLeaving(){return this.state===U.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,r,s){const n=e.toLocaleLowerCase(),a={type:n,filter:r,callback:s};return this.bindings[n]?this.bindings[n].push(a):this.bindings[n]=[a],this}_off(e,r){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(n=>{var a;return!(((a=n.type)===null||a===void 0?void 0:a.toLocaleLowerCase())===s&&Ne.isEqual(n.filter,r))})),this}static isEqual(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const s in e)if(e[s]!==r[s])return!1;return!0}static isFilterValueEqual(e,r){return(e??void 0)===(r??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Q.close,{},e)}_onError(e){this._on(Q.error,{},r=>e(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=U.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const r={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(r.new=br(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(r.old=br(e.columns,e.old_record)),r}}const jt=()=>{},rt={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Ra=[1e3,2e3,5e3,1e4],Ta=1e4,Aa=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Ca{constructor(e,r){var s;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Mt,this.transport=null,this.heartbeatIntervalMs=rt.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=jt,this.ref=0,this.reconnectTimer=null,this.vsn=yr,this.logger=jt,this.conn=null,this.sendBuffer=[],this.serializer=new va,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=n=>n?(...a)=>n(...a):(...a)=>fetch(...a),!(!((s=r?.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${e}/${qt.websocket}`,this.httpEndpoint=fs(e),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=pa.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const r=e.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const r=await e.unsubscribe();return r==="ok"&&this._remove(e),this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const e=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,r,s){this.logger(e,r,s)}connectionState(){switch(this.conn&&this.conn.readyState){case oe.connecting:return be.Connecting;case oe.open:return be.Open;case oe.closing:return be.Closing;default:return be.Closed}}isConnected(){return this.connectionState()===be.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,r={config:{}}){const s=`realtime:${e}`,n=this.getChannels().find(a=>a.topic===s);if(n)return n;{const a=new Ne(`realtime:${e}`,r,this);return this.channels.push(a),a}}push(e){const{topic:r,event:s,payload:n,ref:a}=e,i=()=>{this.encode(e,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${r} ${s} (${a})`,n),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(ba,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},rt.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let r=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${e}"`),r.unsubscribe())}_remove(e){this.channels=this.channels.filter(r=>r.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply"&&r.ref&&r.ref===this.pendingHeartbeatRef){const u=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error",u)}catch(d){this.log("error","error in heartbeat callback",d)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:s,event:n,payload:a,ref:i}=r,o=i?`(${i})`:"",c=a.status||"";this.log("receive",`${c} ${s} ${n} ${o}`.trim(),a),this.channels.filter(u=>u._isMember(s)).forEach(u=>u._trigger(n,a,i)),this._triggerStateCallbacks("message",r)})}_clearTimer(e){var r;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===oe.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===oe.open||this.conn.readyState===oe.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this._terminateWorker()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var r;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e);try{this.heartbeatCallback("error")}catch(r){this.log("error","error in heartbeat callback",r)}}_triggerChanError(){this.channels.forEach(e=>e._trigger(Q.error))}_appendParams(e,r){if(Object.keys(r).length===0)return e;const s=e.match(/\?/)?"&":"?",n=new URLSearchParams(r);return`${e}${s}${n}`}_workerObjectUrl(e){let r;if(e)r=e;else{const s=new Blob([Aa],{type:"application/javascript"});r=URL.createObjectURL(s)}return r}_setConnectionState(e,r=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(e=null){let r,s=!1;if(e)r=e,s=!0;else if(this.accessToken)try{r=await this.accessToken()}catch(n){this.log("error","Error fetching access token from callback",n),r=this.accessTokenValue}else r=this.accessTokenValue;s?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const a={access_token:r,version:ga};r&&n.updateJoinPayload(a),n.joinedOnce&&n._isJoined()&&n._push(Q.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(r=>{this.log("error",`Error setting auth in ${e}`,r)})}_triggerStateCallbacks(e,r){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(r)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new ds(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},rt.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var r,s,n,a,i,o,c,u,d,h,p,f;switch(this.transport=(r=e?.transport)!==null&&r!==void 0?r:null,this.timeout=(s=e?.timeout)!==null&&s!==void 0?s:Mt,this.heartbeatIntervalMs=(n=e?.heartbeatIntervalMs)!==null&&n!==void 0?n:rt.HEARTBEAT_INTERVAL,this.worker=(a=e?.worker)!==null&&a!==void 0?a:!1,this.accessToken=(i=e?.accessToken)!==null&&i!==void 0?i:null,this.heartbeatCallback=(o=e?.heartbeatCallback)!==null&&o!==void 0?o:jt,this.vsn=(c=e?.vsn)!==null&&c!==void 0?c:yr,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(u=e?.reconnectAfterMs)!==null&&u!==void 0?u:(m=>Ra[m-1]||Ta),this.vsn){case ya:this.encode=(d=e?.encode)!==null&&d!==void 0?d:((m,b)=>b(JSON.stringify(m))),this.decode=(h=e?.decode)!==null&&h!==void 0?h:((m,b)=>b(JSON.parse(m)));break;case us:this.encode=(p=e?.encode)!==null&&p!==void 0?p:this.serializer.encode.bind(this.serializer),this.decode=(f=e?.decode)!==null&&f!==void 0?f:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}var Ve=class extends Error{constructor(t,e){super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&e.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function Pa(t,e,r){const s=new URL(e,t);if(r)for(const[n,a]of Object.entries(r))a!==void 0&&s.searchParams.set(n,a);return s.toString()}async function Na(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function Oa(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:r,path:s,query:n,body:a,headers:i}){const o=Pa(t.baseUrl,s,n),c=await Na(t.auth),u=await e(o,{method:r,headers:{...a?{"Content-Type":"application/json"}:{},...c,...i},body:a?JSON.stringify(a):void 0}),d=await u.text(),h=(u.headers.get("content-type")||"").includes("application/json"),p=h&&d?JSON.parse(d):d;if(!u.ok){const f=h?p:void 0,m=f?.error;throw new Ve(m?.message??`Request failed with status ${u.status}`,{status:u.status,icebergType:m?.type,icebergCode:m?.code,details:f})}return{status:u.status,headers:u.headers,data:p}}}}function st(t){return t.join("")}var Ia=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:st(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(s=>({namespace:s}))}async createNamespace(t,e){const r={namespace:t.namespace,properties:e?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${st(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${st(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${st(t.namespace)}`}),!0}catch(e){if(e instanceof Ve&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(r){if(r instanceof Ve&&r.status===409)return;throw r}}};function ke(t){return t.join("")}var $a=class{constructor(t,e="",r){this.client=t,this.prefix=e,this.accessDelegation=r}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ke(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ke(t.namespace)}/tables`,body:e,headers:r})).data.metadata}async updateTable(t,e){const r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ke(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${ke(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String(e?.purge??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ke(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${ke(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(r){if(r instanceof Ve&&r.status===404)return!1;throw r}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(r){if(r instanceof Ve&&r.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw r}}},La=class{constructor(t){let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const r=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=Oa({baseUrl:r,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=t.accessDelegation?.join(","),this.namespaceOps=new Ia(this.client,e),this.tableOps=new $a(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},bt=class extends Error{constructor(t,e="storage",r,s){super(t),this.__isStorageError=!0,this.namespace=e,this.name=e==="vectors"?"StorageVectorsError":"StorageError",this.status=r,this.statusCode=s}};function wt(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var nt=class extends bt{constructor(t,e,r,s="storage"){super(t,s,e,r),this.name=s==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=e,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},ps=class extends bt{constructor(t,e,r="storage"){super(t,r),this.name=r==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=e}};const Ua=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),Da=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Wt=t=>{if(Array.isArray(t))return t.map(r=>Wt(r));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([r,s])=>{const n=r.replace(/([-_][a-z])/gi,a=>a.toUpperCase().replace(/[-_]/g,""));e[n]=Wt(s)}),e},Ba=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function He(t){"@babel/helpers - typeof";return He=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},He(t)}function Ma(t,e){if(He(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,e);if(He(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function qa(t){var e=Ma(t,"string");return He(e)=="symbol"?e:e+""}function Ka(t,e,r){return(e=qa(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _r(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function R(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?_r(Object(r),!0).forEach(function(s){Ka(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_r(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}const xr=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},Wa=async(t,e,r,s)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!r?.noResolveJson){const n=t,a=n.status||500;if(typeof n.json=="function")n.json().then(i=>{const o=i?.statusCode||i?.code||a+"";e(new nt(xr(i),a,o,s))}).catch(()=>{if(s==="vectors"){const i=a+"";e(new nt(n.statusText||`HTTP ${a} error`,a,i,s))}else{const i=a+"";e(new nt(n.statusText||`HTTP ${a} error`,a,i,s))}});else{const i=a+"";e(new nt(n.statusText||`HTTP ${a} error`,a,i,s))}}else e(new ps(xr(t),t,s))},Fa=(t,e,r,s)=>{const n={method:t,headers:e?.headers||{}};return t==="GET"||t==="HEAD"||!s?R(R({},n),r):(Da(s)?(n.headers=R({"Content-Type":"application/json"},e?.headers),n.body=JSON.stringify(s)):n.body=s,e?.duplex&&(n.duplex=e.duplex),R(R({},n),r))};async function Ue(t,e,r,s,n,a,i){return new Promise((o,c)=>{t(r,Fa(e,s,n,a)).then(u=>{if(!u.ok)throw u;if(s?.noResolveJson)return u;if(i==="vectors"){const d=u.headers.get("content-type");if(u.headers.get("content-length")==="0"||u.status===204)return{};if(!d||!d.includes("application/json"))return{}}return u.json()}).then(u=>o(u)).catch(u=>Wa(u,c,s,i))})}function ms(t="storage"){return{get:async(e,r,s,n)=>Ue(e,"GET",r,s,n,void 0,t),post:async(e,r,s,n,a)=>Ue(e,"POST",r,n,a,s,t),put:async(e,r,s,n,a)=>Ue(e,"PUT",r,n,a,s,t),head:async(e,r,s,n)=>Ue(e,"HEAD",r,R(R({},s),{},{noResolveJson:!0}),n,void 0,t),remove:async(e,r,s,n,a)=>Ue(e,"DELETE",r,n,a,s,t)}}const Va=ms("storage"),{get:Ge,post:Y,put:Ft,head:Ha,remove:rr}=Va,V=ms("vectors");var $e=class{constructor(t,e={},r,s="storage"){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.fetch=Ua(r),this.namespace=s}throwOnError(){return this.shouldThrowOnError=!0,this}async handleOperation(t){var e=this;try{return{data:await t(),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(wt(r))return{data:null,error:r};throw r}}},Ga=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(wt(e))return{data:null,error:e};throw e}}};let gs;gs=Symbol.toStringTag;var za=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[gs]="BlobDownloadBuilder",this.promise=null}asStream(){return new Ga(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(wt(e))return{data:null,error:e};throw e}}};const Ja={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},kr={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var Ya=class extends $e{constructor(t,e={},r,s){super(t,e,s,"storage"),this.bucketId=r}async uploadOrUpdate(t,e,r,s){var n=this;return n.handleOperation(async()=>{let a;const i=R(R({},kr),s);let o=R(R({},n.headers),t==="POST"&&{"x-upsert":String(i.upsert)});const c=i.metadata;typeof Blob<"u"&&r instanceof Blob?(a=new FormData,a.append("cacheControl",i.cacheControl),c&&a.append("metadata",n.encodeMetadata(c)),a.append("",r)):typeof FormData<"u"&&r instanceof FormData?(a=r,a.has("cacheControl")||a.append("cacheControl",i.cacheControl),c&&!a.has("metadata")&&a.append("metadata",n.encodeMetadata(c))):(a=r,o["cache-control"]=`max-age=${i.cacheControl}`,o["content-type"]=i.contentType,c&&(o["x-metadata"]=n.toBase64(n.encodeMetadata(c))),(typeof ReadableStream<"u"&&a instanceof ReadableStream||a&&typeof a=="object"&&"pipe"in a&&typeof a.pipe=="function")&&!i.duplex&&(i.duplex="half")),s?.headers&&(o=R(R({},o),s.headers));const u=n._removeEmptyFolders(e),d=n._getFinalPath(u),h=await(t=="PUT"?Ft:Y)(n.fetch,`${n.url}/object/${d}`,a,R({headers:o},i?.duplex?{duplex:i.duplex}:{}));return{path:u,id:h.Id,fullPath:h.Key}})}async upload(t,e,r){return this.uploadOrUpdate("POST",t,e,r)}async uploadToSignedUrl(t,e,r,s){var n=this;const a=n._removeEmptyFolders(t),i=n._getFinalPath(a),o=new URL(n.url+`/object/upload/sign/${i}`);return o.searchParams.set("token",e),n.handleOperation(async()=>{let c;const u=R({upsert:kr.upsert},s),d=R(R({},n.headers),{"x-upsert":String(u.upsert)});return typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",u.cacheControl)):(c=r,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType),{path:a,fullPath:(await Ft(n.fetch,o.toString(),c,{headers:d})).Key}})}async createSignedUploadUrl(t,e){var r=this;return r.handleOperation(async()=>{let s=r._getFinalPath(t);const n=R({},r.headers);e?.upsert&&(n["x-upsert"]="true");const a=await Y(r.fetch,`${r.url}/object/upload/sign/${s}`,{},{headers:n}),i=new URL(r.url+a.url),o=i.searchParams.get("token");if(!o)throw new bt("No token returned by API");return{signedUrl:i.toString(),path:t,token:o}})}async update(t,e,r){return this.uploadOrUpdate("PUT",t,e,r)}async move(t,e,r){var s=this;return s.handleOperation(async()=>await Y(s.fetch,`${s.url}/object/move`,{bucketId:s.bucketId,sourceKey:t,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:s.headers}))}async copy(t,e,r){var s=this;return s.handleOperation(async()=>({path:(await Y(s.fetch,`${s.url}/object/copy`,{bucketId:s.bucketId,sourceKey:t,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:s.headers})).Key}))}async createSignedUrl(t,e,r){var s=this;return s.handleOperation(async()=>{let n=s._getFinalPath(t),a=await Y(s.fetch,`${s.url}/object/sign/${n}`,R({expiresIn:e},r?.transform?{transform:r.transform}:{}),{headers:s.headers});const i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{signedUrl:encodeURI(`${s.url}${a.signedURL}${i}`)}})}async createSignedUrls(t,e,r){var s=this;return s.handleOperation(async()=>{const n=await Y(s.fetch,`${s.url}/object/sign/${s.bucketId}`,{expiresIn:e,paths:t},{headers:s.headers}),a=r?.download?`&download=${r.download===!0?"":r.download}`:"";return n.map(i=>R(R({},i),{},{signedUrl:i.signedURL?encodeURI(`${s.url}${i.signedURL}${a}`):null}))})}download(t,e,r){const s=typeof e?.transform<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString(e?.transform||{}),a=n?`?${n}`:"",i=this._getFinalPath(t),o=()=>Ge(this.fetch,`${this.url}/${s}/${i}${a}`,{headers:this.headers,noResolveJson:!0},r);return new za(o,this.shouldThrowOnError)}async info(t){var e=this;const r=e._getFinalPath(t);return e.handleOperation(async()=>Wt(await Ge(e.fetch,`${e.url}/object/info/${r}`,{headers:e.headers})))}async exists(t){var e=this;const r=e._getFinalPath(t);try{return await Ha(e.fetch,`${e.url}/object/${r}`,{headers:e.headers}),{data:!0,error:null}}catch(s){if(e.shouldThrowOnError)throw s;if(wt(s)&&s instanceof ps){const n=s.originalError;if([400,404].includes(n?.status))return{data:!1,error:s}}throw s}}getPublicUrl(t,e){const r=this._getFinalPath(t),s=[],n=e?.download?`download=${e.download===!0?"":e.download}`:"";n!==""&&s.push(n);const a=typeof e?.transform<"u"?"render/image":"object",i=this.transformOptsToQueryString(e?.transform||{});i!==""&&s.push(i);let o=s.join("&");return o!==""&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${o}`)}}}async remove(t){var e=this;return e.handleOperation(async()=>await rr(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}))}async list(t,e,r){var s=this;return s.handleOperation(async()=>{const n=R(R(R({},Ja),e),{},{prefix:t||""});return await Y(s.fetch,`${s.url}/object/list/${s.bucketId}`,n,{headers:s.headers},r)})}async listV2(t,e){var r=this;return r.handleOperation(async()=>{const s=R({},t);return await Y(r.fetch,`${r.url}/object/list-v2/${r.bucketId}`,s,{headers:r.headers},e)})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const Qa="2.95.3",Xe={"X-Client-Info":`storage-js/${Qa}`};var Xa=class extends $e{constructor(t,e={},r,s){const n=new URL(t);s?.useNewHostname&&/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase."));const a=n.href.replace(/\/$/,""),i=R(R({},Xe),e);super(a,i,r,"storage")}async listBuckets(t){var e=this;return e.handleOperation(async()=>{const r=e.listBucketOptionsToQueryString(t);return await Ge(e.fetch,`${e.url}/bucket${r}`,{headers:e.headers})})}async getBucket(t){var e=this;return e.handleOperation(async()=>await Ge(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}))}async createBucket(t,e={public:!1}){var r=this;return r.handleOperation(async()=>await Y(r.fetch,`${r.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:r.headers}))}async updateBucket(t,e){var r=this;return r.handleOperation(async()=>await Ft(r.fetch,`${r.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:r.headers}))}async emptyBucket(t){var e=this;return e.handleOperation(async()=>await Y(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}))}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await rr(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}))}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},Za=class extends $e{constructor(t,e={},r){const s=t.replace(/\/$/,""),n=R(R({},Xe),e);super(s,n,r,"storage")}async createBucket(t){var e=this;return e.handleOperation(async()=>await Y(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}))}async listBuckets(t){var e=this;return e.handleOperation(async()=>{const r=new URLSearchParams;t?.limit!==void 0&&r.set("limit",t.limit.toString()),t?.offset!==void 0&&r.set("offset",t.offset.toString()),t?.sortColumn&&r.set("sortColumn",t.sortColumn),t?.sortOrder&&r.set("sortOrder",t.sortOrder),t?.search&&r.set("search",t.search);const s=r.toString(),n=s?`${e.url}/bucket?${s}`:`${e.url}/bucket`;return await Ge(e.fetch,n,{headers:e.headers})})}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await rr(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}))}from(t){var e=this;if(!Ba(t))throw new bt("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const r=new La({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),s=this.shouldThrowOnError;return new Proxy(r,{get(n,a){const i=n[a];return typeof i!="function"?i:async(...o)=>{try{return{data:await i.apply(n,o),error:null}}catch(c){if(s)throw c;return{data:null,error:c}}}}})}},ei=class extends $e{constructor(t,e={},r){const s=t.replace(/\/$/,""),n=R(R({},Xe),{},{"Content-Type":"application/json"},e);super(s,n,r,"vectors")}async createIndex(t){var e=this;return e.handleOperation(async()=>await V.post(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{})}async getIndex(t,e){var r=this;return r.handleOperation(async()=>await V.post(r.fetch,`${r.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:r.headers}))}async listIndexes(t){var e=this;return e.handleOperation(async()=>await V.post(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}))}async deleteIndex(t,e){var r=this;return r.handleOperation(async()=>await V.post(r.fetch,`${r.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:r.headers})||{})}},ti=class extends $e{constructor(t,e={},r){const s=t.replace(/\/$/,""),n=R(R({},Xe),{},{"Content-Type":"application/json"},e);super(s,n,r,"vectors")}async putVectors(t){var e=this;if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return e.handleOperation(async()=>await V.post(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{})}async getVectors(t){var e=this;return e.handleOperation(async()=>await V.post(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}))}async listVectors(t){var e=this;if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return e.handleOperation(async()=>await V.post(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}))}async queryVectors(t){var e=this;return e.handleOperation(async()=>await V.post(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}))}async deleteVectors(t){var e=this;if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return e.handleOperation(async()=>await V.post(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{})}},ri=class extends $e{constructor(t,e={},r){const s=t.replace(/\/$/,""),n=R(R({},Xe),{},{"Content-Type":"application/json"},e);super(s,n,r,"vectors")}async createBucket(t){var e=this;return e.handleOperation(async()=>await V.post(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{})}async getBucket(t){var e=this;return e.handleOperation(async()=>await V.post(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}))}async listBuckets(t={}){var e=this;return e.handleOperation(async()=>await V.post(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}))}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await V.post(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{})}},si=class extends ri{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new ni(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,r=this;return e().call(r,t)}async getBucket(t){var e=()=>super.getBucket,r=this;return e().call(r,t)}async listBuckets(t={}){var e=()=>super.listBuckets,r=this;return e().call(r,t)}async deleteBucket(t){var e=()=>super.deleteBucket,r=this;return e().call(r,t)}},ni=class extends ei{constructor(t,e,r,s){super(t,e,s),this.vectorBucketName=r}async createIndex(t){var e=()=>super.createIndex,r=this;return e().call(r,R(R({},t),{},{vectorBucketName:r.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,r=this;return e().call(r,R(R({},t),{},{vectorBucketName:r.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,r=this;return e().call(r,r.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,r=this;return e().call(r,r.vectorBucketName,t)}index(t){return new ai(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},ai=class extends ti{constructor(t,e,r,s,n){super(t,e,n),this.vectorBucketName=r,this.indexName=s}async putVectors(t){var e=()=>super.putVectors,r=this;return e().call(r,R(R({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async getVectors(t){var e=()=>super.getVectors,r=this;return e().call(r,R(R({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,r=this;return e().call(r,R(R({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,r=this;return e().call(r,R(R({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,r=this;return e().call(r,R(R({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}},ii=class extends Xa{constructor(t,e={},r,s){super(t,e,r,s)}from(t){return new Ya(this.url,this.headers,t,this.fetch)}get vectors(){return new si(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Za(this.url+"/iceberg",this.headers,this.fetch)}};const ys="2.95.3",Ce=30*1e3,Vt=3,Rt=Vt*Ce,oi="http://localhost:9999",li="supabase.auth.token",ci={"X-Client-Info":`gotrue-js/${ys}`},Ht="X-Supabase-Api-Version",bs={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},ui=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,di=600*1e3;class ze extends Error{constructor(e,r,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=s}}function S(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class hi extends ze{constructor(e,r,s){super(e,r,s),this.name="AuthApiError",this.status=r,this.code=s}}function fi(t){return S(t)&&t.name==="AuthApiError"}class we extends ze{constructor(e,r){super(e),this.name="AuthUnknownError",this.originalError=r}}class se extends ze{constructor(e,r,s,n){super(e,s,n),this.name=r,this.status=s}}class F extends se{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Tt(t){return S(t)&&t.name==="AuthSessionMissingError"}class Se extends se{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class at extends se{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class it extends se{constructor(e,r=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function pi(t){return S(t)&&t.name==="AuthImplicitGrantRedirectError"}class Sr extends se{constructor(e,r=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class mi extends se{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Gt extends se{constructor(e,r){super(e,"AuthRetryableFetchError",r,void 0)}}function At(t){return S(t)&&t.name==="AuthRetryableFetchError"}class Er extends se{constructor(e,r,s){super(e,"AuthWeakPasswordError",r,"weak_password"),this.reasons=s}}class zt extends se{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const ft="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),jr=` 	
\r=`.split(""),gi=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<jr.length;e+=1)t[jr[e].charCodeAt(0)]=-2;for(let e=0;e<ft.length;e+=1)t[ft[e].charCodeAt(0)]=e;return t})();function Rr(t,e,r){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;r(ft[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;r(ft[s]),e.queuedBits-=6}}function ws(t,e,r){const s=gi[t];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function Tr(t){const e=[],r=i=>{e.push(String.fromCodePoint(i))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},a=i=>{wi(i,s,r)};for(let i=0;i<t.length;i+=1)ws(t.charCodeAt(i),n,a);return e.join("")}function yi(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function bi(t,e){for(let r=0;r<t.length;r+=1){let s=t.charCodeAt(r);if(s>55295&&s<=56319){const n=(s-55296)*1024&65535;s=(t.charCodeAt(r+1)-56320&65535|n)+65536,r+=1}yi(s,e)}}function wi(t,e,r){if(e.utf8seq===0){if(t<=127){r(t);return}for(let s=1;s<6;s+=1)if((t>>7-s&1)===0){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&r(e.codepoint)}}function Oe(t){const e=[],r={queue:0,queuedBits:0},s=n=>{e.push(n)};for(let n=0;n<t.length;n+=1)ws(t.charCodeAt(n),r,s);return new Uint8Array(e)}function vi(t){const e=[];return bi(t,r=>e.push(r)),new Uint8Array(e)}function ve(t){const e=[],r={queue:0,queuedBits:0},s=n=>{e.push(n)};return t.forEach(n=>Rr(n,r,s)),Rr(null,r,s),e.join("")}function _i(t){return Math.round(Date.now()/1e3)+t}function xi(){return Symbol("auth-callback")}const q=()=>typeof window<"u"&&typeof document<"u",fe={tested:!1,writable:!1},vs=()=>{if(!q())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(fe.tested)return fe.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),fe.tested=!0,fe.writable=!0}catch{fe.tested=!0,fe.writable=!1}return fe.writable};function ki(t){const e={},r=new URL(t);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((n,a)=>{e[a]=n})}catch{}return r.searchParams.forEach((s,n)=>{e[n]=s}),e}const _s=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),Si=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Pe=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},pe=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch{return r}},M=async(t,e)=>{await t.removeItem(e)};class vt{constructor(){this.promise=new vt.promiseConstructor((e,r)=>{this.resolve=e,this.reject=r})}}vt.promiseConstructor=Promise;function ot(t){const e=t.split(".");if(e.length!==3)throw new zt("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!ui.test(e[s]))throw new zt("JWT not in base64url format");return{header:JSON.parse(Tr(e[0])),payload:JSON.parse(Tr(e[1])),signature:Oe(e[2]),raw:{header:e[0],payload:e[1]}}}async function Ei(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function ji(t,e){return new Promise((s,n)=>{(async()=>{for(let a=0;a<1/0;a++)try{const i=await t(a);if(!e(a,null,i)){s(i);return}}catch(i){if(!e(a,i)){n(i);return}}})()})}function Ri(t){return("0"+t.toString(16)).substr(-2)}function Ti(){const e=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=r.length;let n="";for(let a=0;a<56;a++)n+=r.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,Ri).join("")}async function Ai(t){const r=new TextEncoder().encode(t),s=await crypto.subtle.digest("SHA-256",r),n=new Uint8Array(s);return Array.from(n).map(a=>String.fromCharCode(a)).join("")}async function Ci(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return t;const r=await Ai(t);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ee(t,e,r=!1){const s=Ti();let n=s;r&&(n+="/PASSWORD_RECOVERY"),await Pe(t,`${e}-code-verifier`,n);const a=await Ci(s);return[a,s===a?"plain":"s256"]}const Pi=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Ni(t){const e=t.headers.get(Ht);if(!e||!e.match(Pi))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Oi(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function Ii(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const $i=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function je(t){if(!$i.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Ct(){const t={};return new Proxy(t,{get:(e,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const s=r.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Li(t,e){return new Proxy(t,{get:(r,s,n)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){const a=s.toString();if(a==="Symbol(Symbol.toPrimitive)"||a==="Symbol(Symbol.toStringTag)"||a==="Symbol(util.inspect.custom)"||a==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,s,n)}return!e.value&&typeof s=="string"&&(e.value=!0),Reflect.get(r,s,n)}})}function Ar(t){return JSON.parse(JSON.stringify(t))}const ye=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Ui=[502,503,504];async function Cr(t){var e;if(!Si(t))throw new Gt(ye(t),0);if(Ui.includes(t.status))throw new Gt(ye(t),t.status);let r;try{r=await t.json()}catch(a){throw new we(ye(a),a)}let s;const n=Ni(t);if(n&&n.getTime()>=bs["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?s=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(s=r.error_code),s){if(s==="weak_password")throw new Er(ye(r),t.status,((e=r.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new F}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((a,i)=>a&&typeof i=="string",!0))throw new Er(ye(r),t.status,r.weak_password.reasons);throw new hi(ye(r),t.status||500,s)}const Di=(t,e,r,s)=>{const n={method:t,headers:e?.headers||{}};return t==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),r))};async function j(t,e,r,s){var n;const a=Object.assign({},s?.headers);a[Ht]||(a[Ht]=bs["2024-01-01"].name),s?.jwt&&(a.Authorization=`Bearer ${s.jwt}`);const i=(n=s?.query)!==null&&n!==void 0?n:{};s?.redirectTo&&(i.redirect_to=s.redirectTo);const o=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",c=await Bi(t,e,r+o,{headers:a,noResolveJson:s?.noResolveJson},{},s?.body);return s?.xform?s?.xform(c):{data:Object.assign({},c),error:null}}async function Bi(t,e,r,s,n,a){const i=Di(e,s,n,a);let o;try{o=await t(r,Object.assign({},i))}catch(c){throw new Gt(ye(c),0)}if(o.ok||await Cr(o),s?.noResolveJson)return o;try{return await o.json()}catch(c){await Cr(c)}}function z(t){var e;let r=null;Ki(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=_i(t.expires_in)));const s=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:r,user:s},error:null}}function Pr(t){const e=z(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((r,s)=>r&&typeof s=="string",!0)&&(e.data.weak_password=t.weak_password),e}function ue(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function Mi(t){return{data:t,error:null}}function qi(t){const{action_link:e,email_otp:r,hashed_token:s,redirect_to:n,verification_type:a}=t,i=yt(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:r,hashed_token:s,redirect_to:n,verification_type:a},c=Object.assign({},i);return{data:{properties:o,user:c},error:null}}function Nr(t){return t}function Ki(t){return t.access_token&&t.refresh_token&&t.expires_in}const Pt=["global","local","others"];class Wi{constructor({url:e="",headers:r={},fetch:s}){this.url=e,this.headers=r,this.fetch=_s(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,r=Pt[0]){if(Pt.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Pt.join(", ")}`);try{return await j(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(S(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,r={}){try{return await j(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:ue})}catch(s){if(S(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:r}=e,s=yt(e,["options"]),n=Object.assign(Object.assign({},s),r);return"newEmail"in s&&(n.new_email=s?.newEmail,delete n.newEmail),await j(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:qi,redirectTo:r?.redirectTo})}catch(r){if(S(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(e){try{return await j(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ue})}catch(r){if(S(r))return{data:{user:null},error:r};throw r}}async listUsers(e){var r,s,n,a,i,o,c;try{const u={nextPage:null,lastPage:0,total:0},d=await j(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(r=e?.page)===null||r===void 0?void 0:r.toString())!==null&&s!==void 0?s:"",per_page:(a=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&a!==void 0?a:""},xform:Nr});if(d.error)throw d.error;const h=await d.json(),p=(i=d.headers.get("x-total-count"))!==null&&i!==void 0?i:0,f=(c=(o=d.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return f.length>0&&(f.forEach(m=>{const b=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(m.split(";")[1].split("=")[1]);u[`${g}Page`]=b}),u.total=parseInt(p)),{data:Object.assign(Object.assign({},h),u),error:null}}catch(u){if(S(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){je(e);try{return await j(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ue})}catch(r){if(S(r))return{data:{user:null},error:r};throw r}}async updateUserById(e,r){je(e);try{return await j(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:r,headers:this.headers,xform:ue})}catch(s){if(S(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,r=!1){je(e);try{return await j(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:r},xform:ue})}catch(s){if(S(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){je(e.userId);try{const{data:r,error:s}=await j(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:r,error:s}}catch(r){if(S(r))return{data:null,error:r};throw r}}async _deleteFactor(e){je(e.userId),je(e.id);try{return{data:await j(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(r){if(S(r))return{data:null,error:r};throw r}}async _listOAuthClients(e){var r,s,n,a,i,o,c;try{const u={nextPage:null,lastPage:0,total:0},d=await j(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(r=e?.page)===null||r===void 0?void 0:r.toString())!==null&&s!==void 0?s:"",per_page:(a=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&a!==void 0?a:""},xform:Nr});if(d.error)throw d.error;const h=await d.json(),p=(i=d.headers.get("x-total-count"))!==null&&i!==void 0?i:0,f=(c=(o=d.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return f.length>0&&(f.forEach(m=>{const b=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(m.split(";")[1].split("=")[1]);u[`${g}Page`]=b}),u.total=parseInt(p)),{data:Object.assign(Object.assign({},h),u),error:null}}catch(u){if(S(u))return{data:{clients:[]},error:u};throw u}}async _createOAuthClient(e){try{return await j(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(S(r))return{data:null,error:r};throw r}}async _getOAuthClient(e){try{return await j(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(S(r))return{data:null,error:r};throw r}}async _updateOAuthClient(e,r){try{return await j(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:r,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(S(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(e){try{return await j(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(S(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(e){try{return await j(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(S(r))return{data:null,error:r};throw r}}}function Or(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}const Re={debug:!!(globalThis&&vs()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class xs extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Fi extends xs{}async function Vi(t,e,r){Re.debug;const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),Re.debug},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){Re.debug;try{return await r()}finally{Re.debug}}else{if(e===0)throw Re.debug,new Fi(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Re.debug)try{const a=await globalThis.navigator.locks.query()}catch{}return await r()}}))}function Hi(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function ks(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function Gi(t){return parseInt(t,16)}function zi(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,s=>s.toString(16).padStart(2,"0")).join("")}function Ji(t){var e;const{chainId:r,domain:s,expirationTime:n,issuedAt:a=new Date,nonce:i,notBefore:o,requestId:c,resources:u,scheme:d,uri:h,version:p}=t;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(i&&i.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${i}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(p!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${p}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const f=ks(t.address),m=d?`${d}://${s}`:s,b=t.statement?`${t.statement}
`:"",g=`${m} wants you to sign in with your Ethereum account:
${f}

${b}`;let y=`URI: ${h}
Version: ${p}
Chain ID: ${r}${i?`
Nonce: ${i}`:""}
Issued At: ${a.toISOString()}`;if(n&&(y+=`
Expiration Time: ${n.toISOString()}`),o&&(y+=`
Not Before: ${o.toISOString()}`),c&&(y+=`
Request ID: ${c}`),u){let _=`
Resources:`;for(const E of u){if(!E||typeof E!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${E}`);_+=`
- ${E}`}y+=_}return`${g}
${y}`}class L extends Error{constructor({message:e,code:r,cause:s,name:n}){var a;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=(a=n??(s instanceof Error?s.name:void 0))!==null&&a!==void 0?a:"Unknown Error",this.code=r}}class pt extends L{constructor(e,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:e}),this.name="WebAuthnUnknownError",this.originalError=r}}function Yi({error:t,options:e}){var r,s,n;const{publicKey:a}=e;if(!a)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new L({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((r=a.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new L({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((s=a.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new L({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((n=a.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new L({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new L({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new L({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return a.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new L({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new L({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const i=window.location.hostname;if(Ss(i)){if(a.rp.id!==i)return new L({message:`The RP ID "${a.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new L({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(a.user.id.byteLength<1||a.user.id.byteLength>64)return new L({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new L({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new L({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function Qi({error:t,options:e}){const{publicKey:r}=e;if(!r)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new L({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new L({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const s=window.location.hostname;if(Ss(s)){if(r.rpId!==s)return new L({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new L({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new L({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new L({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class Xi{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const Zi=new Xi;function eo(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:r,excludeCredentials:s}=t,n=yt(t,["challenge","user","excludeCredentials"]),a=Oe(e).buffer,i=Object.assign(Object.assign({},r),{id:Oe(r.id).buffer}),o=Object.assign(Object.assign({},n),{challenge:a,user:i});if(s&&s.length>0){o.excludeCredentials=new Array(s.length);for(let c=0;c<s.length;c++){const u=s[c];o.excludeCredentials[c]=Object.assign(Object.assign({},u),{id:Oe(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return o}function to(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:r}=t,s=yt(t,["challenge","allowCredentials"]),n=Oe(e).buffer,a=Object.assign(Object.assign({},s),{challenge:n});if(r&&r.length>0){a.allowCredentials=new Array(r.length);for(let i=0;i<r.length;i++){const o=r[i];a.allowCredentials[i]=Object.assign(Object.assign({},o),{id:Oe(o.id).buffer,type:o.type||"public-key",transports:o.transports})}}return a}function ro(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const r=t;return{id:t.id,rawId:t.id,response:{attestationObject:ve(new Uint8Array(t.response.attestationObject)),clientDataJSON:ve(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function so(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const r=t,s=t.getClientExtensionResults(),n=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:ve(new Uint8Array(n.authenticatorData)),clientDataJSON:ve(new Uint8Array(n.clientDataJSON)),signature:ve(new Uint8Array(n.signature)),userHandle:n.userHandle?ve(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Ss(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function Ir(){var t,e;return!!(q()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function no(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new pt("Browser returned unexpected credential type",e)}:{data:null,error:new pt("Empty credential response",e)}}catch(e){return{data:null,error:Yi({error:e,options:t})}}}async function ao(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new pt("Browser returned unexpected credential type",e)}:{data:null,error:new pt("Empty credential response",e)}}catch(e){return{data:null,error:Qi({error:e,options:t})}}}const io={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},oo={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function mt(...t){const e=n=>n!==null&&typeof n=="object"&&!Array.isArray(n),r=n=>n instanceof ArrayBuffer||ArrayBuffer.isView(n),s={};for(const n of t)if(n)for(const a in n){const i=n[a];if(i!==void 0)if(Array.isArray(i))s[a]=i;else if(r(i))s[a]=i;else if(e(i)){const o=s[a];e(o)?s[a]=mt(o,i):s[a]=mt(i)}else s[a]=i}return s}function lo(t,e){return mt(io,t,e||{})}function co(t,e){return mt(oo,t,e||{})}class uo{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:r,friendlyName:s,signal:n},a){var i;try{const{data:o,error:c}=await this.client.mfa.challenge({factorId:e,webauthn:r});if(!o)return{data:null,error:c};const u=n??Zi.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:d}=o.webauthn.credential_options.publicKey;if(!d.name){const h=s;if(h)d.name=`${d.id}:${h}`;else{const f=(await this.client.getUser()).data.user,m=((i=f?.user_metadata)===null||i===void 0?void 0:i.name)||f?.email||f?.id||"User";d.name=`${d.id}:${m}`}}d.displayName||(d.displayName=d.name)}switch(o.webauthn.type){case"create":{const d=lo(o.webauthn.credential_options.publicKey,a?.create),{data:h,error:p}=await no({publicKey:d,signal:u});return h?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:h}},error:null}:{data:null,error:p}}case"request":{const d=co(o.webauthn.credential_options.publicKey,a?.request),{data:h,error:p}=await ao(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:d,signal:u}));return h?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:h}},error:null}:{data:null,error:p}}}}catch(o){return S(o)?{data:null,error:o}:{data:null,error:new we("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:r,webauthn:s}){return this.client.mfa.verify({factorId:r,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},a){if(!r)return{data:null,error:new ze("rpId is required for WebAuthn authentication")};try{if(!Ir())return{data:null,error:new we("Browser does not support WebAuthn",null)};const{data:i,error:o}=await this.challenge({factorId:e,webauthn:{rpId:r,rpOrigins:s},signal:n},{request:a});if(!i)return{data:null,error:o};const{webauthn:c}=i;return this._verify({factorId:e,challengeId:i.challengeId,webauthn:{type:c.type,rpId:r,rpOrigins:s,credential_response:c.credential_response}})}catch(i){return S(i)?{data:null,error:i}:{data:null,error:new we("Unexpected error in authenticate",i)}}}async _register({friendlyName:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},a){if(!r)return{data:null,error:new ze("rpId is required for WebAuthn registration")};try{if(!Ir())return{data:null,error:new we("Browser does not support WebAuthn",null)};const{data:i,error:o}=await this._enroll({friendlyName:e});if(!i)return await this.client.mfa.listFactors().then(d=>{var h;return(h=d.data)===null||h===void 0?void 0:h.all.find(p=>p.factor_type==="webauthn"&&p.friendly_name===e&&p.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d?.id}):void 0),{data:null,error:o};const{data:c,error:u}=await this._challenge({factorId:i.id,friendlyName:i.friendly_name,webauthn:{rpId:r,rpOrigins:s},signal:n},{create:a});return c?this._verify({factorId:i.id,challengeId:c.challengeId,webauthn:{rpId:r,rpOrigins:s,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:u}}catch(i){return S(i)?{data:null,error:i}:{data:null,error:new we("Unexpected error in register",i)}}}}Hi();const ho={url:oi,storageKey:li,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ci,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function $r(t,e,r){return await r()}const Te={};class Je{get jwks(){var e,r;return(r=(e=Te[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(e){Te[this.storageKey]=Object.assign(Object.assign({},Te[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,r;return(r=(e=Te[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Te[this.storageKey]=Object.assign(Object.assign({},Te[this.storageKey]),{cachedAt:e})}constructor(e){var r,s,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const a=Object.assign(Object.assign({},ho),e);if(this.storageKey=a.storageKey,this.instanceID=(r=Je.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,Je.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!a.debug,typeof a.debug=="function"&&(this.logger=a.debug),this.instanceID>0&&q()){const i=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;this.logDebugMessages}if(this.persistSession=a.persistSession,this.autoRefreshToken=a.autoRefreshToken,this.admin=new Wi({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=_s(a.fetch),this.lock=a.lock||$r,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,this.throwOnError=a.throwOnError,this.lockAcquireTimeout=a.lockAcquireTimeout,a.lock?this.lock=a.lock:this.persistSession&&q()&&(!((s=globalThis?.navigator)===null||s===void 0)&&s.locks)?this.lock=Vi:this.lock=$r,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new uo(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:vs()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Or(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=Or(this.memoryStorage)),q()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch{}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i);try{await this._notifyAllSubscribers(i.data.event,i.data.session,!1)}catch(o){this._debug("#broadcastChannel","error",o)}})}this.initialize().catch(i=>{this._debug("#initialize()","error",i)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${ys}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let r={},s="none";if(q()&&(r=ki(window.location.href),this._isImplicitGrantCallback(r)?s="implicit":await this._isPKCECallback(r)&&(s="pkce")),q()&&this.detectSessionInUrl&&s!=="none"){const{data:n,error:a}=await this._getSessionFromURL(r,s);if(a){if(this._debug("#_initialize()","error detecting session from URL",a),pi(a)){const c=(e=a.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:a}}return{error:a}}const{session:i,redirectType:o}=n;return this._debug("#_initialize()","detected session in URL",i,"redirect type",o),await this._saveSession(i),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return S(r)?this._returnResult({error:r}):this._returnResult({error:new we("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,s,n;try{const a=await j(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(r=e?.options)===null||r===void 0?void 0:r.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e?.options)===null||n===void 0?void 0:n.captchaToken}},xform:z}),{data:i,error:o}=a;if(o||!i)return this._returnResult({data:{user:null,session:null},error:o});const c=i.session,u=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:u,session:c},error:null})}catch(a){if(S(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signUp(e){var r,s,n;try{let a;if("email"in e){const{email:d,password:h,options:p}=e;let f=null,m=null;this.flowType==="pkce"&&([f,m]=await Ee(this.storage,this.storageKey)),a=await j(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p?.emailRedirectTo,body:{email:d,password:h,data:(r=p?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:p?.captchaToken},code_challenge:f,code_challenge_method:m},xform:z})}else if("phone"in e){const{phone:d,password:h,options:p}=e;a=await j(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:h,data:(s=p?.data)!==null&&s!==void 0?s:{},channel:(n=p?.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:p?.captchaToken}},xform:z})}else throw new at("You must provide either an email or phone number and a password");const{data:i,error:o}=a;if(o||!i)return await M(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:o});const c=i.session,u=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:u,session:c},error:null})}catch(a){if(await M(this.storage,`${this.storageKey}-code-verifier`),S(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithPassword(e){try{let r;if("email"in e){const{email:a,password:i,options:o}=e;r=await j(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:a,password:i,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:Pr})}else if("phone"in e){const{phone:a,password:i,options:o}=e;r=await j(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:a,password:i,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:Pr})}else throw new at("You must provide either an email or phone number and a password");const{data:s,error:n}=r;if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!s||!s.session||!s.user){const a=new Se;return this._returnResult({data:{user:null,session:null},error:a})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(r){if(S(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(e){var r,s,n,a;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(a=e.options)===null||a===void 0?void 0:a.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:r}=e;switch(r){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(e){var r,s,n,a,i,o,c,u,d,h,p;let f,m;if("message"in e)f=e.message,m=e.signature;else{const{wallet:b,statement:g,options:y}=e;let _;if(q())if(typeof b=="object")_=b;else{const A=window;if("ethereum"in A&&typeof A.ethereum=="object"&&"request"in A.ethereum&&typeof A.ethereum.request=="function")_=A.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!y?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");_=b}const E=new URL((r=y?.url)!==null&&r!==void 0?r:window.location.href),w=await _.request({method:"eth_requestAccounts"}).then(A=>A).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!w||w.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const x=ks(w[0]);let k=(s=y?.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!k){const A=await _.request({method:"eth_chainId"});k=Gi(A)}const T={domain:E.host,address:x,statement:g,uri:E.href,version:"1",chainId:k,nonce:(n=y?.signInWithEthereum)===null||n===void 0?void 0:n.nonce,issuedAt:(i=(a=y?.signInWithEthereum)===null||a===void 0?void 0:a.issuedAt)!==null&&i!==void 0?i:new Date,expirationTime:(o=y?.signInWithEthereum)===null||o===void 0?void 0:o.expirationTime,notBefore:(c=y?.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(u=y?.signInWithEthereum)===null||u===void 0?void 0:u.requestId,resources:(d=y?.signInWithEthereum)===null||d===void 0?void 0:d.resources};f=Ji(T),m=await _.request({method:"personal_sign",params:[zi(f),x]})}try{const{data:b,error:g}=await j(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:m},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:z});if(g)throw g;if(!b||!b.session||!b.user){const y=new Se;return this._returnResult({data:{user:null,session:null},error:y})}return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),this._returnResult({data:Object.assign({},b),error:g})}catch(b){if(S(b))return this._returnResult({data:{user:null,session:null},error:b});throw b}}async signInWithSolana(e){var r,s,n,a,i,o,c,u,d,h,p,f;let m,b;if("message"in e)m=e.message,b=e.signature;else{const{wallet:g,statement:y,options:_}=e;let E;if(q())if(typeof g=="object")E=g;else{const x=window;if("solana"in x&&typeof x.solana=="object"&&("signIn"in x.solana&&typeof x.solana.signIn=="function"||"signMessage"in x.solana&&typeof x.solana.signMessage=="function"))E=x.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof g!="object"||!_?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=g}const w=new URL((r=_?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in E&&E.signIn){const x=await E.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},_?.signInWithSolana),{version:"1",domain:w.host,uri:w.href}),y?{statement:y}:null));let k;if(Array.isArray(x)&&x[0]&&typeof x[0]=="object")k=x[0];else if(x&&typeof x=="object"&&"signedMessage"in x&&"signature"in x)k=x;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in k&&"signature"in k&&(typeof k.signedMessage=="string"||k.signedMessage instanceof Uint8Array)&&k.signature instanceof Uint8Array)m=typeof k.signedMessage=="string"?k.signedMessage:new TextDecoder().decode(k.signedMessage),b=k.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in E)||typeof E.signMessage!="function"||!("publicKey"in E)||typeof E!="object"||!E.publicKey||!("toBase58"in E.publicKey)||typeof E.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${w.host} wants you to sign in with your Solana account:`,E.publicKey.toBase58(),...y?["",y,""]:[""],"Version: 1",`URI: ${w.href}`,`Issued At: ${(n=(s=_?.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((a=_?.signInWithSolana)===null||a===void 0)&&a.notBefore?[`Not Before: ${_.signInWithSolana.notBefore}`]:[],...!((i=_?.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${_.signInWithSolana.expirationTime}`]:[],...!((o=_?.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${_.signInWithSolana.chainId}`]:[],...!((c=_?.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${_.signInWithSolana.nonce}`]:[],...!((u=_?.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${_.signInWithSolana.requestId}`]:[],...!((h=(d=_?.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||h===void 0)&&h.length?["Resources",..._.signInWithSolana.resources.map(k=>`- ${k}`)]:[]].join(`
`);const x=await E.signMessage(new TextEncoder().encode(m),"utf8");if(!x||!(x instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");b=x}}try{const{data:g,error:y}=await j(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:ve(b)},!((p=e.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:z});if(y)throw y;if(!g||!g.session||!g.user){const _=new Se;return this._returnResult({data:{user:null,session:null},error:_})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:Object.assign({},g),error:y})}catch(g){if(S(g))return this._returnResult({data:{user:null,session:null},error:g});throw g}}async _exchangeCodeForSession(e){const r=await pe(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(r??"").split("/");try{if(!s&&this.flowType==="pkce")throw new mi;const{data:a,error:i}=await j(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:z});if(await M(this.storage,`${this.storageKey}-code-verifier`),i)throw i;if(!a||!a.session||!a.user){const o=new Se;return this._returnResult({data:{user:null,session:null,redirectType:null},error:o})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:Object.assign(Object.assign({},a),{redirectType:n??null}),error:i})}catch(a){if(await M(this.storage,`${this.storageKey}-code-verifier`),S(a))return this._returnResult({data:{user:null,session:null,redirectType:null},error:a});throw a}}async signInWithIdToken(e){try{const{options:r,provider:s,token:n,access_token:a,nonce:i}=e,o=await j(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:a,nonce:i,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:z}),{data:c,error:u}=o;if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!c||!c.session||!c.user){const d=new Se;return this._returnResult({data:{user:null,session:null},error:d})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:c,error:u})}catch(r){if(S(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(e){var r,s,n,a,i;try{if("email"in e){const{email:o,options:c}=e;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await Ee(this.storage,this.storageKey));const{error:h}=await j(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(r=c?.data)!==null&&r!==void 0?r:{},create_user:(s=c?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:c?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:h})}if("phone"in e){const{phone:o,options:c}=e,{data:u,error:d}=await j(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(n=c?.data)!==null&&n!==void 0?n:{},create_user:(a=c?.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(i=c?.channel)!==null&&i!==void 0?i:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:u?.message_id},error:d})}throw new at("You must provide either an email or phone number.")}catch(o){if(await M(this.storage,`${this.storageKey}-code-verifier`),S(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async verifyOtp(e){var r,s;try{let n,a;"options"in e&&(n=(r=e.options)===null||r===void 0?void 0:r.redirectTo,a=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:i,error:o}=await j(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:n,xform:z});if(o)throw o;if(!i)throw new Error("An error occurred on token verification.");const c=i.session,u=i.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),this._returnResult({data:{user:u,session:c},error:null})}catch(n){if(S(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithSSO(e){var r,s,n,a,i;try{let o=null,c=null;this.flowType==="pkce"&&([o,c]=await Ee(this.storage,this.storageKey));const u=await j(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e?.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:c}),headers:this.headers,xform:Mi});return!((a=u.data)===null||a===void 0)&&a.url&&q()&&!(!((i=e.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(u.data.url),this._returnResult(u)}catch(o){if(await M(this.storage,`${this.storageKey}-code-verifier`),S(o))return this._returnResult({data:null,error:o});throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:r},error:s}=e;if(s)throw s;if(!r)throw new F;const{error:n}=await j(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:n})})}catch(e){if(S(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const r=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:a}=e,{error:i}=await j(this.fetch,"POST",r,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:a?.captchaToken}},redirectTo:a?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:i})}else if("phone"in e){const{phone:s,type:n,options:a}=e,{data:i,error:o}=await j(this.fetch,"POST",r,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:a?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:i?.message_id},error:o})}throw new at("You must provide either an email or phone number and a type")}catch(r){if(S(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await r()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=r();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const r=await pe(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<Rt:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const i=await pe(this.userStorage,this.storageKey+"-user");i?.user?e.user=i.user:e.user=Ct()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const i={value:this.suppressGetSessionWarning};e.user=Li(e.user,i),i.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:n,error:a}=await this._callRefreshToken(e.refresh_token);return a?this._returnResult({data:{session:null},error:a}):this._returnResult({data:{session:n},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const r=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return r.data.user&&(this.suppressGetSessionWarning=!0),r}async _getUser(e){try{return e?await j(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ue}):await this._useSession(async r=>{var s,n,a;const{data:i,error:o}=r;if(o)throw o;return!(!((s=i.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new F}:await j(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(a=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&a!==void 0?a:void 0,xform:ue})})}catch(r){if(S(r))return Tt(r)&&(await this._removeSession(),await M(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async s=>{const{data:n,error:a}=s;if(a)throw a;if(!n.session)throw new F;const i=n.session;let o=null,c=null;this.flowType==="pkce"&&e.email!=null&&([o,c]=await Ee(this.storage,this.storageKey));const{data:u,error:d}=await j(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:c}),jwt:i.access_token,xform:ue});if(d)throw d;return i.user=u.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),this._returnResult({data:{user:i.user},error:null})})}catch(s){if(await M(this.storage,`${this.storageKey}-code-verifier`),S(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new F;const r=Date.now()/1e3;let s=r,n=!0,a=null;const{payload:i}=ot(e.access_token);if(i.exp&&(s=i.exp,n=s<=r),n){const{data:o,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!o)return{data:{user:null,session:null},error:null};a=o}else{const{data:o,error:c}=await this._getUser(e.access_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});a={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:s-r,expires_at:s},await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)}return this._returnResult({data:{user:a.user,session:a},error:null})}catch(r){if(S(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var s;if(!e){const{data:i,error:o}=r;if(o)throw o;e=(s=i.session)!==null&&s!==void 0?s:void 0}if(!e?.refresh_token)throw new F;const{data:n,error:a}=await this._callRefreshToken(e.refresh_token);return a?this._returnResult({data:{user:null,session:null},error:a}):n?this._returnResult({data:{user:n.user,session:n},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(S(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(e,r){try{if(!q())throw new it("No browser detected.");if(e.error||e.error_description||e.error_code)throw new it(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new Sr("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new it("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Sr("No code detected.");const{data:_,error:E}=await this._exchangeCodeForSession(e.code);if(E)throw E;const w=new URL(window.location.href);return w.searchParams.delete("code"),window.history.replaceState(window.history.state,"",w.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:n,access_token:a,refresh_token:i,expires_in:o,expires_at:c,token_type:u}=e;if(!a||!o||!i||!u)throw new it("No session defined in URL");const d=Math.round(Date.now()/1e3),h=parseInt(o);let p=d+h;c&&(p=parseInt(c)),(p-d)*1e3<=Ce;const m=p-h;d-m>=120||d-m<0;const{data:b,error:g}=await this._getUser(a);if(g)throw g;const y={provider_token:s,provider_refresh_token:n,access_token:a,expires_in:h,expires_at:p,refresh_token:i,token_type:u,user:b.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:y,redirectType:e.type},error:null})}catch(s){if(S(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const r=await pe(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var s;const{data:n,error:a}=r;if(a&&!Tt(a))return this._returnResult({error:a});const i=(s=n.session)===null||s===void 0?void 0:s.access_token;if(i){const{error:o}=await this.admin.signOut(i,e);if(o&&!(fi(o)&&(o.status===404||o.status===401||o.status===403)||Tt(o)))return this._returnResult({error:o})}return e!=="others"&&(await this._removeSession(),await M(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const r=xi(),s={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,s),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async r=>{var s,n;try{const{data:{session:a},error:i}=r;if(i)throw i;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",a)),this._debug("INITIAL_SESSION","callback id",e,"session",a)}catch(a){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",a)}})}async resetPasswordForEmail(e,r={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await Ee(this.storage,this.storageKey,!0));try{return await j(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(a){if(await M(this.storage,`${this.storageKey}-code-verifier`),S(a))return this._returnResult({data:null,error:a});throw a}}async getUserIdentities(){var e;try{const{data:r,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(r){if(S(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var r;try{const{data:s,error:n}=await this._useSession(async a=>{var i,o,c,u,d;const{data:h,error:p}=a;if(p)throw p;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await j(this.fetch,"GET",f,{headers:this.headers,jwt:(d=(u=h.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(n)throw n;return q()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(s?.url),this._returnResult({data:{provider:e.provider,url:s?.url},error:null})}catch(s){if(S(s))return this._returnResult({data:{provider:e.provider,url:null},error:s});throw s}}async linkIdentityIdToken(e){return await this._useSession(async r=>{var s;try{const{error:n,data:{session:a}}=r;if(n)throw n;const{options:i,provider:o,token:c,access_token:u,nonce:d}=e,h=await j(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=a?.access_token)!==null&&s!==void 0?s:void 0,body:{provider:o,id_token:c,access_token:u,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:i?.captchaToken}},xform:z}),{data:p,error:f}=h;return f?this._returnResult({data:{user:null,session:null},error:f}):!p||!p.session||!p.user?this._returnResult({data:{user:null,session:null},error:new Se}):(p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("USER_UPDATED",p.session)),this._returnResult({data:p,error:f}))}catch(n){if(await M(this.storage,`${this.storageKey}-code-verifier`),S(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}})}async unlinkIdentity(e){try{return await this._useSession(async r=>{var s,n;const{data:a,error:i}=r;if(i)throw i;return await j(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(r){if(S(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(e){const r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{const s=Date.now();return await ji(async n=>(n>0&&await Ei(200*Math.pow(2,n-1)),this._debug(r,"refreshing attempt",n),await j(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:z})),(n,a)=>{const i=200*Math.pow(2,n);return a&&At(a)&&Date.now()+i-s<Ce})}catch(s){if(this._debug(r,"error",s),S(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",s),q()&&!r.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,r;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const n=await pe(this.storage,this.storageKey);if(n&&this.userStorage){let i=await pe(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:n.user},await Pe(this.userStorage,this.storageKey+"-user",i)),n.user=(e=i?.user)!==null&&e!==void 0?e:Ct()}else if(n&&!n.user&&!n.user){const i=await pe(this.storage,this.storageKey+"-user");i&&i?.user?(n.user=i.user,await M(this.storage,this.storageKey+"-user"),await Pe(this.storage,this.storageKey,n)):n.user=Ct()}if(this._debug(s,"session from storage",n),!this._isValidSession(n)){this._debug(s,"session is not valid"),n!==null&&await this._removeSession();return}const a=((r=n.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<Rt;if(this._debug(s,`session has${a?"":" not"} expired with margin of ${Rt}s`),a){if(this.autoRefreshToken&&n.refresh_token){const{error:i}=await this._callRefreshToken(n.refresh_token);i&&(At(i)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:o}=await this._getUser(n.access_token);!o&&i?.user?(n.user=i.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(i){this._debug(s,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(s,"error",n);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var r,s;if(!e)throw new F;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new vt;const{data:a,error:i}=await this._refreshAccessToken(e);if(i)throw i;if(!a.session)throw new F;await this._saveSession(a.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",a.session);const o={data:a.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(a){if(this._debug(n,"error",a),S(a)){const i={data:null,error:a};return At(a)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(i),i}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(a),a}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,r,s=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",r,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:r});const a=[],i=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,r)}catch(c){a.push(c)}});if(await Promise.all(i),a.length>0){for(let o=0;o<a.length;o+=1);throw a[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await M(this.storage,`${this.storageKey}-code-verifier`);const r=Object.assign({},e),s=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&r.user&&await Pe(this.userStorage,this.storageKey+"-user",{user:r.user});const n=Object.assign({},r);delete n.user;const a=Ar(n);await Pe(this.storage,this.storageKey,a)}else{const n=Ar(r);await Pe(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await M(this.storage,this.storageKey),await M(this.storage,this.storageKey+"-code-verifier"),await M(this.storage,this.storageKey+"-user"),this.userStorage&&await M(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&q()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch{}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ce);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const r=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=r,r&&typeof r=="object"&&typeof r.unref=="function"?r.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(r)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const r=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,r&&clearTimeout(r)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async r=>{const{data:{session:s}}=r;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((s.expires_at*1e3-e)/Ce);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${Ce}ms, refresh threshold is ${Vt} ticks`),n<=Vt&&await this._callRefreshToken(s.refresh_token)})}catch{}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof xs)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!q()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(e){this._debug("#visibilityChangedCallback","error",e)}},window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch{}}async _onVisibilityChanged(e){const r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,s){const n=[`provider=${encodeURIComponent(r)}`];if(s?.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s?.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[a,i]=await Ee(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(i)}`});n.push(o.toString())}if(s?.queryParams){const a=new URLSearchParams(s.queryParams);n.push(a.toString())}return s?.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var s;const{data:n,error:a}=r;return a?this._returnResult({data:null,error:a}):await j(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token})})}catch(r){if(S(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(e){try{return await this._useSession(async r=>{var s,n;const{data:a,error:i}=r;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:c,error:u}=await j(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(s=a?.session)===null||s===void 0?void 0:s.access_token});return u?this._returnResult({data:null,error:u}):(e.factorType==="totp"&&c.type==="totp"&&(!((n=c?.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),this._returnResult({data:c,error:null}))})}catch(r){if(S(r))return this._returnResult({data:null,error:r});throw r}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var s;const{data:n,error:a}=r;if(a)return this._returnResult({data:null,error:a});const i=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?ro(e.webauthn.credential_response):so(e.webauthn.credential_response)})}:{code:e.code}),{data:o,error:c}=await j(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:i,headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token});return c?this._returnResult({data:null,error:c}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),this._returnResult({data:o,error:c}))})}catch(r){if(S(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var s;const{data:n,error:a}=r;if(a)return this._returnResult({data:null,error:a});const i=await j(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token});if(i.error)return i;const{data:o}=i;if(o.type!=="webauthn")return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:eo(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:to(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(S(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(e){const{data:r,error:s}=await this._challenge({factorId:e.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){var e;const{data:{user:r},error:s}=await this.getUser();if(s)return{data:null,error:s};const n={all:[],phone:[],totp:[],webauthn:[]};for(const a of(e=r?.factors)!==null&&e!==void 0?e:[])n.all.push(a),a.status==="verified"&&n[a.factor_type].push(a);return{data:n,error:null}}async _getAuthenticatorAssuranceLevel(e){var r,s,n,a;if(e)try{const{payload:f}=ot(e);let m=null;f.aal&&(m=f.aal);let b=m;const{data:{user:g},error:y}=await this.getUser(e);if(y)return this._returnResult({data:null,error:y});((s=(r=g?.factors)===null||r===void 0?void 0:r.filter(w=>w.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(b="aal2");const E=f.amr||[];return{data:{currentLevel:m,nextLevel:b,currentAuthenticationMethods:E},error:null}}catch(f){if(S(f))return this._returnResult({data:null,error:f});throw f}const{data:{session:i},error:o}=await this.getSession();if(o)return this._returnResult({data:null,error:o});if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:c}=ot(i.access_token);let u=null;c.aal&&(u=c.aal);let d=u;((a=(n=i.user.factors)===null||n===void 0?void 0:n.filter(f=>f.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(d="aal2");const p=c.amr||[];return{data:{currentLevel:u,nextLevel:d,currentAuthenticationMethods:p},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async r=>{const{data:{session:s},error:n}=r;return n?this._returnResult({data:null,error:n}):s?await j(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:s.access_token,xform:a=>({data:a,error:null})}):this._returnResult({data:null,error:new F})})}catch(r){if(S(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(e,r){try{return await this._useSession(async s=>{const{data:{session:n},error:a}=s;if(a)return this._returnResult({data:null,error:a});if(!n)return this._returnResult({data:null,error:new F});const i=await j(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"approve"},xform:o=>({data:o,error:null})});return i.data&&i.data.redirect_url&&q()&&!r?.skipBrowserRedirect&&window.location.assign(i.data.redirect_url),i})}catch(s){if(S(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(e,r){try{return await this._useSession(async s=>{const{data:{session:n},error:a}=s;if(a)return this._returnResult({data:null,error:a});if(!n)return this._returnResult({data:null,error:new F});const i=await j(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"deny"},xform:o=>({data:o,error:null})});return i.data&&i.data.redirect_url&&q()&&!r?.skipBrowserRedirect&&window.location.assign(i.data.redirect_url),i})}catch(s){if(S(s))return this._returnResult({data:null,error:s});throw s}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:r},error:s}=e;return s?this._returnResult({data:null,error:s}):r?await j(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:n=>({data:n,error:null})}):this._returnResult({data:null,error:new F})})}catch(e){if(S(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async r=>{const{data:{session:s},error:n}=r;return n?this._returnResult({data:null,error:n}):s?(await j(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new F})})}catch(r){if(S(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(e,r={keys:[]}){let s=r.keys.find(o=>o.kid===e);if(s)return s;const n=Date.now();if(s=this.jwks.keys.find(o=>o.kid===e),s&&this.jwks_cached_at+di>n)return s;const{data:a,error:i}=await j(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!a.keys||a.keys.length===0||(this.jwks=a,this.jwks_cached_at=n,s=a.keys.find(o=>o.kid===e),!s)?null:s}async getClaims(e,r={}){try{let s=e;if(!s){const{data:f,error:m}=await this.getSession();if(m||!f.session)return this._returnResult({data:null,error:m});s=f.session.access_token}const{header:n,payload:a,signature:i,raw:{header:o,payload:c}}=ot(s);r?.allowExpired||Oi(a.exp);const u=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!u){const{error:f}=await this.getUser(s);if(f)throw f;return{data:{claims:a,header:n,signature:i},error:null}}const d=Ii(n.alg),h=await crypto.subtle.importKey("jwk",u,d,!0,["verify"]);if(!await crypto.subtle.verify(d,h,i,vi(`${o}.${c}`)))throw new zt("Invalid JWT signature");return{data:{claims:a,header:n,signature:i},error:null}}catch(s){if(S(s))return this._returnResult({data:null,error:s});throw s}}}Je.nextInstanceID={};const fo=Je,po="2.95.3";let Me="";typeof Deno<"u"?Me="deno":typeof document<"u"?Me="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Me="react-native":Me="node";const mo={"X-Client-Info":`supabase-js-${Me}/${po}`},go={headers:mo},yo={schema:"public"},bo={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},wo={};function Ye(t){"@babel/helpers - typeof";return Ye=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ye(t)}function vo(t,e){if(Ye(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,e);if(Ye(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function _o(t){var e=vo(t,"string");return Ye(e)=="symbol"?e:e+""}function xo(t,e,r){return(e=_o(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Lr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function I(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Lr(Object(r),!0).forEach(function(s){xo(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Lr(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}const ko=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),So=()=>Headers,Eo=(t,e,r)=>{const s=ko(r),n=So();return async(a,i)=>{var o;const c=(o=await e())!==null&&o!==void 0?o:t;let u=new n(i?.headers);return u.has("apikey")||u.set("apikey",t),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),s(a,I(I({},i),{},{headers:u}))}};function jo(t){return t.endsWith("/")?t:t+"/"}function Ro(t,e){var r,s;const{db:n,auth:a,realtime:i,global:o}=t,{db:c,auth:u,realtime:d,global:h}=e,p={db:I(I({},c),n),auth:I(I({},u),a),realtime:I(I({},d),i),storage:{},global:I(I(I({},h),o),{},{headers:I(I({},(r=h?.headers)!==null&&r!==void 0?r:{}),(s=o?.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return t.accessToken?p.accessToken=t.accessToken:delete p.accessToken,p}function To(t){const e=t?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(jo(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var Ao=class extends fo{constructor(t){super(t)}},Co=class{constructor(t,e,r){var s,n;this.supabaseUrl=t,this.supabaseKey=e;const a=To(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const i=`sb-${a.hostname.split(".")[0]}-auth-token`,o={db:yo,realtime:wo,auth:I(I({},bo),{},{storageKey:i}),global:go},c=Ro(r??{},o);if(this.storageKey=(s=c.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(n=c.global.headers)!==null&&n!==void 0?n:{},c.accessToken)this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(d,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}});else{var u;this.auth=this._initSupabaseAuthClient((u=c.auth)!==null&&u!==void 0?u:{},this.headers,c.global.fetch)}this.fetch=Eo(e,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(I({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(d=>this.realtime.setAuth(d)).catch(d=>{}),this.rest=new fa(new URL("rest/v1",a).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch,timeout:c.db.timeout,urlLengthLimit:c.db.urlLengthLimit}),this.storage=new ii(this.storageUrl.href,this.headers,this.fetch,r?.storage),c.accessToken||this._listenForAuthEvents()}get functions(){return new aa(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,r)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,r;if(t.accessToken)return await t.accessToken();const{data:s}=await t.auth.getSession();return(e=(r=s.session)===null||r===void 0?void 0:r.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:s,userStorage:n,storageKey:a,flowType:i,lock:o,debug:c,throwOnError:u},d,h){const p={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ao({url:this.authUrl.href,headers:I(I({},p),d),storageKey:a,autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:s,userStorage:n,flowType:i,lock:o,debug:c,throwOnError:u,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(f=>f.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new Ca(this.realtimeUrl.href,I(I({},t),{},{params:I(I({},{apikey:this.supabaseKey}),t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e?.access_token)})}_handleTokenChanged(t,e,r){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const Po=(t,e,r)=>new Co(t,e,r);function No(){if(typeof window<"u")return!1;const t=globalThis.process;if(!t)return!1;const e=t.version;if(e==null)return!1;const r=e.match(/^v(\d+)\./);return r?parseInt(r[1],10)<=18:!1}No();const Oo="",W=!!Oo,J=Po("https://placeholder.supabase.co","placeholder",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storage:localStorage,storageKey:"supabase.auth.token"},global:{headers:{"X-Client-Info":"layanan-digital@1.0.0"}}}),me=t=>({invalid_credentials:"Email atau password salah",user_not_found:"Email tidak terdaftar",email_not_confirmed:"Email belum dikonfirmasi. Silakan cek inbox Anda.",email_exists:"Email sudah terdaftar",weak_password:"Password terlalu lemah (minimal 6 karakter)",provider_disabled:"Login dengan Google tidak diaktifkan",user_already_exists:"User sudah ada",signup_disabled:"Pendaftaran sedang ditutup",timeout:"Waktu habis. Silakan coba lagi.",over_email_send_rate_limit:"Terlalu banyak percobaan. Coba lagi nanti.",invalid_email:"Format email tidak valid",over_request_rate_limit:"Terlalu banyak request. Coba lagi nanti."})[t.name]||t.message||"Terjadi kesalahan. Silakan coba lagi.",ie={isReady(){return W},getStatus(){return{isConfigured:W,isConnected:W,url:null,error:W?null:"Supabase not configured. Check VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY"}},async getCurrentSession(){if(!W)return null;try{const{data:{session:t},error:e}=await J.auth.getSession();if(e)throw e;return t}catch{return null}},async getCurrentUser(){if(!W)return null;try{const{data:{user:t},error:e}=await J.auth.getUser();return e||!t?null:{uid:t.id,email:t.email||null,displayName:t.user_metadata?.full_name||t.user_metadata?.name||t.email?.split("@")[0]||"User",photoURL:t.user_metadata?.avatar_url||t.user_metadata?.picture||null,phoneNumber:t.phone||null,emailVerified:t.email_confirmed_at!=null,createdAt:t.created_at,lastLoginAt:t.last_sign_in_at||void 0,provider:t.app_metadata?.provider||"email"}}catch{return null}},onAuthStateChanged(t){if(!W)return t(null),{data:{subscription:{unsubscribe:()=>{}}}};const{data:{subscription:e}}=J.auth.onAuthStateChange(async(r,s)=>{if(s?.user){const n={uid:s.user.id,email:s.user.email||null,displayName:s.user.user_metadata?.full_name||s.user.user_metadata?.name||s.user.email?.split("@")[0]||"User",photoURL:s.user.user_metadata?.avatar_url||s.user.user_metadata?.picture||null,phoneNumber:s.user.phone||null,emailVerified:s.user.email_confirmed_at!=null,createdAt:s.user.created_at,lastLoginAt:s.user.last_sign_in_at||void 0,provider:s.user.app_metadata?.provider||"email"};t(n)}else t(null)});return{data:{subscription:e}}},async signInWithGoogle(){if(!W)throw new Error("Supabase belum dikonfigurasi. Periksa file .env Anda.");try{const{data:t,error:e}=await J.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/auth`,queryParams:{access_type:"offline",prompt:"select_account"}}});if(e)throw e;return{uid:"redirecting",email:null,displayName:"Redirecting...",photoURL:null,phoneNumber:null,emailVerified:!1}}catch(t){throw new Error(me(t))}},async signInWithEmail(t,e){if(!W)throw new Error("Supabase belum dikonfigurasi. Periksa file .env Anda.");try{const{data:r,error:s}=await J.auth.signInWithPassword({email:t,password:e});if(s)throw s;if(!r.user)throw new Error("Login gagal");return{uid:r.user.id,email:r.user.email||null,displayName:r.user.user_metadata?.full_name||r.user.email?.split("@")[0]||"User",photoURL:r.user.user_metadata?.avatar_url||null,phoneNumber:r.user.phone||null,emailVerified:r.user.email_confirmed_at!=null,createdAt:r.user.created_at,lastLoginAt:r.user.last_sign_in_at||void 0,provider:"email"}}catch(r){throw new Error(me(r))}},async registerWithEmail(t,e,r){if(!W)throw new Error("Supabase belum dikonfigurasi. Periksa file .env Anda.");try{const{data:s,error:n}=await J.auth.signUp({email:t,password:e,options:{data:{full_name:r},emailRedirectTo:`${window.location.origin}/auth`}});if(n)throw n;if(!s.user)throw new Error("Pendaftaran gagal");return{uid:s.user.id,email:s.user.email||null,displayName:r,photoURL:null,phoneNumber:null,emailVerified:!1,createdAt:s.user.created_at,lastLoginAt:s.user.last_sign_in_at||void 0,provider:"email"}}catch(s){throw new Error(me(s))}},async signOut(){if(W)try{const{error:t}=await J.auth.signOut();if(t)throw t}catch(t){throw new Error(me(t))}},async updateProfile(t){if(!W)throw new Error("Supabase belum dikonfigurasi");try{const{error:e}=await J.auth.updateUser({data:{full_name:t.displayName,avatar_url:t.photoURL}});if(e)throw e}catch(e){throw new Error(me(e))}},async sendPasswordResetEmail(t){if(!W)throw new Error("Supabase belum dikonfigurasi");try{const{error:e}=await J.auth.resetPasswordForEmail(t,{redirectTo:`${window.location.origin}/auth?reset=true`});if(e)throw e}catch(e){throw new Error(me(e))}},async updatePassword(t){if(!W)throw new Error("Supabase belum dikonfigurasi");try{const{error:e}=await J.auth.updateUser({password:t});if(e)throw e}catch(e){throw new Error(me(e))}}},Io=async()=>{if(!W)return{success:!1,configured:!1,authenticated:!1,message:"Supabase tidak terkonfigurasi. Tambahkan VITE_SUPABASE_URL dan VITE_SUPABASE_ANON_KEY ke .env"};try{const{data:t,error:e}=await J.auth.getSession();return e?{success:!1,configured:!0,authenticated:!1,message:`Koneksi error: ${e.message}`}:{success:!0,configured:!0,authenticated:!!t.session,message:t.session?"Terhubung ke Supabase (user logged in)":"Terhubung ke Supabase (no active session)"}}catch(t){return{success:!1,configured:!0,authenticated:!1,message:`Error: ${t.message}`}}};class Ze{constructor(e=0,r="Network Error"){this.status=e,this.text=r}}const $o=()=>{if(!(typeof localStorage>"u"))return{get:t=>Promise.resolve(localStorage.getItem(t)),set:(t,e)=>Promise.resolve(localStorage.setItem(t,e)),remove:t=>Promise.resolve(localStorage.removeItem(t))}},K={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:$o()},sr=t=>t?typeof t=="string"?{publicKey:t}:t.toString()==="[object Object]"?t:{}:{},Lo=(t,e="https://api.emailjs.com")=>{if(!t)return;const r=sr(t);K.publicKey=r.publicKey,K.blockHeadless=r.blockHeadless,K.storageProvider=r.storageProvider,K.blockList=r.blockList,K.limitRate=r.limitRate,K.origin=r.origin||e},Es=async(t,e,r={})=>{const s=await fetch(K.origin+t,{method:"POST",headers:r,body:e}),n=await s.text(),a=new Ze(s.status,n);if(s.ok)return a;throw a},js=(t,e,r)=>{if(!t||typeof t!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!e||typeof e!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!r||typeof r!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},Uo=t=>{if(t&&t.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},Rs=t=>t.webdriver||!t.languages||t.languages.length===0,Ts=()=>new Ze(451,"Unavailable For Headless Browser"),Do=(t,e)=>{if(!Array.isArray(t))throw"The BlockList list has to be an array";if(typeof e!="string")throw"The BlockList watchVariable has to be a string"},Bo=t=>!t.list?.length||!t.watchVariable,Mo=(t,e)=>t instanceof FormData?t.get(e):t[e],As=(t,e)=>{if(Bo(t))return!1;Do(t.list,t.watchVariable);const r=Mo(e,t.watchVariable);return typeof r!="string"?!1:t.list.includes(r)},Cs=()=>new Ze(403,"Forbidden"),qo=(t,e)=>{if(typeof t!="number"||t<0)throw"The LimitRate throttle has to be a positive number";if(e&&typeof e!="string")throw"The LimitRate ID has to be a non-empty string"},Ko=async(t,e,r)=>{const s=Number(await r.get(t)||0);return e-Date.now()+s},Ps=async(t,e,r)=>{if(!e.throttle||!r)return!1;qo(e.throttle,e.id);const s=e.id||t;return await Ko(s,e.throttle,r)>0?!0:(await r.set(s,Date.now().toString()),!1)},Ns=()=>new Ze(429,"Too Many Requests"),Wo=async(t,e,r,s)=>{const n=sr(s),a=n.publicKey||K.publicKey,i=n.blockHeadless||K.blockHeadless,o=n.storageProvider||K.storageProvider,c={...K.blockList,...n.blockList},u={...K.limitRate,...n.limitRate};return i&&Rs(navigator)?Promise.reject(Ts()):(js(a,t,e),Uo(r),r&&As(c,r)?Promise.reject(Cs()):await Ps(location.pathname,u,o)?Promise.reject(Ns()):Es("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:a,service_id:t,template_id:e,template_params:r}),{"Content-type":"application/json"}))},Fo=t=>{if(!t||t.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},Vo=t=>typeof t=="string"?document.querySelector(t):t,Ho=async(t,e,r,s)=>{const n=sr(s),a=n.publicKey||K.publicKey,i=n.blockHeadless||K.blockHeadless,o=K.storageProvider||n.storageProvider,c={...K.blockList,...n.blockList},u={...K.limitRate,...n.limitRate};if(i&&Rs(navigator))return Promise.reject(Ts());const d=Vo(r);js(a,t,e),Fo(d);const h=new FormData(d);return As(c,h)?Promise.reject(Cs()):await Ps(location.pathname,u,o)?Promise.reject(Ns()):(h.append("lib_version","4.4.1"),h.append("service_id",t),h.append("template_id",e),h.append("user_id",a),Es("/api/v1.0/email/send-form",h))},lt={init:Lo,send:Wo,sendForm:Ho,EmailJSResponseStatus:Ze},Nt="service_r2acb9x",Ot="template_gf7e27s",Go="LAT-HrbHtUzHZ9J3W",Jt={init(){lt.init(Go)},async sendRegistrationEmail(t){try{const e={to_email:t.to_email,to_name:t.to_name,user_email:t.user_email,registration_date:t.registration_date,subject:"Selamat Datang di Layanan Digital!",message:`Halo ${t.to_name},

Selamat! Akun Anda telah berhasil dibuat di Layanan Digital.

Detail Akun:
Email: ${t.user_email}
Tanggal Registrasi: ${t.registration_date}

Anda sekarang dapat login dan mulai menggunakan layanan kami.

Terima kasih,
Tim Layanan Digital`};await lt.send(Nt,Ot,e)}catch(e){H("ðŸ’¥ EMAILJS ERROR",{Error:e?.message||"Unknown"},"error")}},async sendOrderConfirmationEmail(t){try{const e={to_email:t.to_email,to_name:t.to_name,order_id:t.order_id,order_date:t.order_date,total_amount:t.total_amount,items:t.items,subject:"Konfirmasi Pesanan - Layanan Digital",message:`Halo ${t.to_name},

Pesanan Anda telah berhasil dibuat!

Detail Pesanan:
ID Pesanan: ${t.order_id}
Tanggal: ${t.order_date}
Total: ${t.total_amount}

Item:
${t.items}

Terima kasih telah berbelanja dengan kami!

Tim Layanan Digital`};await lt.send(Nt,Ot,e)}catch(e){H("ðŸ’¥ EMAILJS ERROR",{Error:e?.message||"Unknown"},"error")}},async sendNotificationEmail(t,e,r,s){try{const n={to_email:t,to_name:e,subject:r,message:s};await lt.send(Nt,Ot,n)}catch(n){H("ðŸ’¥ EMAILJS ERROR",{Error:n?.message||"Unknown"},"error")}}};Jt.init();const zo=(t=1e4)=>new Promise(e=>{if(navigator.onLine){e(!0);return}const r=setTimeout(()=>e(!1),t),s=()=>{clearTimeout(r),window.removeEventListener("online",s),e(!0)};window.addEventListener("online",s)}),De=async(t,e={})=>{const{maxRetries:r=3,delay:s=1e3}=e;let n;for(let a=0;a<r;a++)try{if(!navigator.onLine&&!await zo(5e3))throw new Error("auth/network-request-failed");return await t()}catch(i){if(n=i,["user-not-found","wrong-password","invalid-email","email-already-in-use","weak-password","popup-closed-by-user","invalid_credentials","user_already_exists"].some(c=>i.message?.toLowerCase().includes(c)))throw i;if(a<r-1){const c=s*Math.pow(2,a);await new Promise(u=>setTimeout(u,c))}}throw n},Jo=()=>{const{user:t,setUser:e,setProfile:r,logout:s,isAuthenticated:n}=X(),[a,i]=v.useState(!0),[o,c]=v.useState(null),[u,d]=v.useState("none"),[h,p]=v.useState({firebase:{configured:!1,working:!1},supabase:{configured:!1,working:!1}});v.useEffect(()=>{(async()=>{try{const x=Z.getStatus(),k=W;let T=!1;k&&(T=(await Io()).success),p({firebase:{configured:x.isConfigured,working:x.isInitialized},supabase:{configured:k,working:T}}),k?d("supabase"):x.isConfigured?d("firebase"):(H("âš ï¸ AUTH CONFIG",{Error:"No auth provider configured",Firebase:x.isConfigured?"OK":"Not configured",Supabase:k?"OK":"Not configured"},"warn"),d("none"))}catch(x){H("ðŸ’¥ AUTH DETECT ERROR",{Error:x instanceof Error?x.message:"Unknown"},"error"),d("none")}})()},[]),v.useEffect(()=>{if(u==="none"){i(!1);return}let w;return(async()=>{try{if(u==="supabase"){const k=await ie.getCurrentUser();k&&f(k);const{data:{subscription:T}}=ie.onAuthStateChanged(A=>{A?f(A):(e(null),r(null)),i(!1)});w=()=>T.unsubscribe()}else if(u==="firebase"){const k=Z.getCurrentUser();if(k){const T={uid:k.uid,email:k.email,displayName:k.displayName,photoURL:k.photoURL,phoneNumber:k.phoneNumber,emailVerified:k.emailVerified,createdAt:k.metadata?.creationTime,lastLoginAt:k.metadata?.lastSignInTime};f(T)}w=Z.onAuthStateChanged(T=>{if(T){const A={uid:T.uid,email:T.email,displayName:T.displayName,photoURL:T.photoURL,phoneNumber:T.phoneNumber,emailVerified:T.emailVerified,createdAt:T.metadata?.creationTime,lastLoginAt:T.metadata?.lastSignInTime};f(A)}else e(null),r(null);i(!1)})}}catch(k){H("ðŸ’¥ AUTH LISTENER ERROR",{Error:k instanceof Error?k.message:"Unknown",Provider:u},"error"),i(!1)}})(),()=>{w&&w()}},[u,e,r]);const f=async w=>{e(w);try{let x=await ae.getProfile(w.uid);if(!x){const k={id:w.uid,email:w.email||"",full_name:w.displayName||"User",avatar_url:w.photoURL||""};await ae.createProfile(k),x=k}r(x)}catch{}},m=v.useCallback(async()=>{c(null);try{if(i(!0),u==="supabase")return await ie.signInWithGoogle(),$.success("Mengarahkan ke Google..."),{uid:"redirecting",email:null,displayName:"Redirecting..."};if(u==="firebase"){const w=await De(()=>Z.signInWithGoogle(),{maxRetries:3});e(w);let x=await ae.getProfile(w.uid),k=!1;if(!x){k=!0;const T={id:w.uid,email:w.email||"",full_name:w.displayName||"User",avatar_url:w.photoURL||""};await ae.createProfile(T),x=T;try{await Jt.sendRegistrationEmail({to_email:w.email||"",to_name:w.displayName||"User",user_email:w.email||"",registration_date:new Date().toLocaleDateString("id-ID")})}catch{}try{await cr.sendNewUserNotification({id:w.uid,email:w.email||"",name:w.displayName||"User",role:"user",avatar:w.photoURL||void 0,registrationMethod:"Google"})}catch{}}return r(x),k?$.success(`Selamat datang, ${w.displayName||"User"}! ðŸŽ‰`):$.success(`Selamat datang kembali, ${w.displayName||"User"}! ðŸ‘‹`),w}else throw new Error("Tidak ada provider autentikasi yang tersedia. Silakan hubungi admin.")}catch(w){throw H("ðŸ’¥ SIGN IN GOOGLE ERROR",{Error:w.message,Provider:u},"error"),c(w.message),$.error("Gagal masuk: "+w.message),w}finally{i(!1)}},[u,e,r]),b=v.useCallback(async(w,x)=>{c(null);try{i(!0);let k;if(u==="supabase")k=await De(()=>ie.signInWithEmail(w,x),{maxRetries:3});else if(u==="firebase")k=await De(()=>Z.signInWithEmail(w,x),{maxRetries:3});else throw new Error("Tidak ada provider autentikasi yang tersedia.");e(k);const T=await ae.getProfile(k.uid);return T&&r(T),$.success(`Selamat datang kembali, ${k.displayName||w}! ðŸ‘‹`),k}catch(k){throw H("ðŸ’¥ SIGN IN EMAIL ERROR",{Error:k.message,Provider:u},"error"),c(k.message),$.error("Gagal masuk: "+k.message),k}finally{i(!1)}},[u,e,r]),g=v.useCallback(async(w,x,k,T)=>{c(null);try{i(!0);let A;if(u==="supabase")A=await De(()=>ie.registerWithEmail(w,x,k),{maxRetries:3});else if(u==="firebase")A=await De(()=>Z.registerWithEmail(w,x,k),{maxRetries:3});else throw new Error("Tidak ada provider autentikasi yang tersedia.");e(A);const et={id:A.uid,email:w,full_name:k,phone:T||"",avatar_url:""};await ae.createProfile(et),r(et);try{await Jt.sendRegistrationEmail({to_email:w,to_name:k,user_email:w,registration_date:new Date().toLocaleDateString("id-ID")})}catch{}try{await cr.sendNewUserNotification({id:A.uid,email:w,name:k,role:"user",registrationMethod:"Email"})}catch{}return $.success("Pendaftaran berhasil! Selamat datang! ðŸŽ‰"),A}catch(A){throw H("ðŸ’¥ REGISTER ERROR",{Error:A.message,Provider:u},"error"),c(A.message),$.error("Gagal mendaftar: "+A.message),A}finally{i(!1)}},[u,e,r]),y=v.useCallback(async()=>{try{i(!0),u==="supabase"?await ie.signOut():u==="firebase"&&await Z.signOut(),s(),$.success("Berhasil keluar")}catch(w){throw H("ðŸ’¥ SIGN OUT ERROR",{Error:w.message,Provider:u},"error"),$.error("Gagal keluar: "+w.message),w}finally{i(!1)}},[u,s]),_=v.useCallback(async w=>{try{if(i(!0),u==="supabase"?await ie.updateProfile(w):u==="firebase"&&await Z.updateProfile(w),t){const x={...t,...w};e(x),await ae.updateProfile(t.uid,{full_name:w.displayName,avatar_url:w.photoURL});const k=await ae.getProfile(t.uid);k&&r(k)}}catch(x){throw H("ðŸ’¥ UPDATE PROFILE ERROR",{Error:x.message},"error"),$.error("Gagal memperbarui profil: "+x.message),x}finally{i(!1)}},[u,t,e,r]),E=v.useCallback(async w=>{try{if(u==="supabase")await ie.sendPasswordResetEmail(w);else if(u==="firebase")await Z.sendPasswordResetEmail(w);else throw new Error("Fitur reset password tidak tersedia");$.success("Email reset password telah dikirim")}catch(x){throw H("ðŸ’¥ RESET PASSWORD ERROR",{Error:x.message},"error"),$.error("Gagal mengirim email reset: "+x.message),x}},[u]);return{user:t,isAuthenticated:n,isLoading:a,error:o,authProvider:u,providerStatus:h,signInWithGoogle:m,signInWithEmail:b,registerWithEmail:g,signOut:y,updateProfile:_,resetPassword:E}};function Yo({isOpen:t,onClose:e}){const{user:r,profile:s,isAuthenticated:n,isDarkMode:a}=X(),{signOut:i}=Jo(),o=tn();v.useEffect(()=>{const _=()=>{O.initOnInteraction()};return window.addEventListener("click",_,{once:!0}),()=>window.removeEventListener("click",_)},[]);const c=async()=>{O.playClick(),await i(),e(),o("/")},u=()=>{O.playClick(),e()},d=[{id:"home",label:"Beranda",icon:Fr,path:"/"},{id:"cart",label:"Keranjang",icon:Ie,path:"/cart"},{id:"support",label:"Bantuan",icon:ht,path:"/support"},{id:"profile",label:"Profil Saya",icon:Qe,path:"/profile"}],h=a?"bg-gray-900":"bg-white",p=a?"text-white":"text-gray-900",f=a?"text-gray-400":"text-gray-500",m=a?"border-gray-700":"border-gray-200",b=a?"hover:bg-gray-800":"hover:bg-gray-100",g=a?"bg-gray-800/50":"bg-gradient-to-r from-blue-50 to-orange-50",y=a?"text-gray-400":"text-gray-500";return l.jsxs(l.Fragment,{children:[t&&l.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 transition-opacity duration-300",onClick:e}),l.jsxs("aside",{className:`fixed top-0 left-0 h-full w-72 ${h} z-50 shadow-2xl transform transition-all duration-500 ease-out ${t?"translate-x-0":"-translate-x-full"}`,children:[l.jsxs("div",{className:`flex items-center justify-between p-4 border-b ${m}`,children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-600 to-orange-500 rounded-xl flex items-center justify-center shadow-lg animate-pulse",children:l.jsx("span",{className:"text-white font-bold text-lg",children:"L"})}),l.jsx("span",{className:`font-bold text-lg ${p}`,children:"Layanan Digital"})]}),l.jsx(D,{variant:"ghost",size:"icon",onClick:()=>{O.playClick(),e()},className:`${a?"text-gray-400 hover:text-white hover:bg-gray-800":"text-gray-500 hover:text-gray-700"} rounded-lg hover:rotate-90 transition-transform duration-300`,children:l.jsx(_e,{className:"h-5 w-5"})})]}),n?l.jsx("div",{className:`p-4 ${g} border-b ${m}`,children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsxs(as,{className:"h-14 w-14 border-3 border-white shadow-lg ring-2 ring-blue-500/20 hover:scale-110 transition-transform duration-300",children:[l.jsx(is,{src:s?.avatar_url||r?.photoURL||""}),l.jsx(os,{className:"bg-gradient-to-r from-blue-600 to-orange-500 text-white text-lg font-bold",children:(s?.full_name||r?.displayName||"U").charAt(0).toUpperCase()})]}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:`font-bold truncate ${p}`,children:s?.full_name||r?.displayName}),l.jsx("p",{className:`text-sm truncate ${f}`,children:s?.email||r?.email})]})]})}):l.jsxs("div",{className:`p-4 ${g} border-b ${m}`,children:[l.jsx("p",{className:`text-sm ${f} mb-3`,children:"Masuk untuk mengakses fitur lengkap"}),l.jsx(ce,{to:"/auth",onClick:u,children:l.jsx(D,{className:"w-full bg-gradient-to-r from-blue-600 to-orange-500 hover:from-blue-700 hover:to-orange-600 shadow-lg hover:shadow-xl hover:scale-[1.02] active:scale-[0.98] transition-all duration-300",children:"Masuk / Daftar"})})]}),l.jsxs("nav",{className:"p-3 space-y-1",children:[l.jsx("p",{className:`text-xs font-bold uppercase tracking-wider mb-2 px-3 ${f}`,children:"Menu"}),d.map((_,E)=>{const w=_.icon;return l.jsxs(ce,{to:_.path,onClick:u,className:`flex items-center gap-3 w-full p-3 rounded-xl ${b} transition-all duration-300 text-left group ${a?"text-gray-300":"text-gray-700"} hover:translate-x-1`,style:{animationDelay:`${E*50}ms`},children:[l.jsx("div",{className:`p-2 rounded-lg ${a?"bg-gray-800 group-hover:bg-gray-700":"bg-gray-100 group-hover:bg-gray-200"} transition-all duration-300 group-hover:scale-110`,children:l.jsx(w,{className:`h-5 w-5 ${y} group-hover:text-blue-500 transition-colors`})}),l.jsx("span",{className:"font-medium group-hover:text-blue-500 transition-colors",children:_.label})]},_.id)}),l.jsxs("a",{href:"/admin",onClick:u,className:`flex items-center gap-3 w-full p-3 rounded-xl ${b} transition-all duration-300 text-left group ${a?"text-gray-300":"text-gray-700"} hover:translate-x-1`,children:[l.jsx("div",{className:`p-2 rounded-lg ${a?"bg-gray-800 group-hover:bg-gray-700":"bg-gray-100 group-hover:bg-gray-200"} transition-all duration-300 group-hover:scale-110`,children:l.jsx(Vr,{className:`h-5 w-5 ${y} group-hover:text-purple-500 transition-colors`})}),l.jsx("span",{className:"font-medium group-hover:text-purple-500 transition-colors",children:"Admin Dashboard"})]})]}),l.jsx("div",{className:`absolute bottom-0 left-0 right-0 p-4 border-t ${m} ${h}`,children:n?l.jsxs(D,{variant:"outline",className:`w-full flex items-center gap-2 text-red-500 border-red-200 hover:bg-red-50 hover:text-red-600 transition-all duration-300 hover:scale-[1.02] active:scale-[0.98] ${a?"hover:bg-red-900/20 border-red-900/30":""}`,onClick:c,children:[l.jsx(fn,{className:"h-4 w-4"}),"Keluar"]}):l.jsx("div",{className:`text-center text-xs ${f}`,children:"Â© 2024 Layanan Digital"})})]})]})}const ge=[{icon:zr,title:"Selamat Datang di Layanan Digital!",subtitle:"Solusi Digital Profesional",description:"Temukan berbagai layanan digital profesional untuk kebutuhan Anda. Dari instalasi Wi-Fi, CCTV, editing kreatif, hingga support teknis.",color:"from-blue-500 via-purple-500 to-pink-500",bgGradient:"from-blue-50 via-purple-50 to-pink-50",features:[{icon:We,text:"Instalasi WiFi Profesional"},{icon:Hr,text:"Sistem CCTV Lengkap"},{icon:Gr,text:"Jasa Programming"},{icon:pn,text:"Editing Kreatif"}]},{icon:qr,title:"Belanja Mudah & Cepat",subtitle:"Pengalaman Belanja Terbaik",description:"Pilih layanan yang Anda butuhkan, tambahkan ke keranjang, dan lakukan pembayaran dengan QRIS. Cepat, aman, dan praktis!",color:"from-green-500 via-emerald-500 to-teal-500",bgGradient:"from-green-50 via-emerald-50 to-teal-50",features:[{icon:ir,text:"Pilih Paket Sesuai Kebutuhan"},{icon:Kr,text:"Pembayaran QRIS"},{icon:dt,text:"Proses Cepat"},{icon:Vr,text:"Transaksi Aman"}]},{icon:Ut,title:"Akses Dimana Saja",subtitle:"Install Aplikasi Kami",description:"Install Progressive Web App (PWA) kami untuk pengalaman terbaik. Akses layanan kami kapan saja, bahkan offline!",color:"from-orange-500 via-amber-500 to-yellow-500",bgGradient:"from-orange-50 via-amber-50 to-yellow-50",features:[{icon:Ut,text:"Install ke Home Screen"},{icon:dt,text:"Akses Cepat"},{icon:mn,text:"Notifikasi Real-time"},{icon:Dt,text:"Mode Offline"}]},{icon:ht,title:"Support 24/7",subtitle:"Kami Selalu Siap Membantu",description:"Tim kami siap membantu kapan saja. Gunakan fitur AI Chatbot untuk jawaban instan, atau kirim tiket dukungan untuk bantuan lebih lanjut.",color:"from-purple-500 via-violet-500 to-indigo-500",bgGradient:"from-purple-50 via-violet-50 to-indigo-50",features:[{icon:dt,text:"AI Chatbot Pintar"},{icon:ht,text:"Support Teknis"},{icon:ir,text:"Respons Cepat"},{icon:Qe,text:"Akun Pribadi"}]}];function Qo(){const{hasSeenWelcome:t,setHasSeenWelcome:e,soundEnabled:r,isDarkMode:s}=X(),[n,a]=v.useState(!1),[i,o]=v.useState(0),[c,u]=v.useState(!1),[d,h]=v.useState("next");v.useEffect(()=>{if(!t){const w=setTimeout(()=>{a(!0),r&&O.playSuccess()},1500);return()=>clearTimeout(w)}},[t,r]);const p=v.useCallback(()=>{a(!1),e(!0),r&&O.playClick()},[e,r]),f=v.useCallback(()=>{r&&O.playClick(),i<ge.length-1?(u(!0),h("next"),setTimeout(()=>{o(w=>w+1),u(!1)},300)):p()},[i,p,r]),m=v.useCallback(()=>{r&&O.playClick(),i>0&&(u(!0),h("prev"),setTimeout(()=>{o(w=>w-1),u(!1)},300))},[i,r]),b=v.useCallback(()=>{r&&O.playClick(),p()},[p,r]),g=v.useCallback(w=>{w!==i&&!c&&(u(!0),h(w>i?"next":"prev"),setTimeout(()=>{o(w),u(!1)},300))},[i,c]),y=ge[i],_=y.icon,E=(i+1)/ge.length*100;return l.jsx(Yr,{open:n,onOpenChange:a,children:l.jsxs(Qr,{className:`max-w-lg p-0 overflow-hidden border-0 ${s?"bg-gray-900":"bg-white"}`,style:{borderRadius:"1.5rem"},children:[l.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${y.bgGradient} opacity-50 dark:opacity-10 transition-all duration-700`}),l.jsx("div",{className:"relative z-10 flex h-1.5 bg-gray-200 dark:bg-gray-800",children:l.jsx("div",{className:`h-full bg-gradient-to-r ${y.color} transition-all duration-500 ease-out`,style:{width:`${E}%`}})}),l.jsxs("div",{className:"relative z-10 flex items-center justify-between px-6 pt-6",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("span",{className:`text-sm font-medium ${s?"text-gray-400":"text-gray-500"}`,children:["Langkah ",i+1]}),l.jsx("span",{className:"text-gray-300",children:"/"}),l.jsx("span",{className:`text-sm ${s?"text-gray-500":"text-gray-400"}`,children:ge.length})]}),l.jsx("div",{className:"flex items-center gap-1.5",children:ge.map((w,x)=>l.jsx("button",{onClick:()=>g(x),className:`w-2 h-2 rounded-full transition-all duration-300 ${x===i?"w-6 bg-gradient-to-r "+y.color:x<i?"bg-green-500":s?"bg-gray-700":"bg-gray-300"}`},x))}),l.jsx("button",{onClick:b,className:`p-2 rounded-full transition-colors ${s?"hover:bg-gray-800 text-gray-400":"hover:bg-gray-100 text-gray-500"}`,children:l.jsx(_e,{className:"h-4 w-4"})})]}),l.jsxs("div",{className:`relative z-10 px-8 pb-8 transition-all duration-300 ${c?d==="next"?"opacity-0 -translate-x-4":"opacity-0 translate-x-4":"opacity-100 translate-x-0"}`,children:[l.jsx("div",{className:"flex justify-center mb-6",children:l.jsxs("div",{className:`relative w-28 h-28 rounded-3xl bg-gradient-to-br ${y.color} p-0.5 shadow-2xl`,children:[l.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-br from-white/20 to-transparent animate-pulse"}),l.jsx("div",{className:"relative w-full h-full rounded-3xl bg-gradient-to-br from-white/10 to-black/10 backdrop-blur-sm flex items-center justify-center",children:l.jsx(_,{className:"h-12 w-12 text-white drop-shadow-lg animate-float"})}),l.jsx("div",{className:`absolute -inset-2 bg-gradient-to-r ${y.color} opacity-20 blur-xl rounded-full animate-pulse`})]})}),l.jsxs(Rn,{className:"text-center mb-4",children:[l.jsx("p",{className:`text-sm font-semibold uppercase tracking-wider mb-2 bg-gradient-to-r ${y.color} bg-clip-text text-transparent`,children:y.subtitle}),l.jsx(Xr,{className:`text-2xl font-bold ${s?"text-white":"text-gray-900"}`,children:y.title})]}),l.jsx("p",{className:`text-center mb-6 leading-relaxed ${s?"text-gray-300":"text-gray-600"}`,children:y.description}),l.jsx("div",{className:"grid grid-cols-2 gap-3 mb-8",children:y.features.map((w,x)=>l.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-xl transition-all duration-300 hover:scale-105 ${s?"bg-gray-800/80 hover:bg-gray-700":"bg-white/80 hover:bg-white shadow-sm"}`,style:{animationDelay:`${x*100}ms`},children:[l.jsx("div",{className:`w-8 h-8 rounded-lg bg-gradient-to-br ${y.color} flex items-center justify-center flex-shrink-0`,children:l.jsx(w.icon,{className:"h-4 w-4 text-white"})}),l.jsx("span",{className:`text-xs font-medium ${s?"text-gray-300":"text-gray-600"}`,children:w.text})]},x))}),l.jsxs("div",{className:"flex gap-3",children:[i>0&&l.jsx(D,{variant:"outline",className:`flex-1 transition-all duration-300 ${s?"border-gray-700 text-gray-300 hover:bg-gray-800":"border-gray-200 hover:bg-gray-50"}`,onClick:m,children:"Kembali"}),l.jsxs(D,{className:`flex-1 bg-gradient-to-r ${y.color} hover:opacity-90 text-white shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02] active:scale-[0.98]`,onClick:f,children:[i===ge.length-1?"Mulai Sekarang":"Lanjut",l.jsx(Wr,{className:"h-4 w-4 ml-2 animate-pulse"})]})]}),i<ge.length-1&&l.jsx("button",{onClick:b,className:`w-full mt-4 text-sm transition-colors ${s?"text-gray-500 hover:text-gray-300":"text-gray-400 hover:text-gray-600"}`,children:"Lewati tutorial"})]})]})})}let Xo=null,G=null;const Yt=new Set,Qt=new Set;async function Zo(){if(!("serviceWorker"in navigator))return null;try{const t=await navigator.serviceWorker.register("/sw.js",{scope:"/"});return Xo=t,t.addEventListener("updatefound",()=>{const e=t.installing;e&&e.addEventListener("statechange",()=>{e.state==="installed"&&navigator.serviceWorker.controller&&window.dispatchEvent(new CustomEvent("sw-update-available"))})}),navigator.serviceWorker.addEventListener("message",e=>{e.data&&e.data.type}),t}catch{return null}}function el(){window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),G=t,window.deferredPrompt=G,G&&Yt.forEach(e=>e(G))}),window.addEventListener("appinstalled",()=>{G=null,window.deferredPrompt=null,window.dispatchEvent(new CustomEvent("pwa-installed"))})}function tl(){const t=/iPad|iPhone|iPod/.test(navigator.userAgent),e=/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent);return(t&&e||!!G)&&!gt()}function gt(){const t=window.matchMedia("(display-mode: standalone)").matches,e=window.navigator.standalone===!0;return t||e}function Ur(){const t=navigator.userAgent;return{isIos:/iPad|iPhone|iPod/.test(t),isAndroid:/Android/.test(t),isDesktop:!/Mobile|Android|iPhone|iPad|iPod/.test(t),isSafari:/Safari/.test(t)&&!/Chrome/.test(t),isChrome:/Chrome/.test(t)&&!/Edg/.test(t)}}async function rl(){if(!G)return!1;try{await G.prompt();const{outcome:t}=await G.userChoice;return G=null,window.deferredPrompt=null,t==="accepted"}catch{return!1}}function sl(t){return Yt.add(t),G&&t(G),()=>{Yt.delete(t)}}function nl(){const t=navigator.onLine;It(t),window.addEventListener("online",()=>{It(!0)}),window.addEventListener("offline",()=>{It(!1)})}function al(t){return Qt.add(t),t(navigator.onLine),()=>{Qt.delete(t)}}function il(){return navigator.onLine}function It(t){Qt.forEach(e=>e(t))}function ol(){const t=window.matchMedia("(display-mode: standalone)").matches,e=window.matchMedia("(display-mode: minimal-ui)").matches,r=window.navigator.standalone===!0;return t||r?"standalone":e?"minimal-ui":window.matchMedia?"browser":"unknown"}function ll(){el(),nl(),Zo()}const ct="pwa-install-prompt-dismissed",cl=7;function ul({className:t}){const[e,r]=v.useState(!1),[s,n]=v.useState(null),[a,i]=v.useState(!1);v.useEffect(()=>{const u=localStorage.getItem(ct);if(u)try{const{timestamp:f}=JSON.parse(u);if((Date.now()-f)/(1e3*60*60*24)<cl)return}catch{localStorage.removeItem(ct)}(()=>{const f=gt();if(i(f),!f&&tl()){n(Ur());const m=setTimeout(()=>{r(!0)},2e3);return()=>clearTimeout(m)}})();const h=sl(()=>{gt()||(n(Ur()),r(!0))}),p=()=>{i(!0),r(!1)};return window.addEventListener("pwa-installed",p),()=>{h(),window.removeEventListener("pwa-installed",p)}},[]);const o=()=>{r(!1),localStorage.setItem(ct,JSON.stringify({timestamp:Date.now()}))},c=async()=>{await rl()&&(r(!1),localStorage.removeItem(ct))};return!e||a?null:s?.isIos?l.jsx("div",{className:P("fixed bottom-20 left-4 right-4 z-50 mx-auto max-w-sm","animate-in slide-in-from-bottom-4 fade-in duration-300",t),children:l.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-r from-blue-500 to-blue-600 p-4 text-white shadow-2xl",children:[l.jsx("div",{className:"absolute -right-6 -top-6 h-24 w-24 rounded-full bg-white/10"}),l.jsx("div",{className:"absolute -bottom-4 -left-4 h-16 w-16 rounded-full bg-white/10"}),l.jsx("button",{onClick:o,className:"absolute right-2 top-2 rounded-full p-1 text-white/80 transition-colors hover:bg-white/20 hover:text-white","aria-label":"Tutup",children:l.jsx(_e,{className:"h-4 w-4"})}),l.jsxs("div",{className:"relative flex items-start gap-3",children:[l.jsx("div",{className:"flex h-12 w-12 shrink-0 items-center justify-center rounded-xl bg-white/20",children:l.jsx(Ut,{className:"h-6 w-6"})}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"mb-1 font-semibold",children:"Install Aplikasi"}),l.jsx("p",{className:"mb-3 text-sm text-blue-50",children:"Tambahkan ke Home Screen untuk akses cepat"}),l.jsxs("div",{className:"space-y-2 rounded-lg bg-white/10 p-3 text-sm",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"flex h-5 w-5 items-center justify-center rounded-full bg-white/20 text-xs font-medium",children:"1"}),l.jsxs("span",{children:["Ketuk ikon ",l.jsx(gn,{className:"mx-1 inline h-4 w-4"})," di bawah"]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"flex h-5 w-5 items-center justify-center rounded-full bg-white/20 text-xs font-medium",children:"2"}),l.jsxs("span",{children:["Pilih ",l.jsx(yn,{className:"mx-1 inline h-4 w-4"})," ",l.jsx("strong",{children:"Add to Home Screen"})]})]})]})]})]})]})}):l.jsx("div",{className:P("fixed bottom-20 left-4 right-4 z-50 mx-auto max-w-sm","animate-in slide-in-from-bottom-4 fade-in duration-300",t),children:l.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-r from-blue-500 to-blue-600 p-4 text-white shadow-2xl",children:[l.jsx("div",{className:"absolute -right-6 -top-6 h-24 w-24 rounded-full bg-white/10"}),l.jsx("div",{className:"absolute -bottom-4 -left-4 h-16 w-16 rounded-full bg-white/10"}),l.jsx("button",{onClick:o,className:"absolute right-2 top-2 rounded-full p-1 text-white/80 transition-colors hover:bg-white/20 hover:text-white","aria-label":"Tutup",children:l.jsx(_e,{className:"h-4 w-4"})}),l.jsxs("div",{className:"relative flex items-start gap-3",children:[l.jsx("div",{className:"flex h-12 w-12 shrink-0 items-center justify-center rounded-xl bg-white/20",children:l.jsx(bn,{className:"h-6 w-6"})}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"mb-1 font-semibold",children:"Install Layanan Digital"}),l.jsx("p",{className:"mb-3 text-sm text-blue-50",children:"Akses lebih cepat dan notifikasi realtime dengan aplikasi kami"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx(D,{size:"sm",variant:"secondary",className:"bg-white text-blue-600 hover:bg-blue-50",onClick:c,children:"Install Sekarang"}),l.jsx(D,{size:"sm",variant:"ghost",className:"text-white hover:bg-white/20",onClick:o,children:"Nanti"})]})]})]})]})})}function Dr({className:t,children:e,...r}){return l.jsxs(Js,{"data-slot":"scroll-area",className:P("relative",t),...r,children:[l.jsx(Ys,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:e}),l.jsx(dl,{}),l.jsx(Qs,{})]})}function dl({className:t,orientation:e="vertical",...r}){return l.jsx(Xs,{"data-slot":"scroll-area-scrollbar",orientation:e,className:P("flex touch-none p-px transition-colors select-none",e==="vertical"&&"h-full w-2.5 border-l border-l-transparent",e==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",t),...r,children:l.jsx(Zs,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}const nr="your-kimi-api-key",Os="https://api.moonshot.cn/v1/chat/completions",Is="moonshot-v1-8k",ar=nr!=="your-kimi-api-key",hl=`Anda adalah asisten AI Layanan Digital, platform jasa digital profesional di Indonesia yang ULTRA CERDAS dan RESPONSIF.

TENTANG LAYANAN DIGITAL:
- Platform jasa digital terpercaya dengan 9 layanan profesional
- Tim teknisi dan profesional kreatif berpengalaman
- Fokus pada kualitas, keandalan, dan kepuasan pelanggan
- Support 24/7 untuk semua layanan

DAFTAR LENGKAP 9 PRODUK & LAYANAN:

1. Wi-Fi Installation Service (Kategori: installation)
   - Pemasangan dan konfigurasi jaringan WiFi profesional
   - Setup router, optimasi jangkauan, pengaturan keamanan
   - Paket: Basic, Standard, Premium
   - Harga: Rp 79.000 - Rp 249.000 (sekali bayar)
   - Pilih paket WiFi di checkout dengan form lengkap

2. CCTV Security System (Kategori: installation)
   - Instalasi kamera keamanan lengkap dengan monitoring
   - Setup remote viewing via aplikasi mobile
   - Paket: 2 kamera HD, 4 kamera 4K, 8 kamera 4K
   - Harga: Rp 179.000 - Rp 699.000

3. Code Error Repair (Kategori: technical)
   - Debugging dan perbaikan kode aplikasi/website
   - Code review dan optimasi performa
   - Support berbagai bahasa pemrograman
   - Harga: Rp 49.000 - Rp 249.000

4. Photo Editing (Kategori: creative)
   - Retouching foto profesional dan enhancement
   - Color correction dan background removal
   - Harga: Rp 25.000 - Rp 149.000

5. Video Editing (Kategori: creative)
   - Editing video untuk YouTube, medsos, presentasi
   - Color grading dan efek visual
   - Harga: Rp 69.000 - Rp 399.000

6. VPS Hosting (Kategori: technical)
   - Setup dan konfigurasi Virtual Private Server
   - Security hardening dan monitoring
   - Harga: Rp 39.000 - Rp 199.000/bulan

7. Panel Pterodactyl (Kategori: technical) â­ POPULER
   - Panel manajemen game server profesional
   - Support Minecraft, CS:GO, Valorant, GTA V, ARK, Rust
   - Domain: panel.lumakara.my.id
   - Buat username & password di checkout
   - Paket: Starter (Rp 129.000), Pro (Rp 249.000), Enterprise (Rp 499.000)
   - Fitur: Unlimited databases, SFTP Access, Backup system

8. Website Development (Kategori: technical)
   - Pembuatan website profesional modern & responsive
   - Landing Page, Company Profile, E-Commerce
   - Harga: Rp 799.000 - Rp 2.999.000
   - Gratis hosting 1 tahun

9. Graphic Design (Kategori: creative)
   - Desain logo, banner, social media, branding
   - Complete brand identity
   - Harga: Rp 99.000 - Rp 599.000

PAKET WIFI ION NETWORK (Langganan Bulanan):
- FLASH: 60 Mbps, 6 perangkat - Rp 235.997/bulan
- LIGHT: 100 Mbps, 8-10 perangkat - Rp 285.630/bulan
- AMAZING: 150 Mbps, 15 perangkat - Rp 358.651/bulan
- BLITZ: 300 Mbps, 20-25 perangkat - Rp 526.816/bulan
- UNIVERSE: 500 Mbps, unlimited - Rp 650.770/bulan
- INFINITE: 1 Gbps, unlimited - Rp 1.120.999/bulan

CARA PEMBAYARAN:
- QRIS (semua e-wallet)
- Virtual Account: BNI, BRI, Permata, CIMB, Maybank, BNC, ATM Bersama
- PayPal (untuk pembayaran internasional)
- Fee: 1% biaya layanan + 1.2% biaya admin

CARA MEMBANTU DENGAN CERDAS:
1. Selalu sapa user dengan ramah dan hangat
2. Berikan jawaban yang lengkap tapi ringkas
3. Jika user tanya harga, sebutkan range lengkap
4. Jika user bingung pilih produk, tanyakan kebutuhannya
5. Untuk WiFi dan Panel, arahkan ke checkout untuk isi form
6. Berikan rekomendasi sesuai budget dan kebutuhan
7. Jelaskan fitur unggulan setiap produk

GAYA KOMUNIKASI (ULTRA CERDAS):
- Ramah, profesional, dan helpful
- Bahasa Indonesia yang baik dan benar
- Gunakan emoji sesuai konteks
- Jawab dengan cepat dan tepat
- Selalu tawarkan bantuan tambahan
- Berikan informasi yang actionable

PENTING:
- Jika user ingin order WiFi atau Panel, arahkan ke checkout untuk isi form
- Jika user tanya panel, sebutkan domain: panel.lumakara.my.id
- Jika user tanya support game, sebutkan Minecraft, CS:GO, Valorant, GTA V, ARK, Rust`;async function fl(t,e=[]){if(!ar)return $t(t);try{const r=[{role:"system",content:hl},...e.slice(-10),{role:"user",content:t}],s=new AbortController,n=setTimeout(()=>s.abort(),15e3),a=await fetch(Os,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${nr}`},body:JSON.stringify({model:Is,messages:r,temperature:.7,max_tokens:1500,stream:!1}),signal:s.signal});if(clearTimeout(n),!a.ok){const h=await a.text();return $t(t)}const o=(await a.json()).choices?.[0]?.message?.content||"",c=await ml(t),u=gl(c,o);let d;return(u==="show_products"||c.type==="product_inquiry")&&(d=await pl(t)),{text:o,products:d?.length?d:void 0,action:u}}catch(r){return r instanceof Error&&r.name==="AbortError"?{text:"Maaf, respons sedikit lambat. Saya masih siap membantu! Ada yang bisa saya bantu?",action:"support"}:$t(t)}}async function pl(t){try{const e=await Tn.getAll(),r=t.toLowerCase();return e.map(n=>{let a=0;`${n.title} ${n.description} ${n.tags?.join(" ")||""}`.toLowerCase().includes(r)&&(a+=15),r.includes("wifi")&&(n.id==="wifi"||n.tags?.includes("network"))&&(a+=25),(r.includes("cctv")||r.includes("kamera")||r.includes("keamanan"))&&(n.id==="cctv"||n.tags?.includes("security"))&&(a+=25),(r.includes("code")||r.includes("program")||r.includes("coding")||r.includes("website")||r.includes("aplikasi"))&&(n.id==="code"||n.id==="website"||n.category==="technical")&&(a+=25),(r.includes("photo")||r.includes("foto")||r.includes("edit"))&&n.category==="creative"&&(a+=25),(r.includes("video")||r.includes("film"))&&(n.id==="video"||n.tags?.includes("video"))&&(a+=25),(r.includes("vps")||r.includes("server")||r.includes("hosting"))&&n.id==="vps"&&(a+=25),(r.includes("panel")||r.includes("pterodactyl")||r.includes("game")||r.includes("minecraft")||r.includes("csgo")||r.includes("valorant"))&&n.id==="panel"&&(a+=30),(r.includes("design")||r.includes("logo")||r.includes("branding")||r.includes("desain"))&&(n.id==="design"||n.tags?.includes("design"))&&(a+=25);const o=r.match(/(?:under|below|less than|dibawah|kurang dari)\s*(?:rp\.?\s*)?(\d+)/i);return o&&n.base_price<=parseInt(o[1])*(o[1].length>6?1:1e3)&&(a+=10),(r.includes("murah")||r.includes("termurah")||r.includes("budget"))&&n.base_price<1e5&&(a+=15),(r.includes("premium")||r.includes("terbaik"))&&n.rating>=4.8&&(a+=15),n.tags&&n.tags.forEach(c=>{r.includes(c.toLowerCase())&&(a+=8)}),{product:n,score:a}}).filter(n=>n.score>0).sort((n,a)=>a.score-n.score).slice(0,5).map(n=>n.product)}catch{return[]}}async function ml(t){if(!ar)return ut(t);try{const e=`Analisis pesan user dan klasifikasikan intent dengan PRESISI TINGGI. Balas dengan JSON saja.

Pesan user: "${t}"

Kategori intent:
- product_inquiry: Tanya tentang produk/layanan/harga
- wifi_inquiry: Tanya khusus tentang WiFi/installasi
- panel_inquiry: Tanya khusus tentang Panel Pterodactyl/game server
- order_intent: Mau pesan/beli/checkout
- support_request: Butuh bantuan/teknis
- general: Percakapan umum

Format JSON:
{
  "type": "product_inquiry|wifi_inquiry|panel_inquiry|order_intent|support_request|general",
  "confidence": 0.0-1.0,
  "entities": {
    "product_category": "installation|creative|technical atau null",
    "product_name": "nama produk spesifik atau null",
    "keywords": ["keyword1", "keyword2"]
  }
}`,r=await fetch(Os,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${nr}`},body:JSON.stringify({model:Is,messages:[{role:"user",content:e}],temperature:.2,max_tokens:300})});if(!r.ok)return ut(t);const a=((await r.json()).choices?.[0]?.message?.content||"{}").match(/\{[\s\S]*\}/);if(a){const i=JSON.parse(a[0]);return{type:i.type||"general",confidence:i.confidence||.5,entities:i.entities}}return ut(t)}catch{return ut(t)}}function gl(t,e){const r=e.toLowerCase();if(t.type==="wifi_inquiry"||r.includes("paket wifi")||r.includes("wifi package"))return"show_wifi_packages";if(t.type==="panel_inquiry"||r.includes("panel pterodactyl")||r.includes("game server"))return"show_panel_info";if(t.type==="order_intent"||r.includes("order")||r.includes("pesan")||r.includes("checkout")||r.includes("beli")||r.includes("booking"))return"create_order";if(t.type==="support_request"||r.includes("bantuan")||r.includes("help")||r.includes("support")||r.includes("masalah")||r.includes("error"))return"support";if((t.type==="product_inquiry"||r.includes("produk")||r.includes("layanan")||r.includes("harga")||r.includes("service"))&&!r.includes("wifi")&&!r.includes("panel"))return"show_products"}function $t(t){const e=t.toLowerCase(),r={wifi:`ðŸ”¥ **WiFi Installation Service**

Kami menyediakan pemasangan WiFi profesional dengan 3 paket:
â€¢ **Basic**: Rp 79.000 (1 router, garansi 1 tahun)
â€¢ **Standard**: Rp 149.000 (Mesh network, garansi 2 tahun)
â€¢ **Premium**: Rp 249.000 (Enterprise system, garansi 3 tahun)

ðŸ’¡ Pilih paket WiFi di halaman checkout dan lengkapi data pemasangan!`,panel:`ðŸŽ® **Panel Pterodactyl**

Panel manajemen game server profesional!

ðŸ•¹ï¸ **Support Game:**
Minecraft, CS:GO, Valorant, GTA V, ARK, Rust

ðŸ’° **Paket:**
â€¢ Starter: Rp 129.000 (1GB RAM, 3 servers)
â€¢ Pro: Rp 249.000 (2GB RAM, 5 servers)
â€¢ Enterprise: Rp 499.000 (4GB RAM, 10 servers)

ðŸŒ Domain: **panel.lumakara.my.id**

Buat username & password Anda di checkout!`,pterodactyl:`ðŸŽ® **Panel Pterodactyl**

Panel manajemen game server profesional!

ðŸ•¹ï¸ **Support Game:**
Minecraft, CS:GO, Valorant, GTA V, ARK, Rust

ðŸ’° **Paket:**
â€¢ Starter: Rp 129.000 (1GB RAM, 3 servers)
â€¢ Pro: Rp 249.000 (2GB RAM, 5 servers)
â€¢ Enterprise: Rp 499.000 (4GB RAM, 10 servers)

ðŸŒ Domain: **panel.lumakara.my.id**

Buat username & password Anda di checkout!`,minecraft:`ðŸŽ® **Panel Pterodactyl - Minecraft Ready!**

Buat server Minecraft Anda sendiri!

âœ… Support Minecraft Java & Bedrock
âœ… Unlimited players
âœ… Plugin & Mod support
âœ… Auto backup

ðŸ’° Mulai dari Rp 129.000/bulan
ðŸŒ panel.lumakara.my.id

Pesan sekarang dan buat akun di checkout!`,cctv:`ðŸ“¹ **CCTV Security System**

Instalasi kamera keamanan profesional:
â€¢ **Basic**: 2 kamera HD - Rp 179.000
â€¢ **Standard**: 4 kamera 4K - Rp 399.000
â€¢ **Premium**: 8 kamera 4K - Rp 699.000

âœ… Akses mobile app
âœ… Night vision
âœ… Motion detection
âœ… Cloud backup`,kamera:`ðŸ“¹ **CCTV Security System**

Instalasi kamera keamanan profesional:
â€¢ **Basic**: 2 kamera HD - Rp 179.000
â€¢ **Standard**: 4 kamera 4K - Rp 399.000
â€¢ **Premium**: 8 kamera 4K - Rp 699.000

âœ… Akses mobile app
âœ… Night vision
âœ… Motion detection`,code:`ðŸ’» **Code Error Repair**

Debugging dan optimasi kode:
â€¢ **Basic**: Rp 49.000 (Identifikasi bug, fix sederhana)
â€¢ **Standard**: Rp 129.000 (Complex debugging, security audit)
â€¢ **Premium**: Rp 249.000 (Full refactoring, long-term support)

âœ… Semua bahasa pemrograman
âœ… Performance optimization
âœ… Code review`,program:`ðŸ’» **Code Error Repair & Development**

Layanan coding profesional:
â€¢ Debugging & bug fixing
â€¢ Website development
â€¢ App development
â€¢ Code review & optimization

ðŸ’° Mulai dari Rp 49.000`,website:`ðŸŒ **Website Development**

Pembuatan website profesional:
â€¢ **Landing Page**: Rp 799.000
â€¢ **Company Profile**: Rp 1.499.000
â€¢ **E-Commerce**: Rp 2.999.000

âœ… Design modern & responsive
âœ… SEO optimized
âœ… Gratis hosting 1 tahun
âœ… CMS integration`,photo:`ðŸ“¸ **Photo Editing**

Edit foto profesional:
â€¢ **Basic**: Rp 25.000
â€¢ **Standard**: Rp 79.000
â€¢ **Premium**: Rp 149.000

âœ… Color correction
âœ… Background removal
âœ… Skin smoothing
âœ… RAW processing`,video:`ðŸŽ¬ **Video Editing**

Editing video profesional:
â€¢ **Basic**: Rp 69.000 (Basic cuts, 1080p)
â€¢ **Standard**: Rp 199.000 (Color grading, 4K)
â€¢ **Premium**: Rp 399.000 (VFX, Cinema quality)

âœ… YouTube, TikTok, Reels
âœ… Color grading
âœ… Motion graphics`,vps:`â˜ï¸ **VPS Hosting**

Virtual Private Server:
â€¢ **Basic**: Rp 39.000/bulan (2 CPU, 4GB RAM)
â€¢ **Standard**: Rp 99.000/bulan (4 CPU, 8GB RAM)
â€¢ **Premium**: Rp 199.000/bulan (8 CPU, 16GB RAM)

âœ… SSD Storage
âœ… Unlimited bandwidth
âœ… 24/7 monitoring`,server:`â˜ï¸ **VPS Hosting & Panel**

Kami punya 2 solusi server:

1ï¸âƒ£ **VPS Hosting** - Mulai Rp 39.000/bulan
   Untuk website & aplikasi

2ï¸âƒ£ **Panel Pterodactyl** - Mulai Rp 129.000/bulan
   Untuk game server (Minecraft, CS:GO, dll)

Mau yang mana?`,design:`ðŸŽ¨ **Graphic Design**

Jasa desain profesional:
â€¢ **Basic**: Rp 99.000 (Logo, 3 revisi)
â€¢ **Business**: Rp 249.000 (Logo vector, social media kit)
â€¢ **Complete Branding**: Rp 599.000 (Full brand identity)

âœ… Logo, banner, social media
âœ… Brand guidelines
âœ… Hak cipta penuh`,logo:`ðŸŽ¨ **Logo Design**

Desain logo profesional:
â€¢ **Basic**: Rp 99.000 (1 konsep, PNG/JPG)
â€¢ **Business**: Rp 249.000 (3 konsep, vector files)
â€¢ **Complete**: Rp 599.000 (Brand identity lengkap)

âœ… Unlimited revisi (sesuai paket)
âœ… File vector (AI, EPS, SVG)
âœ… Hak cipta penuh`,harga:`ðŸ’° **Daftar Harga Layanan Digital**

ðŸ“¶ WiFi: Rp 79.000 - Rp 249.000
ðŸ“¹ CCTV: Rp 179.000 - Rp 699.000
ðŸ’» Code: Rp 49.000 - Rp 249.000
ðŸ“¸ Photo: Rp 25.000 - Rp 149.000
ðŸŽ¬ Video: Rp 69.000 - Rp 399.000
â˜ï¸ VPS: Rp 39.000 - Rp 199.000/bulan
ðŸŽ® Panel: Rp 129.000 - Rp 499.000/bulan
ðŸŒ Website: Rp 799.000 - Rp 2.999.000
ðŸŽ¨ Design: Rp 99.000 - Rp 599.000

Mau info lengkap produk mana?`,price:`ðŸ’° **Daftar Harga Layanan Digital**

ðŸ“¶ WiFi: Rp 79.000 - Rp 249.000
ðŸ“¹ CCTV: Rp 179.000 - Rp 699.000
ðŸ’» Code: Rp 49.000 - Rp 249.000
ðŸ“¸ Photo: Rp 25.000 - Rp 149.000
ðŸŽ¬ Video: Rp 69.000 - Rp 399.000
â˜ï¸ VPS: Rp 39.000 - Rp 199.000/bulan
ðŸŽ® Panel: Rp 129.000 - Rp 499.000/bulan
ðŸŒ Website: Rp 799.000 - Rp 2.999.000
ðŸŽ¨ Design: Rp 99.000 - Rp 599.000`,murah:`ðŸ’Ž **Layanan Termurah Kami:**

1. Photo Editing Basic - Rp 25.000
2. Code Repair Basic - Rp 49.000
3. VPS Hosting - Rp 39.000/bulan
4. WiFi Basic - Rp 79.000
5. Design Basic - Rp 99.000

Mau lihat detail produk mana?`,bayar:`ðŸ’³ **Metode Pembayaran:**

âœ… QRIS (Gojek, OVO, DANA, LinkAja, dll)
âœ… Virtual Account (BNI, BRI, Permata, CIMB, Maybank, BNC)
âœ… ATM Bersama
âœ… PayPal (internasional)

ðŸ’¡ Fee: 1% biaya layanan + 1.2% biaya admin

Semua pembayaran aman & terenkripsi!`,payment:`ðŸ’³ **Metode Pembayaran:**

âœ… QRIS (semua e-wallet)
âœ… Virtual Account (BNI, BRI, Permata, CIMB, Maybank, BNC)
âœ… ATM Bersama
âœ… PayPal

Fee: 1% + 1.2%`,bantuan:`ðŸ‘‹ **Halo! Saya asisten AI Layanan Digital**

Saya bisa bantu Anda dengan:
ðŸ” Info 9 produk/layanan kami
ðŸ’° Cek harga & paket
ðŸ›’ Panduan pemesanan
ðŸŽ® Info Panel Pterodactyl
ðŸ“¶ Info WiFi Installation

**Mau tanya apa?**`,help:`ðŸ‘‹ **Halo! Saya asisten AI Layanan Digital**

Saya bisa bantu Anda dengan:
ðŸ” Info 9 produk/layanan kami
ðŸ’° Cek harga & paket
ðŸ›’ Panduan pemesanan
ðŸŽ® Info Panel Pterodactyl
ðŸ“¶ Info WiFi Installation

**Mau tanya apa?**`,hello:`ðŸ‘‹ **Halo! Selamat datang di Layanan Digital!**

Kami punya **9 layanan profesional** untuk kebutuhan digital Anda:

ðŸ“¶ WiFi | ðŸ“¹ CCTV | ðŸ’» Code | ðŸ“¸ Photo
ðŸŽ¬ Video | â˜ï¸ VPS | ðŸŽ® Panel | ðŸŒ Website | ðŸŽ¨ Design

Mau tau info lengkap tentang produk mana?`,hai:`ðŸ‘‹ **Halo! Selamat datang di Layanan Digital!**

Kami punya **9 layanan profesional** untuk kebutuhan digital Anda:

ðŸ“¶ WiFi | ðŸ“¹ CCTV | ðŸ’» Code | ðŸ“¸ Photo
ðŸŽ¬ Video | â˜ï¸ VPS | ðŸŽ® Panel | ðŸŒ Website | ðŸŽ¨ Design

Mau tau info lengkap tentang produk mana?`,hi:`ðŸ‘‹ **Hello! Welcome to Layanan Digital!**

We have **9 professional services** for your digital needs.

Type "help" to see what I can assist you with!`,produk:`ðŸ“‹ **Semua Produk Layanan Digital (9 Layanan):**

1ï¸âƒ£ **WiFi Installation** - Rp 79rb-249rb
2ï¸âƒ£ **CCTV Security** - Rp 179rb-699rb
3ï¸âƒ£ **Code Repair** - Rp 49rb-249rb
4ï¸âƒ£ **Photo Editing** - Rp 25rb-149rb
5ï¸âƒ£ **Video Editing** - Rp 69rb-399rb
6ï¸âƒ£ **VPS Hosting** - Rp 39rb-199rb/bulan
7ï¸âƒ£ **ðŸŽ® Panel Pterodactyl** - Rp 129rb-499rb/bulan
8ï¸âƒ£ **Website Dev** - Rp 799rb-2.999jt
9ï¸âƒ£ **Graphic Design** - Rp 99rb-599rb

Ketik nama produk untuk detail lengkap!`,semua:`ðŸ“‹ **Semua Produk Layanan Digital (9 Layanan):**

1ï¸âƒ£ **WiFi Installation** - Rp 79rb-249rb
2ï¸âƒ£ **CCTV Security** - Rp 179rb-699rb
3ï¸âƒ£ **Code Repair** - Rp 49rb-249rb
4ï¸âƒ£ **Photo Editing** - Rp 25rb-149rb
5ï¸âƒ£ **Video Editing** - Rp 69rb-399rb
6ï¸âƒ£ **VPS Hosting** - Rp 39rb-199rb/bulan
7ï¸âƒ£ **ðŸŽ® Panel Pterodactyl** - Rp 129rb-499rb/bulan
8ï¸âƒ£ **Website Dev** - Rp 799rb-2.999jt
9ï¸âƒ£ **Graphic Design** - Rp 99rb-599rb

Ketik nama produk untuk detail lengkap!`};for(const[s,n]of Object.entries(r))if(e.includes(s)){let a;return["wifi","paket wifi"].includes(s)?a="show_wifi_packages":["panel","pterodactyl","minecraft","game server"].includes(s)?a="show_panel_info":["produk","semua","wifi","cctv","code","program","photo","video","vps","server","harga","price","design","website"].includes(s)&&(a="show_products"),{text:n,action:a}}return{text:`ðŸ‘‹ **Halo! Saya asisten AI Layanan Digital**

Saya siap membantu Anda dengan:
â€¢ Info 9 produk/layanan kami
â€¢ Rekomendasi sesuai kebutuhan
â€¢ Panduan pemesanan
â€¢ Info harga & paket

**Coba tanyakan:**
ðŸ’¬ "Info WiFi"
ðŸ’¬ "Harga Panel"
ðŸ’¬ "Layanan apa saja?"
ðŸ’¬ "Mau pesan CCTV"

Ada yang bisa saya bantu? ðŸ˜Š`}}function ut(t){const e=t.toLowerCase();if(/\b(wifi|internet|jaringan|router|hotspot|broadband)\b/.test(e))return{type:"wifi_inquiry",confidence:.9,entities:{keywords:["wifi"],product_category:"installation"}};if(/\b(panel|pterodactyl|minecraft|game server|csgo|valorant|gta|ark|rust|server game)\b/.test(e))return{type:"panel_inquiry",confidence:.9,entities:{keywords:["panel","game"],product_category:"technical"}};if(/\b(pesan|order|beli|checkout|booking|mau|ingin)\b/.test(e))return{type:"order_intent",confidence:.8,entities:{keywords:["order"]}};if(/\b(bantuan|help|support|masalah|error|gagal|tidak bisa)\b/.test(e))return{type:"support_request",confidence:.8,entities:{keywords:["support"]}};if(/\b(wifi|cctv|code|program|photo|video|vps|server|harga|price|layanan|produk|service|design|website|panel)\b/.test(e)){let r;return/wifi|cctv/.test(e)?r="installation":/code|program|vps|server|panel|website/.test(e)?r="technical":/photo|video|design/.test(e)&&(r="creative"),{type:"product_inquiry",confidence:.7,entities:{product_category:r,keywords:["product"]}}}return{type:"general",confidence:.5}}const $s={hasApiKey:ar};function yl({product:t,onAddToCart:e,isDarkMode:r}){const s=Math.min(...t.tiers.map(n=>n.price));return l.jsx("div",{className:P("rounded-xl overflow-hidden border-2 transition-all duration-300 hover:scale-[1.02] cursor-pointer active:scale-95",r?"bg-gray-800 border-gray-700 hover:border-blue-500":"bg-white border-gray-200 hover:border-blue-400 shadow-sm"),onClick:()=>e(t),children:l.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3",children:[l.jsx("img",{src:t.icon,alt:t.title,className:"w-12 h-12 sm:w-16 sm:h-16 rounded-lg object-cover flex-shrink-0"}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("h4",{className:P("font-semibold text-xs sm:text-sm truncate",r?"text-white":"text-gray-900"),children:t.title}),l.jsx("p",{className:P("text-[10px] sm:text-xs line-clamp-1 sm:line-clamp-2 mt-0.5",r?"text-gray-400":"text-gray-500"),children:t.description}),l.jsxs("div",{className:"flex items-center justify-between mt-1 sm:mt-2",children:[l.jsxs("span",{className:"text-blue-600 font-bold text-xs sm:text-sm",children:["Rp ",s.toLocaleString("id-ID")]}),l.jsxs(Cn,{variant:"secondary",className:"text-[10px] sm:text-xs px-1.5 py-0",children:[t.tiers.length," paket"]})]})]})]})})}function Be({icon:t,label:e,onClick:r,isDarkMode:s,color:n="default"}){const a={default:s?"bg-gray-800 text-gray-300 hover:bg-gray-700 hover:text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200",blue:s?"bg-blue-900/30 text-blue-400 hover:bg-blue-900/50":"bg-blue-50 text-blue-700 hover:bg-blue-100",purple:s?"bg-purple-900/30 text-purple-400 hover:bg-purple-900/50":"bg-purple-50 text-purple-700 hover:bg-purple-100",green:s?"bg-green-900/30 text-green-400 hover:bg-green-900/50":"bg-green-50 text-green-700 hover:bg-green-100",orange:s?"bg-orange-900/30 text-orange-400 hover:bg-orange-900/50":"bg-orange-50 text-orange-700 hover:bg-orange-100"};return l.jsxs("button",{onClick:r,className:P("flex items-center gap-1.5 sm:gap-2 px-2.5 sm:px-4 py-2 sm:py-2.5 rounded-xl text-xs sm:text-sm font-medium","transition-all duration-200 active:scale-95 flex-shrink-0",a[n]),children:[l.jsx(t,{className:"h-3 w-3 sm:h-4 sm:w-4"}),l.jsx("span",{className:"whitespace-nowrap",children:e})]})}function bl({isDarkMode:t}){return l.jsx("div",{className:P("flex items-center gap-2 px-3 sm:px-4 py-2.5 sm:py-3 rounded-2xl",t?"bg-gray-800":"bg-gray-100","w-fit"),children:l.jsx("div",{className:"flex gap-1",children:[0,1,2].map(e=>l.jsx("div",{className:P("w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full animate-bounce",t?"bg-blue-400":"bg-blue-500"),style:{animationDelay:`${e*.15}s`}},e))})})}function wl({isDarkMode:t}){const e=$s.hasApiKey;return l.jsxs("div",{className:P("flex items-center gap-1 px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full text-[10px] sm:text-xs font-medium",e?t?"bg-green-900/30 text-green-400":"bg-green-100 text-green-700":t?"bg-yellow-900/30 text-yellow-400":"bg-yellow-100 text-yellow-700"),children:[l.jsx("div",{className:P("w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full",e?"bg-green-500 animate-pulse":"bg-yellow-500")}),l.jsx("span",{className:"hidden sm:inline",children:e?"AI Aktif":"AI Fallback"}),l.jsx("span",{className:"sm:hidden",children:e?"AI":"FB"})]})}function vl(){const{isDarkMode:t,addToCart:e}=X(),[r,s]=v.useState(!1),[n,a]=v.useState(!1),[i,o]=v.useState(!1),[c,u]=v.useState([{id:"welcome",role:"assistant",content:`ðŸ‘‹ **Halo! Selamat datang di Layanan Digital!**

Saya asisten AI yang siap membantu Anda. Kami memiliki **9 layanan profesional** untuk kebutuhan digital Anda.

ðŸ’¬ **Coba tanyakan:**
â€¢ "Info WiFi" atau "Paket Panel"
â€¢ "Harga semua layanan"
â€¢ "Layanan apa saja?"
â€¢ "Mau pesan CCTV"

Ada yang bisa saya bantu? ðŸ˜Š`,timestamp:new Date}]),[d,h]=v.useState(""),[p,f]=v.useState(!1),[m,b]=v.useState(!1),g=v.useRef(null),y=v.useRef(null),[_,E]=v.useState([]),w=v.useRef(null);v.useEffect(()=>{const C=()=>{o(window.innerWidth<640)};return C(),window.addEventListener("resize",C),()=>window.removeEventListener("resize",C)},[]),v.useEffect(()=>(r&&i?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[r,i]),v.useEffect(()=>{g.current&&(g.current.scrollTop=g.current.scrollHeight)},[c]),v.useEffect(()=>{r&&!n&&y.current&&setTimeout(()=>y.current?.focus(),300)},[r,n]),v.useEffect(()=>{if(!r&&c.length===1){const C=setTimeout(()=>{b(!0)},3e3);return()=>clearTimeout(C)}},[r,c.length]);const x=v.useCallback(async()=>{if(!d.trim()||p)return;const C={id:Date.now().toString(),role:"user",content:d.trim(),timestamp:new Date};u(B=>[...B,C]),h(""),f(!0),O.playClick();const xe=(Date.now()+1).toString();u(B=>[...B,{id:xe,role:"assistant",content:"",timestamp:new Date,isTyping:!0}]);try{const B=await fl(C.content,_);E(he=>[...he,{role:"user",content:C.content},{role:"assistant",content:B.text}].slice(-10)),u(he=>he.filter(Ds=>Ds.id!==xe));const de={id:Date.now().toString(),role:"assistant",content:B.text,timestamp:new Date,products:B.products,action:B.action};u(he=>[...he,de]),O.playSuccess()}catch{u(de=>de.filter(he=>he.id!==xe)),u(de=>[...de,{id:Date.now().toString(),role:"assistant",content:"Maaf, terjadi kesalahan. Silakan coba lagi nanti.",timestamp:new Date}])}finally{f(!1)}},[d,p,_]),k=C=>{C.key==="Enter"&&!C.shiftKey&&(C.preventDefault(),x())},T=C=>{h(C),setTimeout(()=>x(),100)},A=C=>{e(C,C.tiers[0]?.name||""),$.success(`${C.title} ditambahkan!`),O.playAddToCart()},et=()=>{u([{id:"welcome",role:"assistant",content:`ðŸ‘‹ **Halo! Selamat datang di Layanan Digital!**

Saya asisten AI yang siap membantu Anda. Kami memiliki **9 layanan profesional** untuk kebutuhan digital Anda.

ðŸ’¬ **Coba tanyakan:**
â€¢ "Info WiFi" atau "Paket Panel"
â€¢ "Harga semua layanan"
â€¢ "Layanan apa saja?"
â€¢ "Mau pesan CCTV"

Ada yang bisa saya bantu? ðŸ˜Š`,timestamp:new Date}]),E([]),O.playClick()},_t=C=>{navigator.clipboard.writeText(C),$.success("Pesan disalin!")},Ls=C=>C.split(/(\*\*.*?\*\*)/g).map((B,de)=>B.startsWith("**")&&B.endsWith("**")?l.jsx("strong",{className:"font-semibold",children:B.slice(2,-2)},de):B),Us=()=>{r?(s(!1),a(!1)):(s(!0),b(!1)),O.playClick()};return l.jsxs(l.Fragment,{children:[l.jsx("button",{onClick:Us,className:P("fixed z-50 rounded-full shadow-2xl flex items-center justify-center","transition-all duration-300 active:scale-90","w-12 h-12 sm:w-14 sm:h-14",i?"bottom-16 right-3":"bottom-20 right-4",r?"bg-red-500 hover:bg-red-600 rotate-90":"bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 hover:from-blue-700 hover:via-purple-700 hover:to-pink-700 hover:scale-110"),style:{boxShadow:r?"0 10px 40px -10px rgba(239, 68, 68, 0.5)":"0 10px 40px -10px rgba(124, 58, 237, 0.5)"},children:r?l.jsx(_e,{className:"h-5 w-5 sm:h-6 sm:w-6 text-white"}):l.jsxs("div",{className:"relative",children:[l.jsx(zr,{className:"h-5 w-5 sm:h-6 sm:w-6 text-white"}),m&&l.jsx("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 sm:w-3 sm:h-3 bg-red-500 rounded-full animate-pulse border-2 border-white"})]})}),l.jsxs("div",{ref:w,className:P("fixed z-50 flex flex-col overflow-hidden transition-all duration-300 ease-out",i?"inset-x-0 bottom-0 rounded-t-2xl":"bottom-24 right-4 w-[380px] lg:w-[420px] rounded-2xl",t?"bg-gray-900":"bg-white",r?"opacity-100 translate-y-0 pointer-events-auto":"opacity-0 translate-y-8 pointer-events-none"),style:{height:r?i?n?"60px":"calc(100vh - 80px)":n?"60px":"min(600px, calc(100vh - 120px))":"0",maxHeight:i?"calc(100vh - 80px)":"600px",boxShadow:t?"0 25px 50px -12px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(255, 255, 255, 0.05)":"0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(0, 0, 0, 0.05)"},children:[l.jsxs("div",{className:P("flex-shrink-0 px-3 sm:px-4 py-2.5 sm:py-3 flex items-center justify-between select-none",t?"bg-gradient-to-r from-gray-800 to-gray-900":"bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600"),children:[l.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:P("rounded-full flex items-center justify-center",t?"bg-gray-700":"bg-white/20","w-8 h-8 sm:w-10 sm:h-10"),children:l.jsx(or,{className:"h-4 w-4 sm:h-5 sm:w-5 text-white"})}),l.jsx("span",{className:"absolute bottom-0 right-0 w-2.5 h-2.5 sm:w-3 sm:h-3 bg-green-500 rounded-full border-2 border-white animate-pulse"})]}),l.jsxs("div",{className:"min-w-0",children:[l.jsx("h3",{className:"font-semibold text-white text-sm sm:text-base truncate",children:"AI Assistant"}),l.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[l.jsx("p",{className:"text-[10px] sm:text-xs text-white/70 truncate",children:"Powered by Kimi AI"}),l.jsx(wl,{isDarkMode:t})]})]})]}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("button",{onClick:()=>a(!n),className:"p-1.5 sm:p-2 rounded-lg hover:bg-white/20 transition-colors",title:n?"Expand":"Minimize",children:n?l.jsx(wn,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 text-white"}):l.jsx(vn,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 text-white"})}),l.jsx("button",{onClick:et,className:"p-1.5 sm:p-2 rounded-lg hover:bg-white/20 transition-colors",title:"Clear chat",children:l.jsx(_n,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 text-white"})})]})]}),l.jsxs("div",{className:P("flex-1 flex flex-col overflow-hidden transition-all duration-300",n?"opacity-0 h-0":"opacity-100"),children:[l.jsx(Dr,{className:"flex-1",ref:g,children:l.jsx("div",{className:"p-3 sm:p-4 space-y-3 sm:space-y-4",children:c.map((C,xe)=>l.jsxs("div",{className:P("flex gap-2 sm:gap-3",C.role==="user"?"justify-end":"justify-start","animate-in fade-in slide-in-from-bottom-2 duration-300"),style:{animationDelay:`${xe*.05}s`},children:[C.role==="assistant"&&l.jsx("div",{className:P("rounded-full flex-shrink-0 flex items-center justify-center flex-shrink-0",t?"bg-gray-800":"bg-blue-100","w-7 h-7 sm:w-8 sm:h-8"),children:l.jsx(or,{className:P("h-3.5 w-3.5 sm:h-4 sm:w-4",t?"text-blue-400":"text-blue-600")})}),l.jsx("div",{className:P("max-w-[75%] sm:max-w-[80%]",C.role==="user"&&"order-first"),children:C.isTyping?l.jsx(bl,{isDarkMode:t}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:P("px-3 sm:px-4 py-2 sm:py-3 rounded-2xl relative group",C.role==="user"?"bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-br-md":t?"bg-gray-800 text-gray-100 rounded-bl-md":"bg-gray-100 text-gray-800 rounded-bl-md"),children:[l.jsx("p",{className:"text-xs sm:text-sm leading-relaxed whitespace-pre-wrap",children:C.role==="assistant"?Ls(C.content):C.content}),C.role==="assistant"&&l.jsx("button",{onClick:()=>_t(C.content),className:"absolute -right-7 sm:-right-8 top-1/2 -translate-y-1/2 p-1 sm:p-1.5 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity hover:bg-gray-200 dark:hover:bg-gray-700",children:l.jsx(xn,{className:"h-3 w-3 sm:h-3.5 sm:w-3.5 text-gray-500"})})]}),l.jsx("span",{className:P("text-[10px] sm:text-xs mt-1 block",t?"text-gray-500":"text-gray-400",C.role==="user"?"text-right":"text-left"),children:C.timestamp.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})}),C.action==="create_order"&&l.jsx("div",{className:"mt-2",children:l.jsxs("button",{onClick:()=>window.location.href="/cart",className:P("flex items-center gap-1 px-2.5 sm:px-3 py-1 sm:py-1.5 rounded-lg text-[10px] sm:text-xs font-medium",t?"bg-blue-600 text-white hover:bg-blue-700":"bg-blue-500 text-white hover:bg-blue-600"),children:[l.jsx(Ie,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3"}),"Keranjang",l.jsx(xt,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3"})]})}),C.action==="show_wifi_packages"&&l.jsx("div",{className:"mt-2",children:l.jsxs("button",{onClick:()=>window.location.href="/product/wifi",className:P("flex items-center gap-1 px-2.5 sm:px-3 py-1 sm:py-1.5 rounded-lg text-[10px] sm:text-xs font-medium",t?"bg-blue-600 text-white hover:bg-blue-700":"bg-blue-500 text-white hover:bg-blue-600"),children:[l.jsx(We,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3"}),"Paket WiFi",l.jsx(xt,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3"})]})}),C.action==="show_panel_info"&&l.jsx("div",{className:"mt-2",children:l.jsxs("button",{onClick:()=>window.location.href="/product/panel",className:P("flex items-center gap-1 px-2.5 sm:px-3 py-1 sm:py-1.5 rounded-lg text-[10px] sm:text-xs font-medium",t?"bg-purple-600 text-white hover:bg-purple-700":"bg-purple-500 text-white hover:bg-purple-600"),children:[l.jsx(Dt,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3"}),"Panel",l.jsx(xt,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3"})]})}),C.products&&C.products.length>0&&l.jsxs("div",{className:"mt-2 sm:mt-3 space-y-2",children:[l.jsx("p",{className:P("text-[10px] sm:text-xs font-medium",t?"text-gray-400":"text-gray-500"),children:"Produk yang mungkin Anda cari:"}),C.products.slice(0,3).map(B=>l.jsx(yl,{product:B,onAddToCart:A,isDarkMode:t},B.id))]})]})}),C.role==="user"&&l.jsx("div",{className:P("rounded-full flex-shrink-0 flex items-center justify-center flex-shrink-0",t?"bg-gray-700":"bg-blue-600","w-7 h-7 sm:w-8 sm:h-8"),children:l.jsx(Qe,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 text-white"})})]},C.id))})}),l.jsx("div",{className:P("flex-shrink-0 px-3 sm:px-4 py-2 sm:py-2.5 border-t",t?"border-gray-800 bg-gray-900/50":"border-gray-100 bg-gray-50"),children:l.jsx(Dr,{className:"w-full whitespace-nowrap",children:l.jsxs("div",{className:"flex gap-1.5 sm:gap-2 pb-1",children:[l.jsx(Be,{icon:Ie,label:"Produk",onClick:()=>T("Tampilkan semua produk"),isDarkMode:t,color:"blue"}),l.jsx(Be,{icon:We,label:"WiFi",onClick:()=>T("Info paket WiFi"),isDarkMode:t,color:"blue"}),l.jsx(Be,{icon:Dt,label:"Panel",onClick:()=>T("Info Panel Pterodactyl"),isDarkMode:t,color:"purple"}),l.jsx(Be,{icon:Hr,label:"CCTV",onClick:()=>T("Info CCTV"),isDarkMode:t,color:"green"}),l.jsx(Be,{icon:Gr,label:"Website",onClick:()=>T("Jasa website development"),isDarkMode:t,color:"orange"})]})})}),l.jsxs("div",{className:P("flex-shrink-0 px-3 sm:px-4 py-2.5 sm:py-3 border-t",t?"border-gray-800 bg-gray-900":"border-gray-200 bg-white"),children:[l.jsxs("div",{className:"flex gap-2",children:[l.jsx(An,{ref:y,value:d,onChange:C=>h(C.target.value),onKeyDown:k,placeholder:"Ketik pesan...",className:P("flex-1 text-sm",t?"bg-gray-800 border-gray-700 text-white placeholder:text-gray-500 h-10 sm:h-11":"bg-gray-100 border-0 h-10 sm:h-11"),disabled:p}),l.jsx(D,{onClick:x,disabled:!d.trim()||p,className:P("px-3 sm:px-4 transition-all duration-300 h-10 sm:h-11",d.trim()&&!p?"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700":"bg-gray-300"),children:p?l.jsx(Xt,{className:"h-4 w-4 animate-spin"}):l.jsx(kn,{className:"h-4 w-4"})})]}),l.jsxs("div",{className:P("flex items-center justify-center gap-1 text-[10px] sm:text-xs mt-2",t?"text-gray-600":"text-gray-400"),children:[l.jsx(dt,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3"}),l.jsx("span",{children:"Powered by Kimi AI"}),$s.hasApiKey&&l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"mx-1",children:"â€¢"}),l.jsx(Jr,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3 text-green-500"})]})]})]})]})]}),r&&i&&l.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 animate-in fade-in duration-200",onClick:()=>s(!1)})]})}const le={sparkles:["âœ¨","â­","ðŸŒŸ","ðŸ’«","âš¡"],tech:["ðŸ’»","ðŸ“±","âš™ï¸","ðŸ”§","ðŸš€","ðŸ’¡"],services:["ðŸ“¶","ðŸ“¹","ðŸŽ¨","ðŸŽ¬","ðŸŽ®","ðŸŒ"],fun:["ðŸŽ‰","ðŸŽŠ","ðŸŽˆ","ðŸŒˆ","ðŸ”¥","ðŸ‘"]};function _l({className:t,density:e="medium",speed:r="normal",theme:s="mixed"}){const n=v.useRef(null),a=v.useRef([]),i=v.useRef(void 0),o=()=>{switch(s){case"sparkles":return le.sparkles;case"tech":return le.tech;case"services":return le.services;default:return[...le.sparkles,...le.tech,...le.services]}},c=()=>{switch(e){case"low":return 15;case"high":return 40;default:return 25}},u=()=>{switch(r){case"slow":return .5;case"fast":return 2;default:return 1}};return v.useEffect(()=>{const d=n.current;if(!d)return;const h=d.getContext("2d");if(!h)return;const p=()=>{d.width=window.innerWidth,d.height=window.innerHeight};p(),window.addEventListener("resize",p);const f=o(),m=c();a.current=Array.from({length:m},(g,y)=>({id:y,x:Math.random()*d.width,y:Math.random()*d.height,vx:(Math.random()-.5)*.5*u(),vy:(Math.random()-.5)*.5*u()-.2,size:16+Math.random()*16,opacity:.3+Math.random()*.4,rotation:Math.random()*360,emoji:f[Math.floor(Math.random()*f.length)],life:0,maxLife:1e3+Math.random()*1e3}));const b=()=>{h.clearRect(0,0,d.width,d.height),a.current.forEach(g=>{g.x+=g.vx,g.y+=g.vy,g.rotation+=.5,g.life++,g.y<-50&&(g.y=d.height+50,g.x=Math.random()*d.width),g.x<-50&&(g.x=d.width+50),g.x>d.width+50&&(g.x=-50);const y=g.life/g.maxLife,_=g.opacity*(1-Math.sin(y*Math.PI));h.save(),h.translate(g.x,g.y),h.rotate(g.rotation*Math.PI/180),h.globalAlpha=_,h.font=`${g.size}px serif`,h.textAlign="center",h.textBaseline="middle",h.fillText(g.emoji,0,0),h.restore(),g.life>=g.maxLife&&(g.life=0,g.emoji=f[Math.floor(Math.random()*f.length)])}),i.current=requestAnimationFrame(b)};return b(),()=>{window.removeEventListener("resize",p),i.current&&cancelAnimationFrame(i.current)}},[e,r,s]),l.jsx("canvas",{ref:n,className:P("fixed inset-0 pointer-events-none z-0",t)})}function xl({enabled:t=!0,emoji:e="âœ¨",maxTrails:r=20}){const[s,n]=v.useState([]),a=v.useRef(0),i=v.useRef({x:0,y:0});return v.useEffect(()=>{if(!t)return;const o=c=>{if(Math.hypot(c.clientX-i.current.x,c.clientY-i.current.y)>30){i.current={x:c.clientX,y:c.clientY};const d={x:c.clientX,y:c.clientY,id:a.current++,emoji:e,opacity:1,scale:1};n(h=>[...h.slice(-r+1),d])}};return window.addEventListener("mousemove",o,{passive:!0}),()=>window.removeEventListener("mousemove",o)},[t,e,r]),v.useEffect(()=>{if(s.length===0)return;const o=setInterval(()=>{n(c=>c.map(u=>({...u,opacity:u.opacity-.05,scale:u.scale-.02,y:u.y-1})).filter(u=>u.opacity>0))},50);return()=>clearInterval(o)},[s.length]),t?l.jsx("div",{className:"fixed inset-0 pointer-events-none z-50 overflow-hidden",children:s.map(o=>l.jsx("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 transition-none",style:{left:o.x,top:o.y,opacity:o.opacity,transform:`translate(-50%, -50%) scale(${o.scale})`},children:l.jsx("span",{className:"text-lg",children:o.emoji})},o.id))}):null}function kl(){const[t,e]=v.useState([]),r=v.useRef(0);return v.useEffect(()=>{const s=n=>{const a=[...le.fun,...le.sparkles],i=8+Math.floor(Math.random()*8),o=Array.from({length:i},()=>({emoji:a[Math.floor(Math.random()*a.length)],vx:(Math.random()-.5)*10,vy:(Math.random()-.5)*10-3,rotation:Math.random()*360,scale:.5+Math.random()*.8}));e(c=>[...c,{id:r.current++,x:n.clientX,y:n.clientY,particles:o}])};return window.addEventListener("click",s),()=>window.removeEventListener("click",s)},[]),v.useEffect(()=>{if(t.length===0)return;const s=setInterval(()=>{e(n=>n.map(i=>({...i,particles:i.particles.map(o=>({...o,vx:o.vx*.95,vy:o.vy+.2,rotation:o.rotation+5,scale:o.scale*.98})).filter(o=>o.scale>.1)})).filter(i=>i.particles.length>0))},30);return()=>clearInterval(s)},[t.length]),l.jsx("div",{className:"fixed inset-0 pointer-events-none z-50 overflow-hidden",children:t.map(s=>l.jsx("div",{children:s.particles.map((n,a)=>l.jsx("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2",style:{left:s.x+n.vx*10,top:s.y+n.vy*10,transform:`translate(-50%, -50%) rotate(${n.rotation}deg) scale(${n.scale})`},children:l.jsx("span",{className:"text-xl",children:n.emoji})},a))},s.id))})}var Sl=(t,e,r,s,n,a,i,o)=>{let c=document.documentElement,u=["light","dark"];function d(f){(Array.isArray(t)?t:[t]).forEach(m=>{let b=m==="class",g=b&&a?n.map(y=>a[y]||y):n;b?(c.classList.remove(...g),c.classList.add(a&&a[f]?a[f]:f)):c.setAttribute(m,f)}),h(f)}function h(f){o&&u.includes(f)&&(c.style.colorScheme=f)}function p(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}if(s)d(s);else try{let f=localStorage.getItem(e)||r,m=i&&f==="system"?p():f;d(m)}catch{}},El=v.createContext(void 0),jl={setTheme:t=>{},themes:[]},Rl=()=>{var t;return(t=v.useContext(El))!=null?t:jl};v.memo(({forcedTheme:t,storageKey:e,attribute:r,enableSystem:s,enableColorScheme:n,defaultTheme:a,value:i,themes:o,nonce:c,scriptProps:u})=>{let d=JSON.stringify([r,e,a,t,o,i,s,n]).slice(1,-1);return v.createElement("script",{...u,suppressHydrationWarning:!0,nonce:typeof window>"u"?c:"",dangerouslySetInnerHTML:{__html:`(${Sl.toString()})(${d})`}})});const Tl=({...t})=>{const{theme:e="system"}=Rl();return l.jsx(Pn,{theme:e,className:"toaster group",icons:{success:l.jsx(Jr,{className:"size-4"}),info:l.jsx(jn,{className:"size-4"}),warning:l.jsx(En,{className:"size-4"}),error:l.jsx(Sn,{className:"size-4"}),loading:l.jsx(Xt,{className:"size-4 animate-spin"})},style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)","--border-radius":"var(--radius)"},...t})},Al=v.lazy(()=>re(()=>import("./HomeSection-BGOCzVhx.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Cl=v.lazy(()=>re(()=>import("./ProductSection-C5P_jEpb.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,13,10,11,9]))),Pl=v.lazy(()=>re(()=>import("./CartSection-C-z-ruj6.js"),__vite__mapDeps([14,1,2,3,4,5,6,15,16,10,11]))),Nl=v.lazy(()=>re(()=>import("./AuthSection-pwwUed_J.js"),__vite__mapDeps([17,1,2,3,4,5,6,7,8,18,16,15,10,11,13,19]))),Ol=v.lazy(()=>re(()=>import("./SupportSection-DHuy6CUF.js"),__vite__mapDeps([20,1,2,3,4,5,6,7,8,21,18,22,16,10,11,9,13,19]))),Il=v.lazy(()=>re(()=>import("./ProfileSection-BwtEJexL.js"),__vite__mapDeps([23,1,2,3,4,5,6,7,8,18,16,10,11,13,19]))),$l=v.lazy(()=>re(()=>import("./CheckoutSection-DYTcmQ0G.js"),__vite__mapDeps([24,1,2,3,4,5,6,16,7,8,18,21,10,11,13]))),Ll=v.lazy(()=>re(()=>import("./UltraSearch-PURyzfjP.js"),__vite__mapDeps([25,1,2,7,3,4,5,6,8,10,11,13,19]))),Ul=v.lazy(()=>re(()=>import("./ParticleBackground-CRnDEmue.js"),__vite__mapDeps([26,1,2,3,4,5,6])));function Dl(){return l.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx(Xt,{className:"h-8 w-8 mx-auto mb-3 animate-spin text-blue-500"}),l.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Memuat konten..."})]})})}function Bl({isOpen:t,onClose:e}){const[r,s]=v.useState(""),{products:n,addToCart:a,isDarkMode:i,soundEnabled:o}=X(),c=v.useMemo(()=>{if(!r.trim())return[];const u=r.toLowerCase();return n.filter(d=>d.title.toLowerCase().includes(u)||d.description.toLowerCase().includes(u)).slice(0,10)},[r,n]);return t?l.jsx("div",{className:`fixed inset-0 z-50 ${i?"bg-black/70":"bg-black/50"}`,onClick:e,children:l.jsxs("div",{className:`absolute top-16 left-4 right-4 rounded-xl shadow-2xl p-4 max-h-[70vh] overflow-auto ${i?"bg-gray-800":"bg-white"}`,onClick:u=>u.stopPropagation(),children:[l.jsx("input",{type:"text",placeholder:"Cari layanan...",className:`w-full p-3 border rounded-lg mb-4 ${i?"bg-gray-700 border-gray-600 text-white":""}`,value:r,onChange:u=>s(u.target.value),autoFocus:!0}),l.jsxs("div",{className:"space-y-2",children:[c.map(u=>l.jsxs("div",{className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer ${i?"hover:bg-gray-700":"hover:bg-gray-50"}`,onClick:()=>{a(u,u.tiers[0]?.name||""),o&&O.playSuccess(),$.success(`${u.title} ditambahkan ke keranjang`),e()},children:[l.jsx("img",{src:u.icon,alt:u.title,className:"w-12 h-12 object-cover rounded",loading:"lazy"}),l.jsxs("div",{className:"flex-1",children:[l.jsx("p",{className:`font-medium text-sm ${i?"text-white":""}`,children:u.title}),l.jsxs("p",{className:"text-xs text-blue-500",children:["Rp ",u.base_price.toLocaleString("id-ID")]})]})]},u.id)),r&&c.length===0&&l.jsx("p",{className:`text-center py-4 ${i?"text-gray-400":"text-gray-500"}`,children:"Tidak ada hasil"})]})]})}):null}function Ml({isDarkMode:t}){const[e,r]=v.useState(il()),[s,n]=v.useState(!1);return v.useEffect(()=>{const a=al(i=>{if(r(i),n(!0),i?$.success("Koneksi internet tersambung kembali",{icon:l.jsx(We,{className:"h-4 w-4"})}):$.error("Koneksi internet terputus",{icon:l.jsx(lr,{className:"h-4 w-4"}),duration:5e3}),i){const o=setTimeout(()=>n(!1),3e3);return()=>clearTimeout(o)}});return()=>a()},[]),s?l.jsx("div",{className:P("fixed top-0 left-0 right-0 z-[60] flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium transition-all duration-300",e?"bg-green-500 text-white":t?"bg-red-600 text-white":"bg-red-500 text-white"),children:e?l.jsxs(l.Fragment,{children:[l.jsx(We,{className:"h-4 w-4"}),l.jsx("span",{children:"Terhubung ke internet"})]}):l.jsxs(l.Fragment,{children:[l.jsx(lr,{className:"h-4 w-4"}),l.jsx("span",{children:"Tidak ada koneksi internet"})]})}):null}function ql({isDarkMode:t}){const[e,r]=v.useState(!1);return v.useEffect(()=>{const s=()=>r(!0);return window.addEventListener("sw-update-available",s),()=>window.removeEventListener("sw-update-available",s)},[]),e?l.jsx("div",{className:P("fixed top-16 left-4 right-4 z-50 mx-auto max-w-md","rounded-lg p-4 shadow-lg animate-in fade-in slide-in-from-top-4",t?"bg-blue-600 text-white":"bg-blue-500 text-white"),children:l.jsxs("div",{className:"flex items-center justify-between gap-4",children:[l.jsxs("div",{children:[l.jsx("p",{className:"font-medium",children:"Pembaruan Tersedia"}),l.jsx("p",{className:"text-sm text-white/80",children:"Versi baru aplikasi telah tersedia."})]}),l.jsx("button",{onClick:()=>window.location.reload(),className:"shrink-0 rounded-lg bg-white px-4 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50",children:"Update"})]})}):null}function Kl(t){return t==="/"?ee.home:t.startsWith("/product/")?ee.home:t==="/cart"?ee.cart:t==="/checkout"?ee.checkout:t==="/profile"?ee.profile:t==="/support"?ee.support:t==="/auth"?ee.auth:t.startsWith("/admin")?ee.admin:ee.home}function Wl({children:t}){const{isDarkMode:e}=X();return v.useEffect(()=>{const r=document.documentElement;e?r.classList.add("dark"):r.classList.remove("dark")},[e]),l.jsx(l.Fragment,{children:t})}function Fl(){const{notification:t,setNotification:e,isDarkMode:r,soundEnabled:s,hasSeenTutorial:n,setHasSeenTutorial:a}=X(),[i,o]=v.useState(!1),[c,u]=v.useState(!1),[d,h]=v.useState(!1),[p,f]=v.useState("browser"),m=Br();v.useEffect(()=>{ll();const w=ol();f(w);const x=()=>{$.success("Aplikasi berhasil diinstall!")};return window.addEventListener("pwa-installed",x),()=>{window.removeEventListener("pwa-installed",x)}},[]),v.useEffect(()=>{t&&($[t.type](t.message),e(null))},[t,e]),v.useEffect(()=>{const w=x=>{(x.ctrlKey||x.metaKey)&&x.key==="k"&&(x.preventDefault(),u(!0)),x.key==="Escape"&&(u(!1),o(!1))};return window.addEventListener("keydown",w),()=>window.removeEventListener("keydown",w)},[]),v.useEffect(()=>{if(!n&&m.pathname==="/"){const w=setTimeout(()=>{h(!0)},3e3);return()=>clearTimeout(w)}},[n,m.pathname]);const b=v.useCallback(()=>{h(!1),a(!0)},[a]),g=m.pathname==="/checkout",y=m.pathname.startsWith("/product/"),_=g||y,E=p==="standalone";return l.jsx(Wl,{children:l.jsxs("div",{className:P("min-h-screen transition-colors",r?"bg-gray-900":"bg-gray-50"),children:[l.jsx(Ml,{isDarkMode:r}),l.jsx(ql,{isDarkMode:r}),l.jsx(Qo,{}),l.jsx(ls,{isOpen:d,onClose:b}),l.jsx(ul,{}),l.jsx(vl,{}),l.jsx(v.Suspense,{fallback:null,children:l.jsx(Ll,{isOpen:c,onClose:()=>u(!1)})}),l.jsx(v.Suspense,{fallback:null,children:l.jsx(Ul,{variant:"network",density:"low",isDarkMode:r})}),l.jsx(_l,{density:"low",speed:"slow",theme:"mixed"}),l.jsx(xl,{enabled:!0,emoji:"âœ¨",maxTrails:15}),l.jsx(kl,{}),!_&&l.jsx(ta,{onMenuClick:()=>{s&&O.playClick(),o(!0)},onSearchClick:()=>{s&&O.playClick(),u(!0)}}),l.jsx(Yo,{isOpen:i,onClose:()=>o(!1)}),l.jsx(Bl,{isOpen:c,onClose:()=>u(!1)}),l.jsx(Nn,{...Kl(m.pathname)}),l.jsx("main",{className:P("min-h-screen",!_&&"pt-14 pb-16",E&&!_&&"pt-safe-top pb-safe-bottom"),children:l.jsx(v.Suspense,{fallback:l.jsx(Dl,{}),children:l.jsxs(rn,{children:[l.jsx(ne,{path:"/",element:l.jsx(Al,{})}),l.jsx(ne,{path:"/product/:productId",element:l.jsx(Cl,{})}),l.jsx(ne,{path:"/cart",element:l.jsx(Pl,{})}),l.jsx(ne,{path:"/auth",element:l.jsx(Nl,{})}),l.jsx(ne,{path:"/support",element:l.jsx(Ol,{})}),l.jsx(ne,{path:"/profile",element:l.jsx(Il,{})}),l.jsx(ne,{path:"/checkout",element:l.jsx($l,{})}),l.jsx(ne,{path:"*",element:l.jsx(On,{})})]})})}),!_&&l.jsx(ra,{}),l.jsx(Tl,{position:"top-center",toastOptions:{style:{background:r?"#1f2937":"#fff",color:r?"#fff":"#000"}}})]})})}const Zl=Object.freeze(Object.defineProperty({__proto__:null,default:Fl},Symbol.toStringTag,{value:"Module"}));export{as as A,Jt as E,Dr as S,is as a,os as b,Zl as c,Jo as u};
