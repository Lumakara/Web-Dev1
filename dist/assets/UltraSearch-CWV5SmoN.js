import{j as e}from"./ui-vendor-q7wFqjOa.js";import{r as c}from"./react-core-uW5GauGR.js";import{P as K,I as V,B as _}from"./badge-DxRVC9FS.js";import{S as $}from"./App-CskH4_4Y.js";import{c as i}from"./index-CqmKntzG.js";import{u as q,a as D}from"./appStore-DZKr_UpI.js";import{n as J,X as z,S as Z,aw as Q,ax as W,y as X,c as G,Z as Y,ay as O,az as ee}from"./icons-BdpAQ6Hm.js";import"./firebase-BZSrvpf7.js";import"./utils-CUtzRjuR.js";import"./notifications-Bi33bcEl.js";import"./NotFound-BQdtaFB_.js";import"./state-BjmFXnif.js";function S(o,x){const a=o.toLowerCase(),h=x.toLowerCase();if(a===h)return{match:!0,score:100};if(a.includes(h))return{match:!0,score:80};let s=0,g=0;for(let u=0;u<a.length&&s<h.length;u++)a[u]===h[s]&&(g+=10,s++);return{match:s===h.length,score:g>0?g:0}}function T({text:o,query:x,className:a}){if(!x)return e.jsx("span",{children:o});const h=o.split(new RegExp(`(${x.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi"));return e.jsx("span",{className:a,children:h.map((s,g)=>s.toLowerCase()===x.toLowerCase()?e.jsx("mark",{className:"bg-yellow-200 dark:bg-yellow-900/50 text-inherit rounded px-0.5",children:s},g):s)})}function he({isOpen:o,onClose:x}){const{isDarkMode:a,addToCart:h}=q(),[s,g]=c.useState(""),[u,A]=c.useState([]),[P,C]=c.useState(!1),[R,w]=c.useState([]),[p,f]=c.useState(0),[N,B]=c.useState(!1),[d,k]=c.useState({category:"all",priceRange:"all",minRating:0}),L=c.useRef(null);c.useEffect(()=>{const t=localStorage.getItem("search_history");t&&w(JSON.parse(t))},[]);const F=c.useCallback(t=>{w(l=>{const r=[t,...l.filter(n=>n!==t)].slice(0,10);return localStorage.setItem("search_history",JSON.stringify(r)),r})},[]);c.useEffect(()=>{o&&(C(!0),K.getAll().then(A).finally(()=>C(!1)),L.current?.focus())},[o]);const m=c.useMemo(()=>{if(!s.trim())return[];const t=[],l=s.toLowerCase();return u.forEach(r=>{let n=0;const y=[],I=S(r.title,s);I.match&&(n+=I.score*3,y.push("title"));const M=S(r.description,s);if(M.match&&(n+=M.score*1.5,y.push("description")),r.tags.forEach(b=>{const j=S(b,s);j.match&&(n+=j.score*2,y.push("tags"))}),r.category.toLowerCase().includes(l)&&(n+=50,y.push("category")),r.tiers.forEach(b=>{b.name.toLowerCase().includes(l)&&(n+=40,y.push("tier"))}),!(d.category!=="all"&&r.category!==d.category)&&!(d.minRating>0&&r.rating<d.minRating)){if(d.priceRange!=="all"){const b=Math.min(...r.tiers.map(v=>v.price)),[j,H]=d.priceRange.split("-").map(v=>v==="plus"?1/0:parseInt(v)*1e3);if(b<j||H&&b>H)return}n>0&&t.push({product:r,score:n,matchedFields:y})}}),t.sort((r,n)=>n.score-r.score).slice(0,20)},[s,u,d]);c.useEffect(()=>{const t=l=>{o&&(l.key==="ArrowDown"?(l.preventDefault(),f(r=>Math.min(r+1,m.length-1))):l.key==="ArrowUp"?(l.preventDefault(),f(r=>Math.max(r-1,-1))):l.key==="Enter"?(l.preventDefault(),p>=0&&m[p]&&E(m[p].product)):l.key==="Escape"&&x())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[o,p,m]);const E=t=>{h(t,t.tiers[0]?.name||""),F(s),D.playSuccess(),x()},U=()=>{w([]),localStorage.removeItem("search_history"),D.playClick()};return o?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-20",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:x}),e.jsxs("div",{className:i("relative w-full max-w-2xl mx-4 rounded-2xl shadow-2xl overflow-hidden","animate-in fade-in zoom-in-95 duration-200",a?"bg-gray-900 border border-gray-800":"bg-white"),children:[e.jsxs("div",{className:i("p-4 border-b",a?"border-gray-800":"border-gray-200"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:i("w-10 h-10 rounded-xl flex items-center justify-center","bg-gradient-to-br from-blue-500 to-purple-600"),children:e.jsx(J,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:i("font-semibold text-lg",a?"text-white":"text-gray-900"),children:"Ultra Search"}),e.jsx("p",{className:i("text-xs",a?"text-gray-400":"text-gray-500"),children:"Cari dengan AI-powered fuzzy matching"})]}),e.jsx("button",{onClick:x,className:i("p-2 rounded-lg transition-colors",a?"hover:bg-gray-800 text-gray-400":"hover:bg-gray-100 text-gray-500"),children:e.jsx(z,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"relative mt-4",children:[e.jsx(Z,{className:i("absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5",a?"text-gray-500":"text-gray-400")}),e.jsx(V,{ref:L,value:s,onChange:t=>{g(t.target.value),f(0)},placeholder:"Cari produk, layanan, atau fitur...",className:i("pl-12 pr-12 py-6 text-lg",a?"bg-gray-800 border-gray-700 text-white placeholder:text-gray-500":"bg-gray-100 border-0")}),s&&e.jsx("button",{onClick:()=>g(""),className:"absolute right-4 top-1/2 -translate-y-1/2",children:e.jsx(z,{className:"h-5 w-5 text-gray-400"})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>B(!N),className:i("flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm transition-colors",N?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400":a?"bg-gray-800 text-gray-300 hover:bg-gray-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[e.jsx(Q,{className:"h-4 w-4"}),"Filter"]}),s&&e.jsxs(_,{variant:"secondary",className:a?"bg-gray-800":"",children:[m.length," hasil"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(W,{className:"h-3 w-3"}),e.jsx("span",{children:"↑↓ navigasi"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"↵ pilih"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"esc tutup"})]})]}),N&&e.jsxs("div",{className:i("mt-3 p-3 rounded-xl flex flex-wrap gap-3",a?"bg-gray-800":"bg-gray-50"),children:[e.jsxs("select",{value:d.category,onChange:t=>k(l=>({...l,category:t.target.value})),className:i("px-3 py-2 rounded-lg text-sm",a?"bg-gray-700 text-white border-gray-600":"bg-white border border-gray-200"),children:[e.jsx("option",{value:"all",children:"Semua Kategori"}),e.jsx("option",{value:"installation",children:"Instalasi"}),e.jsx("option",{value:"creative",children:"Kreatif"}),e.jsx("option",{value:"technical",children:"Teknis"})]}),e.jsxs("select",{value:d.priceRange,onChange:t=>k(l=>({...l,priceRange:t.target.value})),className:i("px-3 py-2 rounded-lg text-sm",a?"bg-gray-700 text-white border-gray-600":"bg-white border border-gray-200"),children:[e.jsx("option",{value:"all",children:"Semua Harga"}),e.jsx("option",{value:"0-50",children:"Dibawah Rp 50rb"}),e.jsx("option",{value:"50-100",children:"Rp 50rb - 100rb"}),e.jsx("option",{value:"100-500",children:"Rp 100rb - 500rb"}),e.jsx("option",{value:"500-plus",children:"Diatas Rp 500rb"})]}),e.jsxs("select",{value:d.minRating,onChange:t=>k(l=>({...l,minRating:Number(t.target.value)})),className:i("px-3 py-2 rounded-lg text-sm",a?"bg-gray-700 text-white border-gray-600":"bg-white border border-gray-200"),children:[e.jsx("option",{value:0,children:"Semua Rating"}),e.jsx("option",{value:4,children:"4+ Bintang"}),e.jsx("option",{value:4.5,children:"4.5+ Bintang"}),e.jsx("option",{value:4.8,children:"4.8+ Bintang"})]})]})]}),e.jsx($,{className:"max-h-[400px]",children:P?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(X,{className:"h-8 w-8 animate-spin mx-auto text-blue-500 mb-2"}),e.jsx("p",{className:a?"text-gray-400":"text-gray-500",children:"Memuat produk..."})]}):s?m.length>0?e.jsx("div",{className:"p-2",children:m.map(({product:t,matchedFields:l},r)=>e.jsxs("button",{onClick:()=>E(t),onMouseEnter:()=>f(r),className:i("w-full flex items-center gap-4 p-3 rounded-xl text-left transition-all",p===r?"bg-blue-50 dark:bg-blue-900/20":"hover:bg-gray-50 dark:hover:bg-gray-800/50"),children:[e.jsx("img",{src:t.icon,alt:t.title,className:"w-12 h-12 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:i("font-medium truncate",a?"text-white":"text-gray-900"),children:e.jsx(T,{text:t.title,query:s})}),p===r&&e.jsx(G,{className:"h-4 w-4 text-blue-500 animate-bounce"})]}),e.jsx("p",{className:i("text-sm truncate",a?"text-gray-400":"text-gray-500"),children:e.jsx(T,{text:t.description.slice(0,60)+"...",query:s})}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-blue-600 font-semibold text-sm",children:["Rp ",Math.min(...t.tiers.map(n=>n.price)).toLocaleString("id-ID")]}),e.jsxs("span",{className:"text-yellow-500 text-xs",children:["★ ",t.rating]}),l.length>0&&e.jsxs("span",{className:i("text-xs px-2 py-0.5 rounded-full",a?"bg-gray-800 text-gray-400":"bg-gray-100 text-gray-500"),children:["Match: ",l.join(", ")]})]})]})]},t.id))}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(Y,{className:"h-12 w-12 mx-auto text-gray-300 mb-3"}),e.jsxs("p",{className:a?"text-gray-400":"text-gray-500",children:['Tidak ada hasil untuk "',s,'"']}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Coba kata kunci lain atau periksa ejaan"})]}):e.jsxs("div",{className:"p-4",children:[R.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:i("text-sm font-medium flex items-center gap-2",a?"text-gray-300":"text-gray-700"),children:[e.jsx(O,{className:"h-4 w-4"}),"Pencarian Terakhir"]}),e.jsx("button",{onClick:U,className:"text-xs text-red-500 hover:text-red-600",children:"Hapus"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(t=>e.jsx("button",{onClick:()=>g(t),className:i("px-3 py-1.5 rounded-full text-sm transition-colors",a?"bg-gray-800 text-gray-300 hover:bg-gray-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:t},t))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:i("text-sm font-medium flex items-center gap-2 mb-3",a?"text-gray-300":"text-gray-700"),children:[e.jsx(ee,{className:"h-4 w-4"}),"Populer"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["WiFi Installation","CCTV Security","VPS Hosting","Video Editing"].map(t=>e.jsx("button",{onClick:()=>g(t),className:i("px-3 py-1.5 rounded-full text-sm transition-colors",a?"bg-blue-900/30 text-blue-300 hover:bg-blue-900/50":"bg-blue-50 text-blue-600 hover:bg-blue-100"),children:t},t))})]})]})})]})]}):null}export{he as UltraSearch,he as default};
